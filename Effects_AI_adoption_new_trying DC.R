library(data.table) #for reading the big files using fread and for replacing countries names (by AI_pat for example)
library(readxl) #for reading the xlsx files
library(tidyverse) # Collection of all the good stuff like dplyr, ggplot2 ect.
library(magrittr) # For extra-piping operators (eg. %<>%)
library(EconGeo) # Economic Geography functions
library(psych) #for descriptives
library(Metrics) #for mae
library(did) #for treatment effect over distinct periods of time
library(openxlsx)
library(zoo) #for some reason the function na.locf is just in the zoo package for me now
library(vtable) #for functions st and sumtable in the statistics
library(ggcorrplot) #for correlation table
library(janitor) #for improving the names of the columns (which in turn is done using data %<>%  clean_names())

#library(mice) #for imputation, not used

options(scipen = 999)  # Prevents scientific notation
#1.Measuring technological distance-----
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
all_patents <-fread("Input_code/Big_files_ignore/All_patents.csv")

#Now we add the nace codes:
CompaniesData1<-read_excel("Input_code/Big_files_ignore/DataCompanies1.xlsx", sheet = "Results", na = "n.a.")
CompaniesData2<-read_excel("Input_code/Big_files_ignore/DataCompanies2.xlsx", sheet = "Results", na = "n.a.")
CompaniesData3<-read_excel("Input_code/Big_files_ignore/DataCompanies3.xlsx", sheet = "Results", na = "n.a.")
CompaniesData4<-read_excel("Input_code/Big_files_ignore/DataCompanies4.xlsx", sheet = "Results", na = "n.a.")
CompaniesData5<-read_excel("Input_code/Big_files_ignore/DataCompanies5.xlsx", sheet = "Results", na = "n.a.")
CompaniesData6<-read_excel("Input_code/Big_files_ignore/DataCompanies6.xlsx", sheet = "Results", na = "n.a.")
CompaniesData <- rbind(CompaniesData1,CompaniesData2,CompaniesData3,CompaniesData4,CompaniesData5,CompaniesData6)
rm(CompaniesData1,CompaniesData2,CompaniesData3,CompaniesData4,CompaniesData5,CompaniesData6)

CompaniesData <- CompaniesData[,c(2,3,6)] 
names(CompaniesData) <- c("Company_name", "Company", "Nace_4d")

all_patents <- left_join(all_patents, CompaniesData, by = "Company")
table(is.na(all_patents$Nace_4d)) #12,188,742   F (i.e., companies with NACE), and 570,280   T

#drop companies without Nace codes:
all_patents <- all_patents[is.na(all_patents$Nace_4d) == F,]
rm(CompaniesData)
#exclude company name:
all_patents<-all_patents[,c(-7)]

#create the 3 functions we'll use later:
#1.create a function for fractional counting IPC codes on which patent
group_by_applnID <- function (data){
  data %>%
    group_by(PubNo) %>%
    mutate(field_weight = 1 / n()) %>%
    ungroup()
}
#2.create a function for counting the relative participation of each IPC code for each NACE sector
group_by_NACE_and_Subclass <- function (data){
  data %<>%
    group_by(Nace_4d, Subclass) %>%
    summarise(n_tech_reg = sum(field_weight)) %>%
    ungroup() %>%
    drop_na() 
}  
#3. create a function to build a square matrix that aggregates the co-occurrence one variable in regards to other (e.g., how many times two IPC codes appear in the same patent)
create_sparse_matrix <- function(i.input, j.input){
  require(Matrix)
  mat <- spMatrix(nrow = i.input %>% n_distinct(),
                  ncol = j.input %>% n_distinct(),
                  i = i.input %>% factor() %>% as.numeric(),
                  j = j.input %>% factor() %>% as.numeric(),
                  x = rep(1, i.input %>% length() ) )
  
  row.names(mat) <- i.input %>% factor() %>% levels()
  colnames(mat) <- j.input %>% factor() %>% levels()
  return(mat)
}

##1.1.Technological distance of 4-digit IPC codes to AI-----
#introduce AI as a specific subclass
AI_Patents <- all_patents[all_patents$AIpatent == "Yes",]
length(unique(AI_Patents$PubNo)) #76,578
length(unique(all_patents$PubNo))#7,354,214

#pick distinct codes at two variables:
AI_Patents_with_code <- distinct_at(AI_Patents, vars(PubNo,Company), .keep_all = T)
length(unique(AI_Patents_with_code$PubNo))  #76,578
AI_Patents_with_code$Subclass <- "Artificial_Intelligence" #

AI_Patents <- rbind(AI_Patents, AI_Patents_with_code)
length(unique(AI_Patents$PubNo)) #76,578

all_patents <- rbind(all_patents, AI_Patents)
table(all_patents$AIpatent) #334,316 "Yes" 
rm(AI_Patents_with_code, AI_Patents)

#now let's create a square matrix where we see how often two IPC codes appear in the same patent
mat_tech <- create_sparse_matrix(i = all_patents %>% pull(PubNo),
                                 j = all_patents %>% pull(Subclass))

#let's convert this to a matrix that we can properly visualize:
mat_tech %<>% 
  crossprod() %>% 
  as.matrix() 

#finally, let's calculate the relatedness of every technology to AI
mat_tech %<>% 
  relatedness(method = "cosine")

#save this matrix to be used later
write.csv2(mat_tech, file = "Output_code/Data/Matrix_relatedness_technologies_to_AI.csv", row.names = T) #
rm(mat_tech)

##1.2.Technological distance of NACE sectors to AI-----
#let's start by removing AI as a separate technology
length(unique(all_patents$PubNo)) #7,354,214
table(all_patents$AIpatent) #334,316 
all_patents <- all_patents[all_patents$Subclass != "Artificial_Intelligence",]
length(unique(all_patents$PubNo)) #7,354,214 (same number, because we just removed the repeated added AI patents)
table(all_patents$AIpatent) #257,044 (different number because we removed the extra AI patents but not the original ones)

#now let's add AI as if it were an industry:
AIPatents<- all_patents[all_patents$AIpatent == "Yes",]

AIPatents$Nace_4d <- "AI"
length(unique(all_patents$Company)) #27707 MNEs
length(unique(all_patents$Nace_4d)) #620 NACEs
#merge this new sector back to the longer dataset:
all_patents<-rbind(all_patents, AIPatents)
length(unique(all_patents$Company)) #27707 MNEs
length(unique(all_patents$Nace_4d)) #621 NACEs
rm(AIPatents)

#count total of patents of each sector, and total of AI patents;
all_patents %<>% group_by(Nace_4d) %>% 
  mutate(TotalPatents = length(unique(PubNo))) %>% #get the higher share of usage
  mutate(TotalAIPatents = length(na.omit(unique(PubNo[AIpatent == "Yes"])))) %>% 
  mutate(ShareAI = TotalAIPatents/TotalPatents) %>% 
  ungroup()

describe(all_patents$TotalPatents) #I'm using the describe from the psych library
#so, number of patents varies from 1 to 936,534  , with a median value of 142,695. Let's exclude the sectors that are way below that, let's say, by having less than 500 patents:
all_patents <- all_patents[all_patents$TotalPatents >= 500,]
length(unique(all_patents$Nace_4d)) #280 sectors (including the fake AI one) with at least 500 patents

#Finally, let's apply the two functions we created before:
reg_tech <- group_by_applnID(all_patents) #this gets the relative participation of each IPC code on each patent
reg_tech <- group_by_NACE_and_Subclass(reg_tech) #this gets the sum of the relative participation of each code for each NACE

#let's convert this into a matrix where we have one line per NACE code, and all technologies linked to them in the columns
mat_reg_tech <- reg_tech %>%
  arrange(Subclass) %>% 
  pivot_wider(names_from = Subclass, values_from = n_tech_reg, values_fill = list(n_tech_reg = 0)) #

#let's throw the nace codes into the column names
mat_reg_tech %<>% remove_rownames %>% column_to_rownames(var="Nace_4d") %>%
  as.matrix() %>%
  round() #

#and calculate binary specializations
rel_sectors_codes <- mat_reg_tech %>% location_quotient(binary = T) %>% 
  as.data.frame() %>% 
  rownames_to_column("mat_reg_tech") %>% 
  as_tibble() %>% 
  gather(key = "Subclass", value = "RCA", -mat_reg_tech) %>%
  arrange(mat_reg_tech, Subclass)
#let's transform this back into a matrix:
rel_sectors_codes %<>%
  arrange(Subclass, mat_reg_tech) %>%
  pivot_wider(names_from = Subclass, values_from = RCA, values_fill = list(RCA = 0)) #transform on a binary-like matrix

#replace NA values by 0
rel_sectors_codes[is.na(rel_sectors_codes)] <- 0
#let's set the AI sector as a target/reference for calculating the distance:
predicted <- rel_sectors_codes[rel_sectors_codes$mat_reg_tech=="AI",]
predicted<- predicted[,(-1)]
predicted<-as.vector(predicted,mode='numeric')

#let's calculate the distance from all sectors to this AI reference:
AverageDistance <- as.data.frame("Nace_4d", col.names = "a")

for (i in 1:length(rel_sectors_codes$mat_reg_tech)){
  
  AverageDistance[i] <- mae(as.vector(rel_sectors_codes[i,][,(-1)],mode='numeric'),predicted)
}

AverageDistance <- as.data.frame(t(AverageDistance))
Sectors <- as.data.frame(rel_sectors_codes[,1])
AverageDistance <- cbind(AverageDistance,Sectors)
names(AverageDistance) <- c("AverageDistance", "Nace_4d")
#let's create the group category based on quartiles. the lower the distance to AI, the closer the sector is to it
AverageDistance$Quartile <- ifelse(AverageDistance$AverageDistance>=quantile(AverageDistance$AverageDistance)[[4]], "bottom",
                                                ifelse(AverageDistance$AverageDistance<quantile(AverageDistance$AverageDistance)[[4]] & 
                                                         AverageDistance$AverageDistance>quantile(AverageDistance$AverageDistance)[[2]], "medium", "top"))
#and save this file
write.csv2(AverageDistance, file = "Output_code/Data/Distance_NACE_sectors_to_AI.csv", row.names = F) #MAE_9a.csv

#2.Measuring effects-----
##2.1.Overall-----
###2.1.1.Non-standard - Relatedness and number of patents regardless of sector  ----
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
length(unique(DataLong_Subs_sim$Company)) #123
#1.1.1.Simple Aggregation Relatedness
example_attgt <- att_gt(yname = "Relatedness_Cos2", tname = "CurrentYear", idname = "id",
                        gname = "first.treat", xformla = ~1, data = DataLong_Subs_sim, alp=.01
)

agg.simple <- aggte(example_attgt, type = "simple", na.rm = TRUE)
summary(agg.simple) #effect: 1.0798               Std. Error: 0.1998         [ 99%  Conf. Int.]: 0.5651      1.5945 *

#1.1.2.Dynamic Effects and Event Studies
agg.es <- aggte(example_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #effect 1.3202        0.2976     0.5535      2.0868 *
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h1_Relatedness_all.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H1) All quartiles - Relatedness") + theme(legend.position="right") +   ylab("Knowledge-relatedness") + 
  xlab("Length of exposure") + scale_color_manual(values=c("grey70","orange"),labels = c("Pre-treatment", "Post-treatment")) + 
  geom_vline(xintercept = 0, linetype="dotted", color = "black", size=1, alpha = 0.3)
dev.off()

#Simple Aggregation Innovative performance
example_attgt <- att_gt(yname = "NoPatentsYearGUOtotal", tname = "CurrentYear", idname = "id", 
                        gname = "first.treat", xformla = ~1, data = DataLong_Subs_sim, alp=.01
)

agg.simple <- aggte(example_attgt, type = "simple", na.rm = TRUE)
summary(agg.simple) #effect: 18.14        Std. Error: 3.6236     [ 99%  Conf. Int.]: 8.8062     27.4737 ****

#1.1.2.Dynamic Effects and Event Studies
agg.es <- aggte(example_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #effect 27.982        8.3811     6.3936     49.5703 *
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h2_N_patents_all.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H2) All quartiles - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Number of patents") + 
  xlab("Length of exposure") + 
  # ylim(-1, 4) +
  scale_color_manual(values=c("grey70","saddlebrown"),labels = c("Pre-treatment", "Post-treatment")) + 
  #labs(subtitle = "Effect on the number of patents")+
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

####2.1.1.1.Moderating effects (non-stand)
#The did package was not created aiming at testing moderating effects, so let's do it with a regular implementation:
# Create Create the Post-Treatment binary Variable
DataLong_Subs_sim$post_treatment <- ifelse(DataLong_Subs_sim$CurrentYear >= DataLong_Subs_sim$first.treat & 
                                               DataLong_Subs_sim$Group <= DataLong_Subs_sim$CurrentYear, 1, 0)

#Basic DiD model without the moderator for relatedness
model <- lm(Relatedness_Cos2 ~ treat * post_treatment, data = DataLong_Subs_sim)
summary(model) ##treat:post_treatment  1.3380***, post_treatment 1.2469***, treat 0.6618***, 

# Basic DiD model WITHOUT the moderator for innovative performance
model <- lm(NoPatentsYearGUOtotal ~ treat * post_treatment, data = DataLong_Subs_sim)
summary(model) #treat:post_treatment   29.473***, post_treatment 33.084*** , treat 4.478. 

# DiD model with Relatedness_Cos2 as a moderator 
model_moderation <- lm(NoPatentsYearGUOtotal ~ treat * post_treatment * Relatedness_Cos2, data = DataLong_Subs_sim)
summary(model_moderation) #treat:post_treatment -21.9771**, treat:post_treatment:Relatedness_Cos2 1.9468***,
#treat -18.7609***, post_treatment -2.4439 Relatedness_Cos2 6.1295***, 
#treat:Relatedness_Cos2 1.9534*** , post_treatment:Relatedness_Cos2 1.0060***, 

###2.1.2.Standardized - Relatedness and number of patents regardless of sector ------
DataLong_Subs_sim_standard <- DataLong_Subs_sim
DataLong_Subs_sim_standard[,c("Relatedness_Cos2", "NoPatentsYearGUOtotal")] <- 
  scale(DataLong_Subs_sim_standard[,c("Relatedness_Cos2", "NoPatentsYearGUOtotal")])

#Simple Aggregation Relatedness
example_attgt <- att_gt(yname = "Relatedness_Cos2", tname = "CurrentYear", idname = "id", gname = "first.treat",
                        xformla = ~1, data = DataLong_Subs_sim_standard, alp=.01)

agg.simple <- aggte(example_attgt, type = "simple", na.rm = TRUE)
summary(agg.simple) #effect: 0.0965  Std. Error: 0.0185   [ 99%  Conf. Int.]: 0.0489      0.1441 *

#Dynamic Effects and Event Studies
agg.es <- aggte(example_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #effect 0.118        0.0275     0.0471      0.1889 *
ggdid(agg.es) 

#Simple Aggregation Innovative Performance
example_attgt <- att_gt(yname = "NoPatentsYearGUOtotal", tname = "CurrentYear", idname = "id", gname = "first.treat",
                        xformla = ~1,data = DataLong_Subs_sim_standard, alp=.01)

agg.simple <- aggte(example_attgt, type = "simple", na.rm = TRUE)
summary(agg.simple) #effect: 0.0874        Std. Error: 0.0159     [ 99%  Conf. Int.]: 0.0466      0.1282 ***

#Dynamic Effects and Event Studies
agg.es <- aggte(example_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #effect 0.1348        0.0383     0.0363      0.2334 *
ggdid(agg.es) 

####2.1.2.1.Moderating effects (stand)
# Create Create the Post-Treatment binary Variable
DataLong_Subs_sim_standard$post_treatment <- ifelse(DataLong_Subs_sim_standard$CurrentYear >= DataLong_Subs_sim_standard$first.treat & 
                                             DataLong_Subs_sim_standard$Group <= DataLong_Subs_sim_standard$CurrentYear, 1, 0)

#Basic DiD model without the moderator for relatedness
model <- lm(Relatedness_Cos2 ~ treat * post_treatment, data = DataLong_Subs_sim_standard)
summary(model) ##treat:post_treatment  0.11958***, post_treatment 0.11143***, treat 0.05914*** 

# Basic DiD model WITHOUT the moderator for innovative performance
model <- lm(NoPatentsYearGUOtotal ~ treat * post_treatment, data = DataLong_Subs_sim_standard)
summary(model) #treat:post_treatment   0.142023***, post_treatment 0.159419*** , treat 0.021576. 

# DiD model with Relatedness_Cos2 as a moderator 
model_moderation <- lm(NoPatentsYearGUOtotal ~ treat * post_treatment * Relatedness_Cos2, data = DataLong_Subs_sim_standard)
summary(model_moderation) #treat:post_treatment 0.01644, treat:post_treatment:Relatedness_Cos2 0.10497***,
#treat 0.03235*, post_treatment 0.05144**, Relatedness_Cos2 0.33050***, 
#treat:Relatedness_Cos2 0.10533*** , post_treatment:Relatedness_Cos2 0.05425**, 

##2.2. Measuring effects across sectors -----
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

DataLong_Subs_sim <-read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",")
dynamic_capabilities <- read.csv("Input_code/Big_files_ignore/df_dynamic_capabilities.csv", header = TRUE)
names(dynamic_capabilities)[names(dynamic_capabilities) == 'Year'] <- 'CurrentYear'
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, dynamic_capabilities, by=c("Company", "CurrentYear"))

length(unique(DataLong_Subs_sim$id)) #2514 ids 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

table(is.na(DataLong_Subs_sim$AIcodes)) #13607 F, 21589   T

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0
table(is.na(DataLong_Subs_sim$AIcodes)) #35196 F

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096        F  2100      T
table(DataLong_Subs_sim$Quartile) #bottom 9380              medium  11004            top 12712      

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196 F
table(DataLong_Subs_sim$Quartile) #bottom 11480             medium  11004            top 12712     

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740    medium   5502    top 6356 
table(nontreat_test$Quartile) #bottom 5740    medium   5502    top 6356 
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410                    medium  393                      top 454     
rm(treat_test, nontreat_test)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

#define the possible variables
variables = c("Relatedness_Cos2", #relatedness
              "NoPatentsYearGUOtotal", #innovative performance
              "Specializations_Usage", #usage of specializations
              "HigherUsage", #most used technology
              "Specializations_Number", #number of specializations
              "UniqueCodes", #for Sections
              "UniqueSubclass", #for 4-digit
              "Herfindahl",
              "Shannon",
              "AIcodes", #effect on the 5 codes most related to AI
              "No_AI_PatentsYearGUOtotal",#effect on number of AI patents
              "Dynamic_capabilities") #the share of codes that changed from one year to the other 

###2.2.1.Calculate the effects Non-standardized -----
####2.2.1.1.Relatedness----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                        yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

####2.2.1.2.Innovative performance----
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

####2.2.1.2.00.NEW DYNAMIC CAPABILITIES ----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

####2.2.1.3.Usage of specializations----
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.4.Most used technology----
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.5.Number of specializations----
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.6.Number of sections ----
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.7.Number of subclasses----
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.8.Herfindahl index----
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.9.Shannon index----
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Shannon = replace_na(Shannon, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Shannon = replace_na(Shannon, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.10.Number AI codes----
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.11. Number of AI patents----
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #1.7991        0.1562     1.4929      2.1053 *
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand.xlsx", rowNames = F) #Results_Effects_non_stand.xlsx with dyn capabilities now
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_WITH_DYN_CAP.xlsx", rowNames = F) 
rm(results_df)

###2.2.2.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

####2.2.2.1.Relatedness
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

####2.2.2.2.Innovative performance
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

####2.2.2.2.00. NEW DYNAMIC CAPABILITIES
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

####2.2.2.3.Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.2.4.Most used technology
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.2.5.Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.2.6.Number of sections 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.2.7.Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.2.8.Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.2.9.Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.2.10.Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.2.11. Number of AI patents
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_stand.xlsx", rowNames = F)
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_tand_WITH_DYN_CAP.xlsx", rowNames = F)

#3.Descriptive statistics and correlations-----
rm(list=ls())
FinalDataset <- read.csv("Input_code/Data_all_years_all_MNEs.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
FinalDataset$Nace_4d <- as.character(FinalDataset$Nace_4d)
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance

FinalDataset <- left_join(FinalDataset,CategoriesNace, by = "Nace_4d")
table(is.na(FinalDataset$Quartile)) #476620 F; 62820 T
table(FinalDataset$Quartile) #bottom 213880  medium  175220  top 87520     

FinalDataset$Quartile[is.na(FinalDataset$Quartile)] <- "bottom"
table(is.na(FinalDataset$Quartile)) #539440  
table(FinalDataset$Quartile) #bottom 276700     medium 175220       top 87520 

dynamic_capabilities <- read.csv("Input_code/Big_files_ignore/df_dynamic_capabilities.csv", header = TRUE)
names(dynamic_capabilities)[names(dynamic_capabilities) == 'Year'] <- 'CurrentYear'
FinalDataset <- left_join(FinalDataset, dynamic_capabilities, by=c("Company", "CurrentYear"))

##3.1.Statistics All data------
#pick just one year of analysis:
FinalDataset_2019 <- FinalDataset[FinalDataset$CurrentYear== 2019,]
FinalDataset_summary <- FinalDataset_2019[,c("Relatedness_Cos2", "NoSubs_calculated", "NoSubsWithPatents", "Size_class", 
                                        "NoPatentsYearGUOtotal", "No_AI_PatentsYearGUOtotal","No_employees_Year",
                                        "Date_Incorporation", "Specializations_Usage", "HigherUsage", "Specializations_Number",
                                        "Herfindahl", "Shannon", "Quartile",
                                        "UniqueCodes", "UniqueSubclass", "Dynamic_capabilities")] 

#group test for Size_class
st(FinalDataset_summary, title = "Variables Size_class", group = "Size_class",  group.test = TRUE)
Size_class <- st(FinalDataset_summary, group = "Size_class",  group.test = TRUE,
                 summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'), out = 'return')

Quartile <- st(FinalDataset_summary, group = "Quartile",  group.test = TRUE,
               summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'), out = 'return')

write.csv2(Size_class, file = "Output_code/Data/Descriptive_statistics_all_MNEs_by_Size_class.csv", row.names = F) #from now on, the addition of _new means that the complexity and relatedness of
write.csv2(Quartile, file = "Output_code/Data/Descriptive_statistics_all_MNEs_by_Quartile.csv", row.names = F) #from now on, the addition of _new means that the complexity and relatedness of
rm(Size_class, Quartile, CategoriesNace)

##3.2.Statistics matched data-----
DataLong_Subs_2006 <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
DataLong_Subs_2006 <- left_join(DataLong_Subs_2006, dynamic_capabilities, by=c("Company", "CurrentYear"))

length(unique(DataLong_Subs_2006$subclass)) #1257
length(unique(DataLong_Subs_2006$Company)) #2390

#get the mean of the last 5 years
DataLong_Subs_2006 %<>% group_by(Company, subclass) %>% 
  mutate(across(NoPatentsYearGUOtotal,
                .fns = list(avg = ~ rollmean(.,k=5,fill=NA,align = 'center'))))

#new: Relatedness_lagged 
DataLong_Subs_2006 %<>% group_by(Company, subclass) %>% 
  mutate(NoPatentsYearGUOtotal_avg_fixed = lag(NoPatentsYearGUOtotal_avg)) %>% 
  mutate(Relatedness_lagged = lag(Relatedness_Cos2)) 

DataLong_Subs_2006 <- subset(DataLong_Subs_2006, select = -c(NoPatentsYearGUOtotal_avg) )

table(DataLong_Subs_2006$Group)

#pick the variables of interest from FinalDataset and merge them with DataLong_Subs_2006 by CurrentYear and Company
For_Match <- FinalDataset[,c("Company","CurrentYear","Quartile", "HigherUsage","Specializations_Usage", "Specializations_Number","Shannon","Herfindahl","NoSubs_calculated", "NoSubsWithPatents", "No_employees_Year",
                             "UniqueCodes", "UniqueSubclass", "Dynamic_capabilities")] #new 
DataLong_Subs_2006 <- left_join(DataLong_Subs_2006, For_Match, by=c("Company","CurrentYear"),na_matches="never")
rm(For_Match)

DataLong_Subs_2006 %<>% group_by(Company, subclass) %>% 
  mutate(N_specializations_lagged = lag(Specializations_Number.x)) 

DataLong_Subs_2006_summary <- DataLong_Subs_2006[,c("Relatedness_Cos2", "Size_class", "NoPatentsYearGUOtotal", "No_AI_PatentsYearGUOtotal",
                                                    "Company","treat","Date_Incorporation", "Group", "CurrentYear", 
                                                    "NoPatentsYearGUOtotal_avg_fixed", "Nace_4d", "YearFirstAdoption",
                                                    "HigherUsage.x","Specializations_Usage.x", "Specializations_Number.x","Shannon.x","Herfindahl.x","NoSubs_calculated", "NoSubsWithPatents",
                                                    "Quartile", "No_employees_Year",
                                                    "Relatedness_lagged", "N_specializations_lagged", 
                                                    "UniqueCodes.x", "UniqueSubclass.x", "Dynamic_capabilities.x" )] 

DataLong_Subs_2006_summary <- DataLong_Subs_2006_summary[DataLong_Subs_2006_summary$Group == DataLong_Subs_2006_summary$CurrentYear,]

test <- DataLong_Subs_2006_summary[,c("Company","Group")]
length(unique(test$Company)) #2390
rm(test)

DataLong_Subs_2006_summary <- subset(DataLong_Subs_2006_summary, select = -c(Company, Group,  YearFirstAdoption, Nace_4d) )#, "CurrentYear"

st(DataLong_Subs_2006_summary,  group = "treat",  group.test = TRUE) #title = "Treatment differences",

table(DataLong_Subs_2006_summary$CurrentYear) #from 2011 to 2019
Treated_2011 <- DataLong_Subs_2006_summary[DataLong_Subs_2006_summary$CurrentYear != 2011,]
Treated_2019 <- DataLong_Subs_2006_summary[DataLong_Subs_2006_summary$CurrentYear != 2019,]

st(Treated_2011,  group = "treat",  group.test = TRUE,
   summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'))
#so, when the 2011 group is excluded, there is no sign diff in the number of patents anymore!
rm(Treated_2011, Treated_2019)

st(DataLong_Subs_2006_summary,  group = "treat",  group.test = TRUE,
   summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'))

Treated <- st(DataLong_Subs_2006_summary,  group = "treat",  group.test = TRUE,
              summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'), out = 'return')

Quartile <- st(DataLong_Subs_2006_summary,  group = "Quartile",  group.test = TRUE,
               summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'), out = 'return')
Size_class <- st(DataLong_Subs_2006_summary,  group = "Size_class",  group.test = TRUE,
                 summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'), out = 'return')

write.csv2(Treated, file = "Output_code/Data/Descriptive_statistics_matched_companies_Treated.csv", row.names = F) #from now on, the addition of _new means that the complexity and relatedness of
write.csv2(Quartile, file = "Output_code/Data/Descriptive_statistics_matched_companies_Quartile.csv", row.names = F) #from now on, the addition of _new means that the complexity and relatedness of
write.csv2(Size_class, file = "Output_code/Data/Descriptive_statistics_matched_companies_Size_class.csv", row.names = F) #from now on, the addition of _new means that the complexity and relatedness of

##3.3.Analyse correlations-----
#For the matched sample
data_normalized <- DataLong_Subs_2006_summary[,c("Relatedness_Cos2", "HigherUsage.x", "Specializations_Usage.x", "Specializations_Number.x",
                                                 "Date_Incorporation","No_AI_PatentsYearGUOtotal", "NoPatentsYearGUOtotal")] 

names(data_normalized) <- c("Relatedness", "Usage of main code", "Usage of specializations",
                            "N. of specializations","Date of incorporation", "N. of AI patents","N. of patents") 
data_normalized <- scale(data_normalized)
corr_matrix <- cor(na.omit(data_normalized))

jpeg("Output_code/Figures/Correlation_table_matched_companies.jpg", width = 15, height = 12, units = 'in', res = 300)
ggcorrplot(corr_matrix, legend.title = "Correlation", hc.order=F,lab = TRUE, lab_size = 8)+
  theme(axis.text.x=element_text(size=25),axis.text.y=element_text(size=25), legend.key.size = unit(1.5, 'cm'),
        legend.title = element_text(size=24), legend.text = element_text(size=20))
dev.off()

#For the whole dataset 
data_normalized <- FinalDataset_2019[,c("Relatedness_Cos2", "HigherUsage", "Specializations_Usage", "Specializations_Number",
                                   "Date_Incorporation","No_AI_PatentsYearGUOtotal", "NoPatentsYearGUOtotal")] 

names(data_normalized) <- c("Relatedness", "Usage of main code", "Usage of specializations",
                            "N. of specializations","Date of incorporation", "N. of AI patents","N. of patents") 
data_normalized <- scale(data_normalized)
corr_matrix <- cor(na.omit(data_normalized))
jpeg("Output_code/Figures/Correlation_table_all_companies.jpg", width = 15, height = 12, units = 'in', res = 300)
ggcorrplot(corr_matrix, legend.title = "Correlation", hc.order=F,lab = TRUE, lab_size = 8)+
  theme(axis.text.x=element_text(size=25),axis.text.y=element_text(size=25), legend.key.size = unit(1.5, 'cm'),
        legend.title = element_text(size=24), legend.text = element_text(size=20))
dev.off()


#NEW - STRONG AI -----
#3.Measuring effects-----
##3.1.Overall-----
###3.1.1.Non-standard - Relatedness and number of patents regardless of sector  ----
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Big_files_ignore/Matched_companies_strongAI.csv", sep = ";", header = TRUE, dec=",") #

#1.1.1.Simple Aggregation Relatedness
example_attgt <- att_gt(yname = "Relatedness_Cos2", tname = "CurrentYear", idname = "id",
                        gname = "first.treat", xformla = ~1, data = DataLong_Subs_sim, alp=.05
)

agg.simple <- aggte(example_attgt, type = "simple", na.rm = TRUE)
summary(agg.simple) #effect: 2.7056                       Std. Error: 1.0005         [ 95%  Conf. Int.]: 0.7447      4.6665 **

#1.1.2.Dynamic Effects and Event Studies
agg.es <- aggte(example_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #effect 3.5337        2.0067    -0.3994      7.4667 

ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h1_Relatedness_all.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H1) All quartiles - Relatedness") + theme(legend.position="right") +   ylab("Knowledge-relatedness") + 
  xlab("Length of exposure") + scale_color_manual(values=c("grey70","orange"),labels = c("Pre-treatment", "Post-treatment")) + 
  geom_vline(xintercept = 0, linetype="dotted", color = "black", size=1, alpha = 0.3)
#dev.off()

#Simple Aggregation Innovative performance
example_attgt <- att_gt(yname = "NoPatentsYearGUOtotal", tname = "CurrentYear", idname = "id", 
                        gname = "first.treat", xformla = ~1, data = DataLong_Subs_sim, alp=.1
)

agg.simple <- aggte(example_attgt, type = "simple", na.rm = TRUE)
summary(agg.simple) #effect: 18.14        Std. Error: 3.6236     [ 90%  Conf. Int.]: -2.2656     16.5968 

#1.1.2.Dynamic Effects and Event Studies
agg.es <- aggte(example_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #effect 11.3677        8.7556     -3.034     25.7693 
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h2_N_patents_all.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H2) All quartiles - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Number of patents") + 
  xlab("Length of exposure") + 
  # ylim(-1, 4) +
  scale_color_manual(values=c("grey70","saddlebrown"),labels = c("Pre-treatment", "Post-treatment")) + 
  #labs(subtitle = "Effect on the number of patents")+
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####3.1.1.1.Moderating effects (non-stand)
#The did package was not created aiming at testing moderating effects, so let's do it with a regular implementation:
# Create Create the Post-Treatment binary Variable
DataLong_Subs_sim$post_treatment <- ifelse(DataLong_Subs_sim$CurrentYear >= DataLong_Subs_sim$first.treat & 
                                             DataLong_Subs_sim$Group <= DataLong_Subs_sim$CurrentYear, 1, 0)

#Basic DiD model without the moderator for relatedness
model <- lm(Relatedness_Cos2 ~ treat * post_treatment, data = DataLong_Subs_sim)
summary(model) ##treat:post_treatment  2.5487**, post_treatment < 4.9194***, treat 1.9382***, 

# Basic DiD model WITHOUT the moderator for innovative performance
model <- lm(NoPatentsYearGUOtotal ~ treat * post_treatment, data = DataLong_Subs_sim)
summary(model) #treat:post_treatment   2.7012, post_treatment 15.8546*** , treat -0.1057 

# DiD model with Relatedness_Cos2 as a moderator 
model_moderation <- lm(NoPatentsYearGUOtotal ~ treat * post_treatment * Relatedness_Cos2, data = DataLong_Subs_sim)
summary(model_moderation) #treat:post_treatment 2.6542, treat:post_treatment:Relatedness_Cos2 -0.6327**,
#treat 0.6940, post_treatment -6.0963** Relatedness_Cos2 1.0410***, 
#treat:Relatedness_Cos2 -0.2309 , post_treatment:Relatedness_Cos2 1.7740***, 

###3.1.2.Standardized - Relatedness and number of patents regardless of sector ------
DataLong_Subs_sim_standard <- DataLong_Subs_sim
DataLong_Subs_sim_standard[,c("Relatedness_Cos2", "NoPatentsYearGUOtotal")] <- 
  scale(DataLong_Subs_sim_standard[,c("Relatedness_Cos2", "NoPatentsYearGUOtotal")])

#Simple Aggregation Relatedness
example_attgt <- att_gt(yname = "Relatedness_Cos2", tname = "CurrentYear", idname = "id", gname = "first.treat",
                        xformla = ~1, data = DataLong_Subs_sim_standard, alp=.05)

agg.simple <- aggte(example_attgt, type = "simple", na.rm = TRUE)
summary(agg.simple) #effect: 0.3181    Std. Error: 0.1224    [ 95%  Conf. Int.]: 0.0782      0.5579 *

#Dynamic Effects and Event Studies
agg.es <- aggte(example_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #effect 0.4154        0.2485    -0.0717      0.9025 
ggdid(agg.es) 

#Simple Aggregation Innovative Performance
example_attgt <- att_gt(yname = "NoPatentsYearGUOtotal", tname = "CurrentYear", idname = "id", gname = "first.treat",
                        xformla = ~1,data = DataLong_Subs_sim_standard, alp=.1)

agg.simple <- aggte(example_attgt, type = "simple", na.rm = TRUE)
summary(agg.simple) #effect: 0.3047            Std. Error: 0.2366        [ 90%  Conf. Int.]: -0.0846      0.6939 

#Dynamic Effects and Event Studies
agg.es <- aggte(example_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #effect0.4834        0.3963    -0.1685      1.1352 
ggdid(agg.es) 

####3.1.2.1.Moderating effects (stand)
# Create Create the Post-Treatment binary Variable
DataLong_Subs_sim_standard$post_treatment <- ifelse(DataLong_Subs_sim_standard$CurrentYear >= DataLong_Subs_sim_standard$first.treat & 
                                                      DataLong_Subs_sim_standard$Group <= DataLong_Subs_sim_standard$CurrentYear, 1, 0)

#Basic DiD model without the moderator for relatedness
model <- lm(Relatedness_Cos2 ~ treat * post_treatment, data = DataLong_Subs_sim_standard)
summary(model) ##treat:post_treatment  0.29960**, post_treatment 0.57829***, treat 0.22784*** 

# Basic DiD model WITHOUT the moderator for innovative performance
model <- lm(NoPatentsYearGUOtotal ~ treat * post_treatment, data = DataLong_Subs_sim_standard)
summary(model) #treat:post_treatment   0.114855, post_treatment 0.674140*** , treat -0.004494 

# DiD model with Relatedness_Cos2 as a moderator 
model_moderation <- lm(NoPatentsYearGUOtotal ~ treat * post_treatment * Relatedness_Cos2, data = DataLong_Subs_sim_standard)
summary(model_moderation) #treat:post_treatment -0.08654, treat:post_treatment:Relatedness_Cos2 -0.22886**,
#treat -0.09918*, post_treatment 0.29984***, Relatedness_Cos2 0.37655***, 
#treat:Relatedness_Cos2 -0.08352, post_treatment:Relatedness_Cos2 0.64168***, 

##3.2. Measuring effects across sectors -----
rm(list=ls())
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

DataLong_Subs_sim <-read.csv("Input_code/Big_files_ignore/Matched_companies_StrongAI.csv", sep = ";", header = TRUE, dec=",")
dynamic_capabilities <- read.csv("Input_code/Big_files_ignore/df_dynamic_capabilities.csv", header = TRUE)
names(dynamic_capabilities)[names(dynamic_capabilities) == 'Year'] <- 'CurrentYear'
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, dynamic_capabilities, by=c("Company", "CurrentYear"))

#replace NA values by 0
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(Dynamic_capabilities = replace_na(Dynamic_capabilities, 0))

DataLong_Subs_sim2 <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
test <- DataLong_Subs_sim[DataLong_Subs_sim$Company == "US272992077",]
sum(test$Relatedness_Cos2)
test2 <- DataLong_Subs_sim2[DataLong_Subs_sim2$Company == "US272992077",]
sum(test2$Relatedness_Cos2) #its correct!

# Identify columns in DataLong_Subs_sim
columns_in_sim <- colnames(DataLong_Subs_sim)

# Select columns from DataLong_Subs_sim2 that are not in DataLong_Subs_sim, plus Company and CurrentYear
DataLong_Subs_sim2_selected <- DataLong_Subs_sim2 %>%
  select(any_of(c("Company", "CurrentYear", setdiff(colnames(DataLong_Subs_sim2), columns_in_sim))))

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, DataLong_Subs_sim2_selected, by = c("Company", "CurrentYear"))
rm(DataLong_Subs_sim2_selected, columns_in_sim, DataLong_Subs_sim2, test, test2)

length(unique(DataLong_Subs_sim$id)) #126 ids 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

table(is.na(DataLong_Subs_sim$AIcodes)) #490   F, 1274    T
#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0
table(is.na(DataLong_Subs_sim$AIcodes)) #1764  F

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #1764 F
table(DataLong_Subs_sim$Quartile) #bottom 252                  medium  196               top 1316       

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #1764 F
table(DataLong_Subs_sim$Quartile) #bottom 252                  medium  196               top 1316   

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 126         medium   98        top 658  
table(nontreat_test$Quartile) #bottom 126         medium   98        top 658  
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 9               medium  7                      top 47     
rm(treat_test, nontreat_test)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

#define the possible variables
variables = c("Relatedness_Cos2", #relatedness
              "NoPatentsYearGUOtotal", #innovative performance
              "Specializations_Usage", #usage of specializations
              "HigherUsage", #most used technology
              "Specializations_Number", #number of specializations
              "UniqueCodes", #for Sections
              "UniqueSubclass", #for 4-digit
              "Herfindahl",
              "Shannon",
              "AIcodes", #effect on the 5 codes most related to AI
              "No_AI_PatentsYearGUOtotal",#effect on number of AI patents
              "Dynamic_capabilities") #the share of codes that changed from one year to the other 

###3.2.1.Calculate the effects Non-standardized -----
####3.2.1.1.Relatedness----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####3.2.1.2.Innovative performance----
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####3.2.1.2.00.NEW DYNAMIC CAPABILITIES ----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
#variable_n
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####3.2.1.3.Usage of specializations----
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.1.4.Most used technology----
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.1.5.Number of specializations----
#Group 1

variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.1.6.Number of sections ----
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.1.7.Number of subclasses----
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.1.8.Herfindahl index----
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.1.9.Shannon index----
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.1.10.Number AI codes----
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.1.18. Number of AI patents----
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #1.7991        0.1562     1.4929      2.1053 *
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand.xlsx", rowNames = F) #Results_Effects_non_stand.xlsx with dyn capabilities now
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_WITH_DYN_CAP.xlsx", rowNames = F) 
rm(results_df)

###3.2.2.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

####3.2.2.1.Relatedness
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

####3.2.2.2.Innovative performance
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

####3.2.2.2.00. NEW DYNAMIC CAPABILITIES
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

####3.2.2.3.Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.2.4.Most used technology
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.2.5.Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.2.6.Number of sections 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.2.7.Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.2.8.Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.2.9.Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.2.10.Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####3.2.2.11. Number of AI patents
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_tand_WITH_DYN_CAP_StrongAI.xlsx", rowNames = F)

#4.Measuring effects normal one-----
##4.2. Measuring effects across sectors -----
rm(list=ls())
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim <- DataLong_Subs_sim[,c(1:15, 26:52)]

DataLong_Subs_sim$Rate_granted <- DataLong_Subs_sim$n_granted_yes/(DataLong_Subs_sim$n_granted_na+DataLong_Subs_sim$n_granted_yes) 
DataLong_Subs_sim$Rate_granted_NoNAI <- DataLong_Subs_sim$n_granted_yes_nonai/(DataLong_Subs_sim$n_granted_na_nonai+DataLong_Subs_sim$n_granted_yes_nonai) 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096   F
table(DataLong_Subs_sim$Quartile) #bottom 9380                    medium  11004                 top 12712        

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196  F
table(DataLong_Subs_sim$Quartile) #bottom 11480                    medium  11004                 top 12712    

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740            medium   5502           top 6356   
table(nontreat_test$Quartile) #bottom 5740            medium   5502           top 6356   
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410      medium  393                         top 454      
rm(treat_test, nontreat_test)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

head(Patent_data)
rm(RCA_All_Years, Patent_data)

#define the possible variables
variables = c("Rate_granted", #rate of granted patents
              "n_granted_yes_ai", #rate of AI granted patents
              "n_granted_na_ai", #rate of AI not granted patents
              "avg_claims", #most used technology
              "avg_number_of_family_members", #number of specializations
              "avg_backward_citations", #for Sections
              "avg_forward_citations", #for 4-digit
              "avg_time_filing_to_publication",
              "avg_time_filing_to_grant",
              "avg_backward_citations_ai",
              "avg_forward_citations_ai",
              "avg_claims_ai",
              "avg_number_of_family_members_ai",
              "avg_time_filing_to_publication_ai",
              "avg_time_filing_to_grant_ai",
              "avg_time_filing_to_publication_NONai",
              "avg_time_filing_to_grant_NONai",
              "Rate_granted_NoNAI","n_granted_yes_nonai", "n_granted_na_nonai", "avg_number_of_family_members_nonai", 
              "avg_claims_nonai", "avg_backward_citations_nonai", "avg_forward_citations_nonai",
              "n_granted_na", "n_granted_yes") 

###4.2.1.Calculate the effects Non-standardized -----
####4.2.1.1.Rate_granted----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####4.2.1.2.n_granted_yes_ai----
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####4.2.1.3.n_granted_na_ai----
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.4.avg_claims----
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.5.avg_number_of_family_members----
#Group 1

variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.6.avg_backward_citations ----
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.7.avg_forward_citations----
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.8.avg_time_filing_to_publication----
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.9.avg_time_filing_to_grant----
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.10.avg_backward_citations_ai----
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.11.avg_forward_citations_ai ----
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.12. avg_claims_ai ----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.13. avg_number_of_family_members_ai  ----
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.14. avg_time_filing_to_publication_ai  ----
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.15. avg_time_filing_to_grant_ai  ----
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.16. avg_time_filing_to_publication_NONai  ----
#Group 1
variable_n = 16
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.17. avg_time_filing_to_grant_NONai  ----
#Group 1
variable_n = 17
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.18. Rate_granted_NoNAI  ----
#Group 1
variable_n = 18
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.19. n_granted_yes_nonai  ----
#Group 1
variable_n = 19
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.20. n_granted_na_nonai  ----
#Group 1
variable_n = 20
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.21. avg_number_of_family_members_nonai  ----
#Group 1
variable_n = 21
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.22. avg_claims_nonai  ----
#Group 1
variable_n = 22
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.23. avg_backward_citations_nonai  ----
#Group 1
variable_n = 23
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.24. avg_forward_citations_nonai  ----
#Group 1
variable_n = 24
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.25. n_granted_na  ----
#Group 1
variable_n = 25
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.1.26. n_granted_yes  ----
#Group 1
variable_n = 26
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group1",
                                          "DataLong_Subs_sim_group2",
                                          "DataLong_Subs_sim_group3"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_new_patent_specific.xlsx", rowNames = F) 
rm(results_df)

###4.2.2.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_number_of_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai",
                            "avg_time_filing_to_publication_NONai", "avg_time_filing_to_grant_NONai",
                            "Rate_granted_NoNAI","n_granted_yes_nonai", "n_granted_na_nonai", "avg_number_of_family_members_nonai", 
                            "avg_claims_nonai", "avg_backward_citations_nonai", "avg_forward_citations_nonai",
                            "n_granted_na", "n_granted_yes")] <- 
  scale(DataLong_Subs_sim_group1[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_number_of_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai",
                                    "avg_time_filing_to_publication_NONai", "avg_time_filing_to_grant_NONai",
                                    "Rate_granted_NoNAI","n_granted_yes_nonai", "n_granted_na_nonai", "avg_number_of_family_members_nonai", 
                                    "avg_claims_nonai", "avg_backward_citations_nonai", "avg_forward_citations_nonai",
                                    "n_granted_na", "n_granted_yes")])

DataLong_Subs_sim_group2[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_number_of_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai",
                            "avg_time_filing_to_publication_NONai", "avg_time_filing_to_grant_NONai",
                            "Rate_granted_NoNAI","n_granted_yes_nonai", "n_granted_na_nonai", "avg_number_of_family_members_nonai", 
                            "avg_claims_nonai", "avg_backward_citations_nonai", "avg_forward_citations_nonai",
                            "n_granted_na", "n_granted_yes")] <- 
  scale(DataLong_Subs_sim_group2[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_number_of_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai",
                                    "avg_time_filing_to_publication_NONai", "avg_time_filing_to_grant_NONai",
                                    "Rate_granted_NoNAI","n_granted_yes_nonai", "n_granted_na_nonai", "avg_number_of_family_members_nonai", 
                                    "avg_claims_nonai", "avg_backward_citations_nonai", "avg_forward_citations_nonai",
                                    "n_granted_na", "n_granted_yes")])

DataLong_Subs_sim_group3[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_number_of_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai",
                            "avg_time_filing_to_publication_NONai", "avg_time_filing_to_grant_NONai",
                            "Rate_granted_NoNAI","n_granted_yes_nonai", "n_granted_na_nonai", "avg_number_of_family_members_nonai", 
                            "avg_claims_nonai", "avg_backward_citations_nonai", "avg_forward_citations_nonai",
                            "n_granted_na", "n_granted_yes")] <- 
  scale(DataLong_Subs_sim_group3[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_number_of_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai",
                                    "avg_time_filing_to_publication_NONai", "avg_time_filing_to_grant_NONai",
                                    "Rate_granted_NoNAI","n_granted_yes_nonai", "n_granted_na_nonai", "avg_number_of_family_members_nonai", 
                                    "avg_claims_nonai", "avg_backward_citations_nonai", "avg_forward_citations_nonai",
                                    "n_granted_na", "n_granted_yes")])

####4.2.2.1.Rate_granted
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

####4.2.2.2.n_granted_yes_ai
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

####4.2.2.3.n_granted_na_ai
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.4.avg_claims
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.5.avg_number_of_family_members
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.6.avg_backward_citations 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.7.avg_forward_citations
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.8.avg_time_filing_to_publication
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.9.avg_time_filing_to_grant
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.10.avg_backward_citations_ai
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.11.avg_forward_citations_ai 
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.12. avg_claims_ai 
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.13. avg_number_of_family_members_ai  
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.14. avg_time_filing_to_publication_ai  
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.15. avg_time_filing_to_grant_ai  
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.16. avg_time_filing_to_publication_NONai  
#Group 1
variable_n = 16
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.17. avg_time_filing_to_grant_NONai  
#Group 1
variable_n = 17
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.18. Rate_granted_NoNAI  
#Group 1
variable_n = 18
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.19. n_granted_yes_nonai  
#Group 1
variable_n = 19
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.20. n_granted_na_nonai  
#Group 1
variable_n = 20
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.21. avg_number_of_family_members_nonai  
#Group 1
variable_n = 21
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.22. avg_claims_nonai  
#Group 1
variable_n = 22
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.23. avg_backward_citations_nonai  
#Group 1
variable_n = 23
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.24. avg_forward_citations_nonai  
#Group 1
variable_n = 24
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.25. n_granted_na  
#Group 1
variable_n = 25
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####4.2.2.26. n_granted_yes  
#Group 1
variable_n = 26
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group1",
                                          "DataLong_Subs_sim_group2",
                                          "DataLong_Subs_sim_group3"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_new_patent_specific.xlsx", rowNames = F) 

#5.Measuring effects NEW PATENTS EXCLUSIVELY-----
##5.2. Measuring effects across sectors -----
rm(list=ls())
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_NEW_PATENTS.csv", header = TRUE) #

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim <- DataLong_Subs_sim[,c(1:15, 26:44)]

DataLong_Subs_sim$Rate_granted <- DataLong_Subs_sim$n_granted_yes/(DataLong_Subs_sim$n_granted_na+DataLong_Subs_sim$n_granted_yes) 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096   F
table(DataLong_Subs_sim$Quartile) #bottom 9380                    medium  11004                 top 12712        

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196  F
table(DataLong_Subs_sim$Quartile) #bottom 11480                    medium  11004                 top 12712    

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740            medium   5502           top 6356   
table(nontreat_test$Quartile) #bottom 5740            medium   5502           top 6356   
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410      medium  393                         top 454      
rm(treat_test, nontreat_test)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

head(Patent_data)
rm(RCA_All_Years, Patent_data)

#define the possible variables
variables = c("Rate_granted", #rate of granted patents
              "n_granted_yes_ai", #rate of AI granted patents
              "n_granted_na_ai", #rate of AI not granted patents
              "avg_claims", #most used technology
              "avg_family_members", #number of specializations
              "avg_backward_citations", #for Sections
              "avg_forward_citations", #for 4-digit
              "avg_time_filing_to_publication",
              "avg_time_filing_to_grant",
              "avg_backward_citations_ai",
              "avg_forward_citations_ai",
              "avg_claims_ai",
              "avg_number_of_family_members_ai",
              "avg_time_filing_to_publication_ai",
              "avg_time_filing_to_grant_ai") 

###5.2.1.Calculate the effects Non-standardized -----
####5.2.1.1.Rate_granted----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####5.2.1.2.n_granted_yes_ai----
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####5.2.1.3.n_granted_na_ai----
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.4.avg_claims----
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.5.avg_family_members----
#Group 1

variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.6.avg_backward_citations ----
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.7.avg_forward_citations----
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.8.avg_time_filing_to_publication----
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.9.avg_time_filing_to_grant----
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.10.avg_backward_citations_ai----
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.11.avg_forward_citations_ai ----
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.12. avg_claims_ai ----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.13. avg_number_of_family_members_ai  ----
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.14. avg_time_filing_to_publication_ai  ----
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.1.15. avg_time_filing_to_grant_ai  ----
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_new_patent_specific_NEW_PATENTS.xlsx", rowNames = F) 
rm(results_df)

###5.2.2.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")] <- 
  scale(DataLong_Subs_sim_group1[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")])

DataLong_Subs_sim_group2[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")] <- 
  scale(DataLong_Subs_sim_group2[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")])

DataLong_Subs_sim_group3[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")] <- 
  scale(DataLong_Subs_sim_group3[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")])

####5.2.2.1.Rate_granted
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

####5.2.2.2.n_granted_yes_ai
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

####5.2.2.3.n_granted_na_ai
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.4.avg_claims
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.5.avg_family_members
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.6.avg_backward_citations 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.7.avg_forward_citations
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.8.avg_time_filing_to_publication
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.9.avg_time_filing_to_grant
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.10.avg_backward_citations_ai
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.11.avg_forward_citations_ai 
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.12. avg_claims_ai 
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.13. avg_number_of_family_members_ai  
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.14. avg_time_filing_to_publication_ai  
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####5.2.2.15. avg_time_filing_to_grant_ai  
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_new_patent_specific_NEW_PATENTS.xlsx", rowNames = F) 

#6.Measuring effects SUBSIDIARIES-----
##6.2. Measuring effects across sectors -----
rm(list=ls())
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_subsidiaries.csv", header = TRUE) #

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim <- DataLong_Subs_sim[,c(1:15, 26:44)]

DataLong_Subs_sim$Rate_granted <- DataLong_Subs_sim$n_granted_yes/(DataLong_Subs_sim$n_granted_na+DataLong_Subs_sim$n_granted_yes) 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096   F
table(DataLong_Subs_sim$Quartile) #bottom 9380                    medium  11004                 top 12712        

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196  F
table(DataLong_Subs_sim$Quartile) #bottom 11480                    medium  11004                 top 12712    

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740            medium   5502           top 6356   
table(nontreat_test$Quartile) #bottom 5740            medium   5502           top 6356   
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410      medium  393                         top 454      
rm(treat_test, nontreat_test)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

head(Patent_data)
rm(RCA_All_Years, Patent_data)

#define the possible variables
variables = c("Rate_granted", #rate of granted patents
              "n_granted_yes_ai", #rate of AI granted patents
              "n_granted_na_ai", #rate of AI not granted patents
              "avg_claims", #most used technology
              "avg_family_members", #number of specializations
              "avg_backward_citations", #for Sections
              "avg_forward_citations", #for 4-digit
              "avg_time_filing_to_publication",
              "avg_time_filing_to_grant",
              "avg_backward_citations_ai",
              "avg_forward_citations_ai",
              "avg_claims_ai",
              "avg_number_of_family_members_ai",
              "avg_time_filing_to_publication_ai",
              "avg_time_filing_to_grant_ai") 

###6.2.1.Calculate the effects Non-standardized -----
####6.2.1.1.Rate_granted----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####6.2.1.2.n_granted_yes_ai----
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####6.2.1.3.n_granted_na_ai----
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.4.avg_claims----
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.5.avg_family_members----
#Group 1

variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.6.avg_backward_citations ----
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.7.avg_forward_citations----
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.8.avg_time_filing_to_publication----
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.9.avg_time_filing_to_grant----
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.10.avg_backward_citations_ai----
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.11.avg_forward_citations_ai ----
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.12. avg_claims_ai ----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.13. avg_number_of_family_members_ai  ----
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.14. avg_time_filing_to_publication_ai  ----
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.1.15. avg_time_filing_to_grant_ai  ----
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_new_patent_specific_subsidiaries.xlsx", rowNames = F) 
rm(results_df)

###6.2.2.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")] <- 
  scale(DataLong_Subs_sim_group1[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")])

DataLong_Subs_sim_group2[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")] <- 
  scale(DataLong_Subs_sim_group2[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")])

DataLong_Subs_sim_group3[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")] <- 
  scale(DataLong_Subs_sim_group3[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")])

####6.2.2.1.Rate_granted
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

####6.2.2.2.n_granted_yes_ai
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

####6.2.2.3.n_granted_na_ai
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.4.avg_claims
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.5.avg_family_members
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.6.avg_backward_citations 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.7.avg_forward_citations
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.8.avg_time_filing_to_publication
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.9.avg_time_filing_to_grant
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.10.avg_backward_citations_ai
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.11.avg_forward_citations_ai 
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.12. avg_claims_ai 
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.13. avg_number_of_family_members_ai  
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.14. avg_time_filing_to_publication_ai  
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####6.2.2.15. avg_time_filing_to_grant_ai  
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_new_patent_specific_subsidiaries.xlsx", rowNames = F) 

#7.Measuring effects HEADQUARTERS-----
##7.2. Measuring effects across sectors -----
rm(list=ls())
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_headquarters.csv", header = TRUE) #

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim <- DataLong_Subs_sim[,c(1:15, 26:44)]

DataLong_Subs_sim$Rate_granted <- DataLong_Subs_sim$n_granted_yes/(DataLong_Subs_sim$n_granted_na+DataLong_Subs_sim$n_granted_yes) 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096   F
table(DataLong_Subs_sim$Quartile) #bottom 9380                    medium  11004                 top 12712        

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196  F
table(DataLong_Subs_sim$Quartile) #bottom 11480                    medium  11004                 top 12712    

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740            medium   5502           top 6356   
table(nontreat_test$Quartile) #bottom 5740            medium   5502           top 6356   
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410      medium  393                         top 454      
rm(treat_test, nontreat_test)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

head(Patent_data)
rm(RCA_All_Years, Patent_data)

#define the possible variables
variables = c("Rate_granted", #rate of granted patents
              "n_granted_yes_ai", #rate of AI granted patents
              "n_granted_na_ai", #rate of AI not granted patents
              "avg_claims", #most used technology
              "avg_family_members", #number of specializations
              "avg_backward_citations", #for Sections
              "avg_forward_citations", #for 4-digit
              "avg_time_filing_to_publication",
              "avg_time_filing_to_grant",
              "avg_backward_citations_ai",
              "avg_forward_citations_ai",
              "avg_claims_ai",
              "avg_number_of_family_members_ai",
              "avg_time_filing_to_publication_ai",
              "avg_time_filing_to_grant_ai") 

###7.2.1.Calculate the effects Non-standardized -----
####7.2.1.1.Rate_granted----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####7.2.1.2.n_granted_yes_ai----
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####7.2.1.3.n_granted_na_ai----
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.4.avg_claims----
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.5.avg_family_members----
#Group 1

variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.6.avg_backward_citations ----
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.7.avg_forward_citations----
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.8.avg_time_filing_to_publication----
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.9.avg_time_filing_to_grant----
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.10.avg_backward_citations_ai----
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.11.avg_forward_citations_ai ----
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.12. avg_claims_ai ----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.13. avg_number_of_family_members_ai  ----
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.14. avg_time_filing_to_publication_ai  ----
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.1.15. avg_time_filing_to_grant_ai  ----
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_new_patent_specific_headquarters.xlsx", rowNames = F) 
rm(results_df)

###7.2.2.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")] <- 
  scale(DataLong_Subs_sim_group1[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")])

DataLong_Subs_sim_group2[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")] <- 
  scale(DataLong_Subs_sim_group2[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")])

DataLong_Subs_sim_group3[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                            "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")] <- 
  scale(DataLong_Subs_sim_group3[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant", "avg_backward_citations_ai", "avg_forward_citations_ai",
                                    "avg_claims_ai", "avg_number_of_family_members_ai", "avg_time_filing_to_publication_ai", "avg_time_filing_to_grant_ai")])

####7.2.2.1.Rate_granted
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

####7.2.2.2.n_granted_yes_ai
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

####7.2.2.3.n_granted_na_ai
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.4.avg_claims
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.5.avg_family_members
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.6.avg_backward_citations 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.7.avg_forward_citations
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.8.avg_time_filing_to_publication
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.9.avg_time_filing_to_grant
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.10.avg_backward_citations_ai
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.11.avg_forward_citations_ai 
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.12. avg_claims_ai 
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.13. avg_number_of_family_members_ai  
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.14. avg_time_filing_to_publication_ai  
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####7.2.2.15. avg_time_filing_to_grant_ai  
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_new_patent_specific_headquarters.xlsx", rowNames = F) 

#8.Measuring effects HQs and subsidiaries-----
##8.2. Measuring effects across sectors -----
rm(list=ls())
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_HQ_and_subs.csv", header = TRUE) #

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim <- DataLong_Subs_sim[,c(1:15, 26:length(DataLong_Subs_sim))]

#add information about patents developed by subsidiaries and other data (R&D, turnover)
setwd("C:/Users/mathe/OneDrive/Documentos/R/Database")
FinalDataset <- read.csv("files_created_code2/FinalDataset_allYears_FullGUOs.csv", sep = ";", header = TRUE, dec = ",")
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
FinalDataset <- FinalDataset[,c("Company", "CurrentYear","No_subs_extended", "NoPatentsYearALLSubs", "No_AI_PatentsYearALLSubs", 
                                "No_employees_Year", "Turnover_Year", "RandD_Year")]
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, FinalDataset, by = c("Company", "CurrentYear"))

#develop additional indicators

#for subs:
#Rate granted subs/total
DataLong_Subs_sim$Rate_granted_subs_rel_HQ <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$n_granted_yes_HQ+DataLong_Subs_sim$n_granted_yes_subsidiaries) 
#Rate success subs
DataLong_Subs_sim$Rate_success_subs <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$n_granted_na_subsidiaries+DataLong_Subs_sim$n_granted_yes_subsidiaries) 
#Rate granted subs/total NON AI
DataLong_Subs_sim$Rate_granted_subs_rel_HQ_nonai <- DataLong_Subs_sim$n_granted_yes_nonai_subsidiaries/(DataLong_Subs_sim$n_granted_yes_nonai_HQ+DataLong_Subs_sim$n_granted_yes_nonai_subsidiaries) 
#Rate granted per sub (i.e., patent productivity per sub)
DataLong_Subs_sim$Rate_granted_per_sub <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$No_subs_extended) 
#Rate granted subs/total considering the old numbers of patents calculated
DataLong_Subs_sim$Rate_granted_subs_rel_HQ_TOTAL <- DataLong_Subs_sim$NoPatentsYearALLSubs/(DataLong_Subs_sim$NoPatentsYearALLSubs+DataLong_Subs_sim$NoPatentsYearGUOtotal) 

#for the whole company
#R&D Intensity (R&D Expenditure / Turnover)
DataLong_Subs_sim$R_and_D_intensity <- DataLong_Subs_sim$RandD_Year/DataLong_Subs_sim$Turnover_Year
#Patent Productivity (Patents per R&D Investment)
DataLong_Subs_sim$Patent_productivity <- DataLong_Subs_sim$NoPatentsYearGUOtotal/DataLong_Subs_sim$RandD_Year
#Patent Output per Employee
DataLong_Subs_sim$Patent_output_per_employee <- DataLong_Subs_sim$NoPatentsYearGUOtotal/DataLong_Subs_sim$No_employees_Year

#REPLACE NANs of these last 8 columns by NA (check first)
#pay attention here-----
#shouldn't I always use NA instead of NAN in this kind of replacement?
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(across(
    c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
      "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
      "Patent_productivity", "Patent_output_per_employee"),
    ~ ifelse(is.nan(.), NA, .)
  ))

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096   F
table(DataLong_Subs_sim$Quartile) #bottom 9380                    medium  11004                 top 12712        

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196  F
table(DataLong_Subs_sim$Quartile) #bottom 11480                    medium  11004                 top 12712    

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740            medium   5502           top 6356   
table(nontreat_test$Quartile) #bottom 5740            medium   5502           top 6356   
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410      medium  393                         top 454      
rm(treat_test, nontreat_test)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

head(Patent_data)
rm(RCA_All_Years, Patent_data)

#define the possible variables
variables = c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
              "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
              "Patent_productivity", "Patent_output_per_employee",
              
              "n_granted_yes_HQ", "n_granted_na_HQ", "avg_backward_citations_HQ", "avg_forward_citations_HQ", "avg_time_filing_to_publication_HQ", 
              "avg_time_filing_to_grant_HQ", "n_granted_yes_nonai_HQ", "n_granted_na_nonai_HQ", "avg_backward_citations_nonai_HQ", 
              "avg_forward_citations_nonai_HQ", 
              
              "n_granted_yes_subsidiaries", "n_granted_na_subsidiaries", "avg_backward_citations_subsidiaries", "avg_forward_citations_subsidiaries", "avg_time_filing_to_publication_subsidiaries", 
              "avg_time_filing_to_grant_subsidiaries", "n_granted_yes_nonai_subsidiaries", "n_granted_na_nonai_subsidiaries", "avg_backward_citations_nonai_subsidiaries", 
              "avg_forward_citations_nonai_subsidiaries") 

###8.2.1.Calculate the effects Non-standardized -----
####8.2.1.1. Rate_granted_subs_rel_HQ----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####8.2.1.2. Rate_success_subs----
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####8.2.1.3. Rate_granted_subs_rel_HQ_nonai----
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.4. Rate_granted_per_sub----
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
variable_name #Rate_granted_per_sub
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 %>%
                        drop_na() )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3 %>%
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.5. Rate_granted_subs_rel_HQ_TOTAL----
#Group 1

variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.6. R_and_D_intensity ----
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.7. Patent_productivity----
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
variable_name
table(is.na(DataLong_Subs_sim_group1$Patent_productivity))# 8510 T, 4202, this variable won't work so easily

#estimate:
#estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
#                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 %>%
#                        drop_na() )
#agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
#att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
#se <- agg.simple$overall.se            # Standard Error
#update dataset:
#results_new <- calculate_ci_and_significance(att, se, group, variable_name)
#results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
#estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
#                      yname = variables[variable_n], data = DataLong_Subs_sim_group2 %>%  drop_na())
#agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
#att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
#se <- agg.simple$overall.se            # Standard Error
#update dataset:
#results_new <- calculate_ci_and_significance(att, se, group, variable_name)
#results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
#estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
#                      yname = variables[variable_n], data = DataLong_Subs_sim_group3 %>% drop_na())
#agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
#att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
#se <- agg.simple$overall.se            # Standard Error
#update dataset:
#results_new <- calculate_ci_and_significance(att, se, group, variable_name)
#results_df <- rbind(results_df, results_new)

####8.2.1.8. Patent_output_per_employee----
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.9. n_granted_yes_HQ----
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.10. n_granted_na_HQ----
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.11. avg_backward_citations_HQ ----
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.12. avg_forward_citations_HQ ----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.13. avg_time_filing_to_publication_HQ  ----
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.14. avg_time_filing_to_grant_HQ  ----
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.15. n_granted_yes_nonai_HQ  ----
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.16. n_granted_na_nonai_HQ  ----
#Group 1
variable_n = 16
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.17. avg_backward_citations_nonai_HQ  ----
#Group 1
variable_n = 17
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.18. avg_forward_citations_nonai_HQ  ----
#Group 1
variable_n = 18
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.19. n_granted_yes_subsidiaries  ----
#Group 1
variable_n = 19
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.20. n_granted_na_subsidiaries  ----
#Group 1
variable_n = 20
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.21. avg_backward_citations_subsidiaries  ----
#Group 1
variable_n = 21
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.22. avg_forward_citations_subsidiaries  ----
#Group 1
variable_n = 22
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.23. avg_time_filing_to_publication_subsidiaries  ----
#Group 1
variable_n = 23
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.24. avg_time_filing_to_grant_subsidiaries  ----
#Group 1
variable_n = 24
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.25. n_granted_yes_nonai_subsidiaries  ----
#Group 1
variable_n = 25
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.1.26. n_granted_na_nonai_subsidiaries  ----
#Group 1
variable_n = 26
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group1",
                                          "DataLong_Subs_sim_group2",
                                          "DataLong_Subs_sim_group3"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

####8.2.1.27. avg_backward_citations_nonai_subsidiaries  ----
#Group 1
variable_n = 27
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group1",
                                          "DataLong_Subs_sim_group2",
                                          "DataLong_Subs_sim_group3"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

####8.2.1.28. avg_forward_citations_nonai_subsidiaries  ----
#Group 1
variable_n = 28
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group1",
                                          "DataLong_Subs_sim_group2",
                                          "DataLong_Subs_sim_group3"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_new_patent_specific_HQ_and_subs.xlsx", rowNames = F) 
rm(results_df)

###8.2.2.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
                            "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
                            "Patent_productivity", "Patent_output_per_employee",
                            
                            "n_granted_yes_HQ", "n_granted_na_HQ", "avg_backward_citations_HQ", "avg_forward_citations_HQ", "avg_time_filing_to_publication_HQ", 
                            "avg_time_filing_to_grant_HQ", "n_granted_yes_nonai_HQ", "n_granted_na_nonai_HQ", "avg_backward_citations_nonai_HQ", 
                            "avg_forward_citations_nonai_HQ", 
                            
                            "n_granted_yes_subsidiaries", "n_granted_na_subsidiaries", "avg_backward_citations_subsidiaries", "avg_forward_citations_subsidiaries", "avg_time_filing_to_publication_subsidiaries", 
                            "avg_time_filing_to_grant_subsidiaries", "n_granted_yes_nonai_subsidiaries", "n_granted_na_nonai_subsidiaries", "avg_backward_citations_nonai_subsidiaries", 
                            "avg_forward_citations_nonai_subsidiaries")] <- 
  scale(DataLong_Subs_sim_group1[,c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
                                    "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
                                    "Patent_productivity", "Patent_output_per_employee",
                                    
                                    "n_granted_yes_HQ", "n_granted_na_HQ", "avg_backward_citations_HQ", "avg_forward_citations_HQ", "avg_time_filing_to_publication_HQ", 
                                    "avg_time_filing_to_grant_HQ", "n_granted_yes_nonai_HQ", "n_granted_na_nonai_HQ", "avg_backward_citations_nonai_HQ", 
                                    "avg_forward_citations_nonai_HQ", 
                                    
                                    "n_granted_yes_subsidiaries", "n_granted_na_subsidiaries", "avg_backward_citations_subsidiaries", "avg_forward_citations_subsidiaries", "avg_time_filing_to_publication_subsidiaries", 
                                    "avg_time_filing_to_grant_subsidiaries", "n_granted_yes_nonai_subsidiaries", "n_granted_na_nonai_subsidiaries", "avg_backward_citations_nonai_subsidiaries", 
                                    "avg_forward_citations_nonai_subsidiaries")])

DataLong_Subs_sim_group2[,c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
                            "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
                            "Patent_productivity", "Patent_output_per_employee",
                            
                            "n_granted_yes_HQ", "n_granted_na_HQ", "avg_backward_citations_HQ", "avg_forward_citations_HQ", "avg_time_filing_to_publication_HQ", 
                            "avg_time_filing_to_grant_HQ", "n_granted_yes_nonai_HQ", "n_granted_na_nonai_HQ", "avg_backward_citations_nonai_HQ", 
                            "avg_forward_citations_nonai_HQ", 
                            
                            "n_granted_yes_subsidiaries", "n_granted_na_subsidiaries", "avg_backward_citations_subsidiaries", "avg_forward_citations_subsidiaries", "avg_time_filing_to_publication_subsidiaries", 
                            "avg_time_filing_to_grant_subsidiaries", "n_granted_yes_nonai_subsidiaries", "n_granted_na_nonai_subsidiaries", "avg_backward_citations_nonai_subsidiaries", 
                            "avg_forward_citations_nonai_subsidiaries")] <- 
  scale(DataLong_Subs_sim_group2[,c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
                                    "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
                                    "Patent_productivity", "Patent_output_per_employee",
                                    
                                    "n_granted_yes_HQ", "n_granted_na_HQ", "avg_backward_citations_HQ", "avg_forward_citations_HQ", "avg_time_filing_to_publication_HQ", 
                                    "avg_time_filing_to_grant_HQ", "n_granted_yes_nonai_HQ", "n_granted_na_nonai_HQ", "avg_backward_citations_nonai_HQ", 
                                    "avg_forward_citations_nonai_HQ", 
                                    
                                    "n_granted_yes_subsidiaries", "n_granted_na_subsidiaries", "avg_backward_citations_subsidiaries", "avg_forward_citations_subsidiaries", "avg_time_filing_to_publication_subsidiaries", 
                                    "avg_time_filing_to_grant_subsidiaries", "n_granted_yes_nonai_subsidiaries", "n_granted_na_nonai_subsidiaries", "avg_backward_citations_nonai_subsidiaries", 
                                    "avg_forward_citations_nonai_subsidiaries")])

DataLong_Subs_sim_group3[,c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
                            "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
                            "Patent_productivity", "Patent_output_per_employee",
                            
                            "n_granted_yes_HQ", "n_granted_na_HQ", "avg_backward_citations_HQ", "avg_forward_citations_HQ", "avg_time_filing_to_publication_HQ", 
                            "avg_time_filing_to_grant_HQ", "n_granted_yes_nonai_HQ", "n_granted_na_nonai_HQ", "avg_backward_citations_nonai_HQ", 
                            "avg_forward_citations_nonai_HQ", 
                            
                            "n_granted_yes_subsidiaries", "n_granted_na_subsidiaries", "avg_backward_citations_subsidiaries", "avg_forward_citations_subsidiaries", "avg_time_filing_to_publication_subsidiaries", 
                            "avg_time_filing_to_grant_subsidiaries", "n_granted_yes_nonai_subsidiaries", "n_granted_na_nonai_subsidiaries", "avg_backward_citations_nonai_subsidiaries", 
                            "avg_forward_citations_nonai_subsidiaries")] <- 
  scale(DataLong_Subs_sim_group3[,c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
                                    "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
                                    "Patent_productivity", "Patent_output_per_employee",
                                    
                                    "n_granted_yes_HQ", "n_granted_na_HQ", "avg_backward_citations_HQ", "avg_forward_citations_HQ", "avg_time_filing_to_publication_HQ", 
                                    "avg_time_filing_to_grant_HQ", "n_granted_yes_nonai_HQ", "n_granted_na_nonai_HQ", "avg_backward_citations_nonai_HQ", 
                                    "avg_forward_citations_nonai_HQ", 
                                    
                                    "n_granted_yes_subsidiaries", "n_granted_na_subsidiaries", "avg_backward_citations_subsidiaries", "avg_forward_citations_subsidiaries", "avg_time_filing_to_publication_subsidiaries", 
                                    "avg_time_filing_to_grant_subsidiaries", "n_granted_yes_nonai_subsidiaries", "n_granted_na_nonai_subsidiaries", "avg_backward_citations_nonai_subsidiaries", 
                                    "avg_forward_citations_nonai_subsidiaries")])

####8.2.2.1. Rate_granted_subs_rel_HQ
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####8.2.2.2. Rate_success_subs
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

####8.2.2.3. Rate_granted_subs_rel_HQ_nonai
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.4. Rate_granted_per_sub
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
variable_name #Rate_granted_per_sub
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 %>%
                        drop_na() )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3 %>%
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.5. Rate_granted_subs_rel_HQ_TOTAL
#Group 1

variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.6. R_and_D_intensity 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.7. Patent_productivity
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
variable_name
table(is.na(DataLong_Subs_sim_group1$Patent_productivity))# 8510 T, 4202, this variable won't work so easily

#estimate:
#estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
#                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 %>%
#                        drop_na() )
#agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
#att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
#se <- agg.simple$overall.se            # Standard Error
#update dataset:
#results_new <- calculate_ci_and_significance(att, se, group, variable_name)
#results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
#estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
#                      yname = variables[variable_n], data = DataLong_Subs_sim_group2 %>%  drop_na())
#agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
#att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
#se <- agg.simple$overall.se            # Standard Error
#update dataset:
#results_new <- calculate_ci_and_significance(att, se, group, variable_name)
#results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
#estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
#                      yname = variables[variable_n], data = DataLong_Subs_sim_group3 %>% drop_na())
#agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
#att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
#se <- agg.simple$overall.se            # Standard Error
#update dataset:
#results_new <- calculate_ci_and_significance(att, se, group, variable_name)
#results_df <- rbind(results_df, results_new)

####8.2.2.8. Patent_output_per_employee
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.9. n_granted_yes_HQ
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.10. n_granted_na_HQ
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.11. avg_backward_citations_HQ 
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.12. avg_forward_citations_HQ 
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.13. avg_time_filing_to_publication_HQ  
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.14. avg_time_filing_to_grant_HQ  
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.15. n_granted_yes_nonai_HQ  
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.16. n_granted_na_nonai_HQ  
#Group 1
variable_n = 16
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.17. avg_backward_citations_nonai_HQ  
#Group 1
variable_n = 17
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.18. avg_forward_citations_nonai_HQ  
#Group 1
variable_n = 18
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.19. n_granted_yes_subsidiaries  
#Group 1
variable_n = 19
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.20. n_granted_na_subsidiaries  
#Group 1
variable_n = 20
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.21. avg_backward_citations_subsidiaries  
#Group 1
variable_n = 21
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.22. avg_forward_citations_subsidiaries  
#Group 1
variable_n = 22
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.23. avg_time_filing_to_publication_subsidiaries  
#Group 1
variable_n = 23
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.24. avg_time_filing_to_grant_subsidiaries  
#Group 1
variable_n = 24
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.25. n_granted_yes_nonai_subsidiaries  
#Group 1
variable_n = 25
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####8.2.2.26. n_granted_na_nonai_subsidiaries  
#Group 1
variable_n = 26
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group1",
                                          "DataLong_Subs_sim_group2",
                                          "DataLong_Subs_sim_group3"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

####8.2.2.27. avg_backward_citations_nonai_subsidiaries  
#Group 1
variable_n = 27
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group1",
                                          "DataLong_Subs_sim_group2",
                                          "DataLong_Subs_sim_group3"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

####8.2.2.28. avg_forward_citations_nonai_subsidiaries  
#Group 1
variable_n = 28
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group1",
                                          "DataLong_Subs_sim_group2",
                                          "DataLong_Subs_sim_group3"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_new_patent_specific_HQ_and_subs.xlsx", rowNames = F) 

#9.Descriptive statistics and correlations-----
rm(list=ls())
FinalDataset <- read.csv("Input_code/Data_all_years_all_MNEs.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
FinalDataset$Nace_4d <- as.character(FinalDataset$Nace_4d)
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance

FinalDataset <- left_join(FinalDataset,CategoriesNace, by = "Nace_4d")
table(is.na(FinalDataset$Quartile)) #476620 F; 62820 T
table(FinalDataset$Quartile) #bottom 213880  medium  175220  top 87520     

FinalDataset$Quartile[is.na(FinalDataset$Quartile)] <- "bottom"
table(is.na(FinalDataset$Quartile)) #539440  
table(FinalDataset$Quartile) #bottom 276700     medium 175220       top 87520 

dynamic_capabilities <- read.csv("Input_code/Big_files_ignore/df_dynamic_capabilities.csv", header = TRUE)
names(dynamic_capabilities)[names(dynamic_capabilities) == 'Year'] <- 'CurrentYear'
FinalDataset <- left_join(FinalDataset, dynamic_capabilities, by=c("Company", "CurrentYear"))

##9.1.Statistics All data------
#pick just one year of analysis:
FinalDataset_2019 <- FinalDataset[FinalDataset$CurrentYear== 2019,]
FinalDataset_summary <- FinalDataset_2019[,c("Relatedness_Cos2", "NoSubs_calculated", "NoSubsWithPatents", "Size_class", 
                                             "NoPatentsYearGUOtotal", "No_AI_PatentsYearGUOtotal","No_employees_Year",
                                             "Date_Incorporation", "Specializations_Usage", "HigherUsage", "Specializations_Number",
                                             "Herfindahl", "Shannon", "Quartile",
                                             "UniqueCodes", "UniqueSubclass", "Dynamic_capabilities")] 

#group test for Size_class
st(FinalDataset_summary, title = "Variables Size_class", group = "Size_class",  group.test = TRUE)
Size_class <- st(FinalDataset_summary, group = "Size_class",  group.test = TRUE,
                 summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'), out = 'return')

Quartile <- st(FinalDataset_summary, group = "Quartile",  group.test = TRUE,
               summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'), out = 'return')

write.csv2(Size_class, file = "Output_code/Data/Descriptive_statistics_all_MNEs_by_Size_class.csv", row.names = F) #from now on, the addition of _new means that the complexity and relatedness of
write.csv2(Quartile, file = "Output_code/Data/Descriptive_statistics_all_MNEs_by_Quartile.csv", row.names = F) #from now on, the addition of _new means that the complexity and relatedness of
rm(Size_class, Quartile, CategoriesNace)

##9.2.Statistics matched data-----
DataLong_Subs_2006 <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
DataLong_Subs_2006 <- left_join(DataLong_Subs_2006, dynamic_capabilities, by=c("Company", "CurrentYear"))

length(unique(DataLong_Subs_2006$subclass)) #1257
length(unique(DataLong_Subs_2006$Company)) #2390

#get the mean of the last 5 years
DataLong_Subs_2006 %<>% group_by(Company, subclass) %>% 
  mutate(across(NoPatentsYearGUOtotal,
                .fns = list(avg = ~ rollmean(.,k=5,fill=NA,align = 'center'))))

#new: Relatedness_lagged 
DataLong_Subs_2006 %<>% group_by(Company, subclass) %>% 
  mutate(NoPatentsYearGUOtotal_avg_fixed = lag(NoPatentsYearGUOtotal_avg)) %>% 
  mutate(Relatedness_lagged = lag(Relatedness_Cos2)) 

DataLong_Subs_2006 <- subset(DataLong_Subs_2006, select = -c(NoPatentsYearGUOtotal_avg) )

table(DataLong_Subs_2006$Group)

#pick the variables of interest from FinalDataset and merge them with DataLong_Subs_2006 by CurrentYear and Company
For_Match <- FinalDataset[,c("Company","CurrentYear","Quartile", "HigherUsage","Specializations_Usage", "Specializations_Number","Shannon","Herfindahl","NoSubs_calculated", "NoSubsWithPatents", "No_employees_Year",
                             "UniqueCodes", "UniqueSubclass", "Dynamic_capabilities")] #new 
DataLong_Subs_2006 <- left_join(DataLong_Subs_2006, For_Match, by=c("Company","CurrentYear"),na_matches="never")
rm(For_Match)

DataLong_Subs_2006 %<>% group_by(Company, subclass) %>% 
  mutate(N_specializations_lagged = lag(Specializations_Number.x)) 

DataLong_Subs_2006_summary <- DataLong_Subs_2006[,c("Relatedness_Cos2", "Size_class", "NoPatentsYearGUOtotal", "No_AI_PatentsYearGUOtotal",
                                                    "Company","treat","Date_Incorporation", "Group", "CurrentYear", 
                                                    "NoPatentsYearGUOtotal_avg_fixed", "Nace_4d", "YearFirstAdoption",
                                                    "HigherUsage.x","Specializations_Usage.x", "Specializations_Number.x","Shannon.x","Herfindahl.x","NoSubs_calculated", "NoSubsWithPatents",
                                                    "Quartile", "No_employees_Year",
                                                    "Relatedness_lagged", "N_specializations_lagged", 
                                                    "UniqueCodes.x", "UniqueSubclass.x", "Dynamic_capabilities.x" )] 

DataLong_Subs_2006_summary <- DataLong_Subs_2006_summary[DataLong_Subs_2006_summary$Group == DataLong_Subs_2006_summary$CurrentYear,]

test <- DataLong_Subs_2006_summary[,c("Company","Group")]
length(unique(test$Company)) #2390
rm(test)

DataLong_Subs_2006_summary <- subset(DataLong_Subs_2006_summary, select = -c(Company, Group,  YearFirstAdoption, Nace_4d) )#, "CurrentYear"

st(DataLong_Subs_2006_summary,  group = "treat",  group.test = TRUE) #title = "Treatment differences",

table(DataLong_Subs_2006_summary$CurrentYear) #from 2011 to 2019
Treated_2011 <- DataLong_Subs_2006_summary[DataLong_Subs_2006_summary$CurrentYear != 2011,]
Treated_2019 <- DataLong_Subs_2006_summary[DataLong_Subs_2006_summary$CurrentYear != 2019,]

st(Treated_2011,  group = "treat",  group.test = TRUE,
   summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'))
#so, when the 2011 group is excluded, there is no sign diff in the number of patents anymore!
rm(Treated_2011, Treated_2019)

st(DataLong_Subs_2006_summary,  group = "treat",  group.test = TRUE,
   summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'))

Treated <- st(DataLong_Subs_2006_summary,  group = "treat",  group.test = TRUE,
              summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'), out = 'return')

Quartile <- st(DataLong_Subs_2006_summary,  group = "Quartile",  group.test = TRUE,
               summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'), out = 'return')
Size_class <- st(DataLong_Subs_2006_summary,  group = "Size_class",  group.test = TRUE,
                 summ=c('mean(x)','median(x)','sd(x)','min(x)','pctile(x)[25]','pctile(x)[75]','max(x)'), out = 'return')

write.csv2(Treated, file = "Output_code/Data/Descriptive_statistics_matched_companies_Treated.csv", row.names = F) #from now on, the addition of _new means that the complexity and relatedness of
write.csv2(Quartile, file = "Output_code/Data/Descriptive_statistics_matched_companies_Quartile.csv", row.names = F) #from now on, the addition of _new means that the complexity and relatedness of
write.csv2(Size_class, file = "Output_code/Data/Descriptive_statistics_matched_companies_Size_class.csv", row.names = F) #from now on, the addition of _new means that the complexity and relatedness of

##9.3.Analyse correlations-----
#For the matched sample
data_normalized <- DataLong_Subs_2006_summary[,c("Relatedness_Cos2", "HigherUsage.x", "Specializations_Usage.x", "Specializations_Number.x",
                                                 "Date_Incorporation","No_AI_PatentsYearGUOtotal", "NoPatentsYearGUOtotal")] 

names(data_normalized) <- c("Relatedness", "Usage of main code", "Usage of specializations",
                            "N. of specializations","Date of incorporation", "N. of AI patents","N. of patents") 
data_normalized <- scale(data_normalized)
corr_matrix <- cor(na.omit(data_normalized))

jpeg("Output_code/Figures/Correlation_table_matched_companies.jpg", width = 15, height = 12, units = 'in', res = 300)
ggcorrplot(corr_matrix, legend.title = "Correlation", hc.order=F,lab = TRUE, lab_size = 8)+
  theme(axis.text.x=element_text(size=25),axis.text.y=element_text(size=25), legend.key.size = unit(1.5, 'cm'),
        legend.title = element_text(size=24), legend.text = element_text(size=20))
dev.off()

#For the whole dataset 
data_normalized <- FinalDataset_2019[,c("Relatedness_Cos2", "HigherUsage", "Specializations_Usage", "Specializations_Number",
                                        "Date_Incorporation","No_AI_PatentsYearGUOtotal", "NoPatentsYearGUOtotal")] 

names(data_normalized) <- c("Relatedness", "Usage of main code", "Usage of specializations",
                            "N. of specializations","Date of incorporation", "N. of AI patents","N. of patents") 
data_normalized <- scale(data_normalized)
corr_matrix <- cor(na.omit(data_normalized))
jpeg("Output_code/Figures/Correlation_table_all_companies.jpg", width = 15, height = 12, units = 'in', res = 300)
ggcorrplot(corr_matrix, legend.title = "Correlation", hc.order=F,lab = TRUE, lab_size = 8)+
  theme(axis.text.x=element_text(size=25),axis.text.y=element_text(size=25), legend.key.size = unit(1.5, 'cm'),
        legend.title = element_text(size=24), legend.text = element_text(size=20))
dev.off()

#10. Effects considering non-granted patents----
##10.1. For all sectors -----
##10.2. Measuring effects across sectors -----
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

DataLong_Subs_sim <-read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",")
dynamic_capabilities <- read.csv("Input_code/Big_files_ignore/df_dynamic_capabilities.csv", header = TRUE)
names(dynamic_capabilities)[names(dynamic_capabilities) == 'Year'] <- 'CurrentYear'
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, dynamic_capabilities, by=c("Company", "CurrentYear"))

length(unique(DataLong_Subs_sim$id)) #2514 ids 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

table(is.na(DataLong_Subs_sim$AIcodes)) #13607 F, 21589   T

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0
table(is.na(DataLong_Subs_sim$AIcodes)) #35196 F

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096        F  2100      T
table(DataLong_Subs_sim$Quartile) #bottom 9380              medium  11004            top 12712      

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196 F
table(DataLong_Subs_sim$Quartile) #bottom 11480             medium  11004            top 12712     

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740    medium   5502    top 6356 
table(nontreat_test$Quartile) #bottom 5740    medium   5502    top 6356 
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410                    medium  393                      top 454     
rm(treat_test, nontreat_test)

###10.2.1.Define new treatment-----
rm(CategoriesNace, dynamic_capabilities, mat_tech_rel, RCA_All_Years_treat_AI, RCA_All_Years)
#First, include information about granted and not granted patents
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #
DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

test <- DataLong_Subs_sim[,c("Company", "CurrentYear", "NoPatentsYearGUOtotal","n_granted_yes", "n_granted_na")]

Current_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
Current_non_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
test <- Current_treated[,c(3,8:15, 30:33, 35:37,57)]
#test %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()
test <- test[test$total_granted_ai ==0,]
length(unique(test$Company)) #777
length(unique(Current_treated$Company)) #1257
rm(test)

#so the treatment will now be companies that never had an AI patent granted
Current_treated_new_treat <-Current_treated[Current_treated$total_granted_ai ==0,]
backup_DataLong_Subs_sim <- DataLong_Subs_sim

####10.2.1.1.Treatment non-granted-----
DataLong_Subs_sim <- rbind(Current_treated_new_treat, Current_non_treated)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

#define the possible variables
variables = c("Relatedness_Cos2", #relatedness
              "NoPatentsYearGUOtotal", #innovative performance
              "Specializations_Usage", #usage of specializations
              "HigherUsage", #most used technology
              "Specializations_Number", #number of specializations
              "UniqueCodes", #for Sections
              "UniqueSubclass", #for 4-digit
              "Herfindahl",
              "Shannon",
              "AIcodes", #effect on the 5 codes most related to AI
              "No_AI_PatentsYearGUOtotal",#effect on number of AI patents
              "Dynamic_capabilities") #the share of codes that changed from one year to the other 

####10.2.1.1.0.Calculate the effects Non-standardized -----
######10.2.1.1.1.Relatedness----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
##dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######10.2.1.1.2.Innovative performance----
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######10.2.1.1.2.00.NEW DYNAMIC CAPABILITIES ----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######10.2.1.1.3.Usage of specializations----
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.4.Most used technology----
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.5.Number of specializations----
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.6.Number of sections ----
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.7.Number of subclasses----
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.8.Herfindahl index----
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.9.Shannon index----
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Shannon = replace_na(Shannon, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Shannon = replace_na(Shannon, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.10.Number AI codes----
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.11. Number of AI patents----
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #1.7991        0.1562     1.4929      2.1053 *
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand.xlsx", rowNames = F) #Results_Effects_non_stand.xlsx with dyn capabilities now
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_WITH_DYN_CAP_new_treat_non_granted.xlsx", rowNames = F) 
rm(results_df)

####10.2.1.2.0.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

######10.2.1.2.1.Relatedness
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

#######10.2.1.2.2.Innovative performance
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#######10.2.1.2.2.00. NEW DYNAMIC CAPABILITIES
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#######10.2.1.2.3.Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.4.Most used technology
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.5.Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.6.Number of sections 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.7.Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.8.Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.9.Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.10.Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.11. Number of AI patents
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_stand.xlsx", rowNames = F)
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_WITH_DYN_CAP_new_treat_non_granted.xlsx", rowNames = F)

####10.2.1.1.Treatment granted-----
Current_treated_new_treat_granted <-Current_treated[Current_treated$total_granted_ai > 0,]
length(unique(Current_treated_new_treat_granted$Company)) #480
DataLong_Subs_sim <- rbind(Current_treated_new_treat_granted, Current_non_treated)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

#define the possible variables
variables = c("Relatedness_Cos2", #relatedness
              "NoPatentsYearGUOtotal", #innovative performance
              "Specializations_Usage", #usage of specializations
              "HigherUsage", #most used technology
              "Specializations_Number", #number of specializations
              "UniqueCodes", #for Sections
              "UniqueSubclass", #for 4-digit
              "Herfindahl",
              "Shannon",
              "AIcodes", #effect on the 5 codes most related to AI
              "No_AI_PatentsYearGUOtotal",#effect on number of AI patents
              "Dynamic_capabilities") #the share of codes that changed from one year to the other 

####10.2.1.1.0.Calculate the effects Non-standardized -----
######10.2.1.1.1.Relatedness----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
##dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######10.2.1.1.2.Innovative performance----
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######10.2.1.1.2.00.NEW DYNAMIC CAPABILITIES ----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######10.2.1.1.3.Usage of specializations----
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.4.Most used technology----
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.5.Number of specializations----
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.6.Number of sections ----
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.7.Number of subclasses----
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.8.Herfindahl index----
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.9.Shannon index----
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Shannon = replace_na(Shannon, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Shannon = replace_na(Shannon, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.10.Number AI codes----
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.1.11. Number of AI patents----
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #1.7991        0.1562     1.4929      2.1053 *
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand.xlsx", rowNames = F) #Results_Effects_non_stand.xlsx with dyn capabilities now
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_WITH_DYN_CAP_new_treat_granted.xlsx", rowNames = F) 
rm(results_df)

####10.2.1.2.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

######10.2.1.2.1.Relatedness
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

#######10.2.1.2.2.Innovative performance
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#######10.2.1.2.2.00. NEW DYNAMIC CAPABILITIES
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#######10.2.1.2.3.Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.4.Most used technology
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.5.Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.6.Number of sections 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.7.Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.8.Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.9.Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.10.Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######10.2.1.2.11. Number of AI patents
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_stand.xlsx", rowNames = F)
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_WITH_DYN_CAP_new_treat_granted.xlsx", rowNames = F)

#11.Analysing main critical variables plus HQ and Subsidiaries for whole dataset------
##11.1. Measuring effects for all sectors together -----
rm(list=ls())
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_HQ_and_subs.csv", header = TRUE) #

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim <- DataLong_Subs_sim[,c(1:15, 26:length(DataLong_Subs_sim))]

#add information about patents developed by subsidiaries and other data (R&D, turnover)
setwd("C:/Users/mathe/OneDrive/Documentos/R/Database")
FinalDataset <- read.csv("files_created_code2/FinalDataset_allYears_FullGUOs.csv", sep = ";", header = TRUE, dec = ",")
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
FinalDataset <- FinalDataset[,c("Company", "CurrentYear","No_subs_extended", "NoPatentsYearALLSubs", "No_AI_PatentsYearALLSubs", 
                                "No_employees_Year", "Turnover_Year", "RandD_Year")]
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, FinalDataset, by = c("Company", "CurrentYear"))

#try to compensate for missing data from orbis:
Additional_data<-read_excel("Input_code/Big_files_ignore/Updated_data_companies_RandD.xlsx", sheet = "Results", na = "n.a.")
#clean names fix names change names improve names
Additional_data <- Additional_data[,c(-1)] %>%  clean_names()

#fix r_d_expenses_operating_revenue_
Additional_data <- Additional_data %>%
  mutate(    across(      matches("^r_d_expenses_operating_revenue_\\d+$"),
      ~ as.numeric(.x)    )  )

sample_data_long <- Additional_data %>%
  pivot_longer(
    cols = matches("^(operating_revenue_turnover_th_usd_|r_d_expenses_operating_revenue_|number_of_employees_|research_development_expenses_th_usd_)\\d+$"),
    names_to = c("Variable", "CurrentYear"),
    names_pattern = "(operating_revenue_turnover_th_usd_|r_d_expenses_operating_revenue_|number_of_employees_|research_development_expenses_th_usd_)(\\d+)",
    values_to = "Value"  ) %>%
  mutate(CurrentYear = as.integer(CurrentYear))

sample_data_wide <- sample_data_long %>%
  pivot_wider(names_from  = "Variable",
              values_from = "Value")
#new variables:
table(is.na(sample_data_wide$operating_revenue_turnover_th_usd_)) #17777 f, 14605 T
table(is.na(sample_data_wide$r_d_expenses_operating_revenue_)) #13514 F, 18868 T 
table(is.na(sample_data_wide$number_of_employees_)) #14494 F, 17888 T 
#new variable, that really captures R&D:
table(is.na(sample_data_wide$research_development_expenses_th_usd_))  #14314 F, 18068  T

#old variables:
table(is.na(DataLong_Subs_sim$Turnover_Year)) #15709 F, 19487 T
table(is.na(DataLong_Subs_sim$RandD_Year)) #10703 F, 24493 T
table(is.na(DataLong_Subs_sim$No_employees_Year)) #13243 F, 21953 T

#hence, there is more data available for the new ones; particularly for RandD_Year and No_employees_Year
rm(sample_data_long, Additional_data)
head(sample_data_wide)
names(sample_data_wide) <- c("company_name_latin_alphabet ","Company","CurrentYear", "No_employees_Year", "Turnover_Year", "RandD_Year_per_turnover", "RandD_Year")

#pay attention: in the old file, Orbis would make the R&D data available just under the variable "R&D expenses/Operating revenue (%)"; now it
#gives the absolute values for Turnover, i.e., "R&D expenses/Operating revenue"; the reading is more straightforward in the latter:
#it shows how the absolute proportion changed, instead of an absolute change in relation to a relative proportion (which I'm not even sure how to read);
#therefore, the new data is better; I could use the old R&D data if I'd multiply it by the turnover;

DataLong_Subs_sim <- subset(DataLong_Subs_sim, select = -c(No_employees_Year, Turnover_Year, RandD_Year))
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, sample_data_wide, by = c("Company","CurrentYear"))

#develop additional indicators
#for subs:
#Rate granted subs/total
DataLong_Subs_sim$Rate_granted_subs_rel_HQ <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$n_granted_yes_HQ+DataLong_Subs_sim$n_granted_yes_subsidiaries) 
#Rate success subs
DataLong_Subs_sim$Rate_success_subs <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$n_granted_na_subsidiaries+DataLong_Subs_sim$n_granted_yes_subsidiaries) 
#Rate granted subs/total NON AI
DataLong_Subs_sim$Rate_granted_subs_rel_HQ_nonai <- DataLong_Subs_sim$n_granted_yes_nonai_subsidiaries/(DataLong_Subs_sim$n_granted_yes_nonai_HQ+DataLong_Subs_sim$n_granted_yes_nonai_subsidiaries) 
#Rate granted per sub (i.e., patent productivity per sub)
DataLong_Subs_sim$Rate_granted_per_sub <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$No_subs_extended) 
#Rate granted subs/total considering the old numbers of patents calculated
DataLong_Subs_sim$Rate_granted_subs_rel_HQ_TOTAL <- DataLong_Subs_sim$NoPatentsYearALLSubs/(DataLong_Subs_sim$NoPatentsYearALLSubs+DataLong_Subs_sim$NoPatentsYearGUOtotal) 

#for the whole company
#R&D Intensity (R&D Expenditure / Turnover)
DataLong_Subs_sim$R_and_D_intensity <- DataLong_Subs_sim$RandD_Year_per_turnover# fixed from the privious because now I now that this variable already divides RandD by turnover. the previous was: DataLong_Subs_sim$RandD_Year/DataLong_Subs_sim$Turnover_Year #this is potentially problematic because orbis just gives RandD_year/turnover, and not r and d alone
#Patent Productivity (Patents per R&D Investment)
DataLong_Subs_sim$Patent_productivity <- DataLong_Subs_sim$NoPatentsYearGUOtotal/DataLong_Subs_sim$RandD_Year
#Patent output per turnover
DataLong_Subs_sim$Patent_output_per_turnover<- DataLong_Subs_sim$NoPatentsYearGUOtotal/DataLong_Subs_sim$Turnover_Year
#Patent Output per Employee
DataLong_Subs_sim$Patent_output_per_employee <- DataLong_Subs_sim$NoPatentsYearGUOtotal/DataLong_Subs_sim$No_employees_Year

#REPLACE NANs of these last 8 columns by NA (check first)
#pay attention here-----
#shouldn't I always use NA instead of NAN in this kind of replacement?
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(across(
    c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
      "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
      "Patent_productivity", "Patent_output_per_employee", "Patent_output_per_turnover"),
    ~ ifelse(is.nan(.), NA, .)
  ))

#replace infinite values from Patent_productivity ad Patent_output_per_employee for NA
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(Patent_productivity = ifelse(is.infinite(Patent_productivity), NA, Patent_productivity)) %>% 
  mutate(Patent_output_per_employee = ifelse(is.infinite(Patent_output_per_employee), NA, Patent_output_per_employee)) %>% 
  mutate(Patent_output_per_turnover = ifelse(is.infinite(Patent_output_per_turnover), NA, Patent_output_per_turnover))

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096   F
table(DataLong_Subs_sim$Quartile) #bottom 9380                    medium  11004                 top 12712        

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196  F
table(DataLong_Subs_sim$Quartile) #bottom 11480                    medium  11004                 top 12712    

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740            medium   5502           top 6356   
table(nontreat_test$Quartile) #bottom 5740            medium   5502           top 6356   
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410      medium  393                         top 454      
rm(treat_test, nontreat_test)

#first try-----
#measuring all together without separation btw granted and not granted
DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3", "DataLong_Subs_sim_group0")

head(Patent_data)
rm(RCA_All_Years, Patent_data)

#define the possible variables
variables = c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
              "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
              "Patent_productivity", "Patent_output_per_employee",
              
              "n_granted_yes_HQ", "n_granted_na_HQ", "avg_backward_citations_HQ", "avg_forward_citations_HQ", "avg_time_filing_to_publication_HQ", 
              "avg_time_filing_to_grant_HQ", "n_granted_yes_nonai_HQ", "n_granted_na_nonai_HQ", "avg_backward_citations_nonai_HQ", 
              "avg_forward_citations_nonai_HQ", 
              
              "n_granted_yes_subsidiaries", "n_granted_na_subsidiaries", "avg_backward_citations_subsidiaries", "avg_forward_citations_subsidiaries", "avg_time_filing_to_publication_subsidiaries", 
              "avg_time_filing_to_grant_subsidiaries", "n_granted_yes_nonai_subsidiaries", "n_granted_na_nonai_subsidiaries", "avg_backward_citations_nonai_subsidiaries", 
              "avg_forward_citations_nonai_subsidiaries", "Patent_output_per_turnover") 

###11.2.1.Calculate the effects Non-standardized -----
DataLong_Subs_sim_group0 <- DataLong_Subs_sim

#####11.2.1.1. All variables group0----
######11.2.1.1.1.All treated together------
variable_n = 1
n_group = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                      drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                      drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 9
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 10
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 11
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 12
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 13
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 14
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 15
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 16
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 17
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 18
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 19
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 20
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 21
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 22
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 23
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 24
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 25
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 26
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 27
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 28
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 29
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

######11.2.1.1.2.focus on granted treatment-----
#
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #
DataLong_Subs_sim_group0<- left_join(DataLong_Subs_sim_group0,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim_group0 %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

treated <- DataLong_Subs_sim_group0[DataLong_Subs_sim_group0$treat == 1,]
length(unique(treated$Company)) #1257
nontreated <- DataLong_Subs_sim_group0[DataLong_Subs_sim_group0$treat == 0,]
treated <- treated[treated$total_granted_ai >0,]
length(unique(treated$Company)) #480

DataLong_Subs_sim_group0 <- rbind(treated, nontreated)

variable_n = 1
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 %>% drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                      drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 9
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 10
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 11
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 12
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 13
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 14
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 15
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 16
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 17
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 18
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 19
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 20
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 21
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 22
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 23
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 24
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 25
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 26
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 27
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 28
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 29
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group0"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_new_patent_specific_HQ_and_subs_treat_all_vs_only_granted.xlsx", rowNames = F) 

#analyse using the classic did
# Create Create the Post-Treatment binary Variable
DataLong_Subs_sim_group0$post_treatment <- ifelse(DataLong_Subs_sim_group0$CurrentYear >= DataLong_Subs_sim_group0$first.treat & 
                                                    DataLong_Subs_sim_group0$Group <= DataLong_Subs_sim_group0$CurrentYear, 1, 0)

#the variables I'm really interested are: R_and_D_intensity, Patent_productivity, and 
#Patent_output_per_employee

#Basic DiD model without the moderator  
model <- lm(R_and_D_intensity ~ treat * post_treatment, data = DataLong_Subs_sim_group0) #this means (R&D Expenditure / Turnover)
summary(model) 
#treat                  8902.4     2262.9   3.934 0.0000841 ***
#post_treatment         -765.7     1927.7  -0.397  0.691216    
#treat:post_treatment   8158.7     3369.1   2.422  0.015467 *  

# Basic DiD model WITHOUT the moderator 
model <- lm(Patent_productivity ~ treat * post_treatment, data = DataLong_Subs_sim_group0)
summary(model) 
#treat                -0.01740    1.41348  -0.012    0.990
#post_treatment        1.97754    1.25340   1.578    0.115
#treat:post_treatment -1.91513    2.13647  -0.896    0.370

model <- lm(Patent_output_per_employee ~ treat * post_treatment, data = DataLong_Subs_sim_group0)
summary(model) 
#treat                 -19.209     14.917  -1.288   0.1979  
#post_treatment        -18.973     12.473  -1.521   0.1282  
#treat:post_treatment   19.946     22.433   0.889   0.3739 

model <- lm(Patent_output_per_turnover ~ treat * post_treatment, data = DataLong_Subs_sim_group0)
summary(model) 
#treat                   10.59      71.25   0.149     0.882    
#post_treatment         146.35      63.91   2.290     0.022 *  
#treat:post_treatment   -54.79     107.87  -0.508     0.612 

###11.2.2.Calculate the effects Standardized -----
DataLong_Subs_sim_group0 <- DataLong_Subs_sim

DataLong_Subs_sim_group0 <- DataLong_Subs_sim_group0 %>%
  mutate(across(where(is.numeric), ~ ifelse(is.infinite(.), NA, .))) %>% 
  mutate(across(where(is.numeric), ~ ifelse(. == -Inf, NA, .)))

DataLong_Subs_sim_group0[,c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
                            "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
                            "Patent_productivity", "Patent_output_per_employee",
                            
                            "n_granted_yes_HQ", "n_granted_na_HQ", "avg_backward_citations_HQ", "avg_forward_citations_HQ", "avg_time_filing_to_publication_HQ", 
                            "avg_time_filing_to_grant_HQ", "n_granted_yes_nonai_HQ", "n_granted_na_nonai_HQ", "avg_backward_citations_nonai_HQ", 
                            "avg_forward_citations_nonai_HQ", 
                            
                            "n_granted_yes_subsidiaries", "n_granted_na_subsidiaries", "avg_backward_citations_subsidiaries", "avg_forward_citations_subsidiaries", "avg_time_filing_to_publication_subsidiaries", 
                            "avg_time_filing_to_grant_subsidiaries", "n_granted_yes_nonai_subsidiaries", "n_granted_na_nonai_subsidiaries", "avg_backward_citations_nonai_subsidiaries", 
                            "avg_forward_citations_nonai_subsidiaries", "Patent_output_per_turnover")] <- 
  scale(DataLong_Subs_sim_group0[,c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
                                    "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "R_and_D_intensity", 
                                    "Patent_productivity", "Patent_output_per_employee",
                                    
                                    "n_granted_yes_HQ", "n_granted_na_HQ", "avg_backward_citations_HQ", "avg_forward_citations_HQ", "avg_time_filing_to_publication_HQ", 
                                    "avg_time_filing_to_grant_HQ", "n_granted_yes_nonai_HQ", "n_granted_na_nonai_HQ", "avg_backward_citations_nonai_HQ", 
                                    "avg_forward_citations_nonai_HQ", 
                                    
                                    "n_granted_yes_subsidiaries", "n_granted_na_subsidiaries", "avg_backward_citations_subsidiaries", "avg_forward_citations_subsidiaries", "avg_time_filing_to_publication_subsidiaries", 
                                    "avg_time_filing_to_grant_subsidiaries", "n_granted_yes_nonai_subsidiaries", "n_granted_na_nonai_subsidiaries", "avg_backward_citations_nonai_subsidiaries", 
                                    "avg_forward_citations_nonai_subsidiaries", "Patent_output_per_turnover")])

#####11.2.2.1. All variables group0----
######11.2.2.1.1.All treated together------
variable_n = 1
n_group = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)
?drop_
variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 9
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 10
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 11
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 12
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 13
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 14
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 15
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 16
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 17
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 18
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 19
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 20
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 21
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 22
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 23
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 24
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 25
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 26
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 27
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 28
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 29
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

######11.2.2.1.2.focus on granted treatment-----
#
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #
DataLong_Subs_sim_group0<- left_join(DataLong_Subs_sim_group0,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim_group0 %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

treated <- DataLong_Subs_sim_group0[DataLong_Subs_sim_group0$treat == 1,]
length(unique(treated$Company)) #1257
nontreated <- DataLong_Subs_sim_group0[DataLong_Subs_sim_group0$treat == 0,]
treated <- treated[treated$total_granted_ai >0,]
length(unique(treated$Company)) #480

DataLong_Subs_sim_group0 <- rbind(treated, nontreated)

variable_n = 1
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 %>% drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 9
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 10
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 11
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 12
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 13
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 14
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 15
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 16
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 17
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 18
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 19
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 20
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 21
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 22
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 23
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 24
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 25
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 26
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 27
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 28
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 29
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group0"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_new_patent_specific_HQ_and_subs_treat_all_vs_only_granted.xlsx", rowNames = F) 

#analyse using the classic did
# Create Create the Post-Treatment binary Variable
DataLong_Subs_sim_group0$post_treatment <- ifelse(DataLong_Subs_sim_group0$CurrentYear >= DataLong_Subs_sim_group0$first.treat & 
                                                    DataLong_Subs_sim_group0$Group <= DataLong_Subs_sim_group0$CurrentYear, 1, 0)

#the variables I'm really interested are: R_and_D_intensity, Patent_productivity, and 
#Patent_output_per_employee

#Basic DiD model without the moderator  
model <- lm(R_and_D_intensity ~ treat * post_treatment, data = DataLong_Subs_sim_group0) #this means (R&D Expenditure / Turnover)
summary(model) 
#treat                 0.12356    0.03141   3.934 0.0000841 ***
#post_treatment       -0.01063    0.02676  -0.397  0.691216    
#treat:post_treatment  0.11324    0.04676   2.422  0.015467 *  

#for non-standard it was:
#treat                  8902.4     2262.9   3.934 0.0000841 ***
#post_treatment         -765.7     1927.7  -0.397  0.691216    
#treat:post_treatment   8158.7     3369.1   2.422  0.015467 *  

# Basic DiD model WITHOUT the moderator 
model <- lm(Patent_productivity ~ treat * post_treatment, data = DataLong_Subs_sim_group0)
summary(model) 
#treat                -0.0004569  0.0371163  -0.012    0.990
#post_treatment        0.0519280  0.0329127   1.578    0.115
#treat:post_treatment -0.0502890  0.0561012  -0.896    0.370

#for non-standard it was:
#treat                -0.01740    1.41348  -0.012    0.990
#post_treatment        1.97754    1.25340   1.578    0.115
#treat:post_treatment -1.91513    2.13647  -0.896    0.370

model <- lm(Patent_output_per_employee ~ treat * post_treatment, data = DataLong_Subs_sim_group0)
summary(model) 
#treat                -0.03806    0.02956  -1.288    0.198
#post_treatment       -0.03760    0.02471  -1.521    0.128
#treat:post_treatment  0.03952    0.04445   0.889    0.374

#for non-standard it was:
#treat                 -19.209     14.917  -1.288   0.1979  
#post_treatment        -18.973     12.473  -1.521   0.1282  
#treat:post_treatment   19.946     22.433   0.889   0.3739 

model <- lm(Patent_output_per_turnover ~ treat * post_treatment, data = DataLong_Subs_sim_group0)
summary(model) 
#treat                 0.005265   0.035423   0.149    0.882  
#post_treatment        0.072758   0.031772   2.290    0.022 *
#treat:post_treatment -0.027240   0.053628  -0.508    0.612 

#for non-standard it was:
#treat                   10.59      71.25   0.149     0.882    
#post_treatment         146.35      63.91   2.290     0.022 *  
#treat:post_treatment   -54.79     107.87  -0.508     0.612 

#12. Analyzing other relevant variables ------
##12.1. Measuring effects for all sectors together -----
rm(list=ls())
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim <- DataLong_Subs_sim[,c(1:15, 26:52)]

DataLong_Subs_sim$Rate_granted <- DataLong_Subs_sim$n_granted_yes/(DataLong_Subs_sim$n_granted_na+DataLong_Subs_sim$n_granted_yes) 
DataLong_Subs_sim$Rate_granted_NoNAI <- DataLong_Subs_sim$n_granted_yes_nonai/(DataLong_Subs_sim$n_granted_na_nonai+DataLong_Subs_sim$n_granted_yes_nonai) 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096   F
table(DataLong_Subs_sim$Quartile) #bottom 9380                    medium  11004                 top 12712        

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196  F
table(DataLong_Subs_sim$Quartile) #bottom 11480                    medium  11004                 top 12712    

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740            medium   5502           top 6356   
table(nontreat_test$Quartile) #bottom 5740            medium   5502           top 6356   
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410      medium  393                         top 454      
rm(treat_test, nontreat_test)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3", "DataLong_Subs_sim_group0")

head(Patent_data)
rm(RCA_All_Years, Patent_data)

#define the possible variables
variables = c("Rate_granted", #rate of granted patents
              "n_granted_yes_ai", #rate of AI granted patents
              "n_granted_na_ai", #rate of AI not granted patents
              "avg_claims", #most used technology
              "avg_number_of_family_members", #number of specializations
              "avg_backward_citations", #for Sections
              "avg_forward_citations", #for 4-digit
              "avg_time_filing_to_publication",
              "avg_time_filing_to_grant",
              "avg_backward_citations_ai",
              "avg_forward_citations_ai",
              "avg_claims_ai",
              "avg_number_of_family_members_ai",
              "avg_time_filing_to_publication_ai",
              "avg_time_filing_to_grant_ai",
              "avg_time_filing_to_publication_NONai",
              "avg_time_filing_to_grant_NONai",
              "Rate_granted_NoNAI","n_granted_yes_nonai", "n_granted_na_nonai", "avg_number_of_family_members_nonai", 
              "avg_claims_nonai", "avg_backward_citations_nonai", "avg_forward_citations_nonai",
              "n_granted_na", "n_granted_yes") 

###12.2.1.Calculate the effects Non-standardized -----
DataLong_Subs_sim_group0 <- DataLong_Subs_sim

#####12.2.1.1. All variables group0----
######12.2.1.1.1.All treated together------
variable_n = 1
n_group = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 9
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 10
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 11
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 12
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 13
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 14
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 15
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 16
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 17
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 18
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 19
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 20
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 21
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 22
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 23
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 24
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 25
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 26
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

######12.2.1.1.2.Focus on granted treatment-----
#
#Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #
#DataLong_Subs_sim_group0<- left_join(DataLong_Subs_sim_group0,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim_group0 %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

treated <- DataLong_Subs_sim_group0[DataLong_Subs_sim_group0$treat == 1,]
length(unique(treated$Company)) #1257
nontreated <- DataLong_Subs_sim_group0[DataLong_Subs_sim_group0$treat == 0,]
treated <- treated[treated$total_granted_ai >0,]
length(unique(treated$Company)) #480

DataLong_Subs_sim_group0 <- rbind(treated, nontreated)

variable_n = 1
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 %>% drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 9
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 10
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 11
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 12
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 13
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 14
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 15
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 16
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 17
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 18
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 19
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 20
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 21
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 22
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 23
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 24
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 25
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 26
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

results_df2 <- results_df
results_df2$Group2 <- "all_vs_granted"
rm(results_df)

####12.2.1.2.Remaining variables for all the other groups------
#### Rate_granted
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

#### n_granted_yes_ai
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#### n_granted_na_ai
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_claims
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_number_of_family_members
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_backward_citations
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_forward_citations
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_time_filing_to_publication
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_time_filing_to_grant
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_backward_citations_ai
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_forward_citations_ai 
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_claims_ai 
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_number_of_family_members_ai  
#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_time_filing_to_publication_ai  
#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_time_filing_to_grant_ai  
#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_time_filing_to_publication_NONai  
#Group 1
variable_n = 16
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_time_filing_to_grant_NONai  
#Group 1
variable_n = 17
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Rate_granted_NoNAI  
#Group 1
variable_n = 18
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### n_granted_yes_nonai  
#Group 1
variable_n = 19
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### n_granted_na_nonai  
#Group 1
variable_n = 20
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_number_of_family_members_nonai  
#Group 1
variable_n = 21
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_claims_nonai  
#Group 1
variable_n = 22
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_backward_citations_nonai  
#Group 1
variable_n = 23
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### avg_forward_citations_nonai  
#Group 1
variable_n = 24
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### n_granted_na  
#Group 1
variable_n = 25
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### n_granted_yes
#Group 1
variable_n = 26
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df$Group2 <- "Per_group_AND_only_granted"
results_df <-rbind(results_df,results_df2)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group0","DataLong_Subs_sim_group1",
                                          "DataLong_Subs_sim_group2",
                                          "DataLong_Subs_sim_group3"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_new_patent_specific_other_patent_variables_treat_all_vs_only_granted.xlsx", rowNames = F) 

###12.2.2.Calculate the effects Standardized -----
DataLong_Subs_sim_group0 <- DataLong_Subs_sim

DataLong_Subs_sim_group0 <- DataLong_Subs_sim_group0 %>%
  mutate(across(where(is.numeric), ~ ifelse(is.infinite(.), NA, .))) %>% 
  mutate(across(where(is.numeric), ~ ifelse(. == -Inf, NA, .)))

DataLong_Subs_sim_group0[,c("Rate_granted", #rate of granted patents
                            "n_granted_yes_ai", #rate of AI granted patents
                            "n_granted_na_ai", #rate of AI not granted patents
                            "avg_claims", #most used technology
                            "avg_number_of_family_members", #number of specializations
                            "avg_backward_citations", #for Sections
                            "avg_forward_citations", #for 4-digit
                            "avg_time_filing_to_publication",
                            "avg_time_filing_to_grant",
                            "avg_backward_citations_ai",
                            "avg_forward_citations_ai",
                            "avg_claims_ai",
                            "avg_number_of_family_members_ai",
                            "avg_time_filing_to_publication_ai",
                            "avg_time_filing_to_grant_ai",
                            "avg_time_filing_to_publication_NONai",
                            "avg_time_filing_to_grant_NONai",
                            "Rate_granted_NoNAI","n_granted_yes_nonai", "n_granted_na_nonai", "avg_number_of_family_members_nonai", 
                            "avg_claims_nonai", "avg_backward_citations_nonai", "avg_forward_citations_nonai",
                            "n_granted_na", "n_granted_yes")] <- 
  scale(DataLong_Subs_sim_group0[,c("Rate_granted", #rate of granted patents
                                    "n_granted_yes_ai", #rate of AI granted patents
                                    "n_granted_na_ai", #rate of AI not granted patents
                                    "avg_claims", #most used technology
                                    "avg_number_of_family_members", #number of specializations
                                    "avg_backward_citations", #for Sections
                                    "avg_forward_citations", #for 4-digit
                                    "avg_time_filing_to_publication",
                                    "avg_time_filing_to_grant",
                                    "avg_backward_citations_ai",
                                    "avg_forward_citations_ai",
                                    "avg_claims_ai",
                                    "avg_number_of_family_members_ai",
                                    "avg_time_filing_to_publication_ai",
                                    "avg_time_filing_to_grant_ai",
                                    "avg_time_filing_to_publication_NONai",
                                    "avg_time_filing_to_grant_NONai",
                                    "Rate_granted_NoNAI","n_granted_yes_nonai", "n_granted_na_nonai", "avg_number_of_family_members_nonai", 
                                    "avg_claims_nonai", "avg_backward_citations_nonai", "avg_forward_citations_nonai",
                                    "n_granted_na", "n_granted_yes")])

#####12.2.2.1. All variables group0----
######12.2.2.1.1.All treated together------
variable_n = 1
n_group = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)
?drop_
variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 9
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 10
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 11
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 12
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 13
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 14
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 15
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 16
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 17
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 18
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 19
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 20
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 21
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 22
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 23
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 24
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 25
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

variable_n = 26
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_all_treat"))
results_df <- rbind(results_df, results_new)

######12.2.2.1.2.focus on granted treatment-----
DataLong_Subs_sim_group0 %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

treated <- DataLong_Subs_sim_group0[DataLong_Subs_sim_group0$treat == 1,]
length(unique(treated$Company)) #1257
nontreated <- DataLong_Subs_sim_group0[DataLong_Subs_sim_group0$treat == 0,]
treated <- treated[treated$total_granted_ai >0,]
length(unique(treated$Company)) #480

DataLong_Subs_sim_group0 <- rbind(treated, nontreated)

variable_n = 1
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 %>% drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 9
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 10
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 11
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 12
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 13
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 14
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 15
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 16
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 17
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 18
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 19
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 20
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 21
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 22
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 23
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 24
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 25
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

variable_n = 26
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name, "_only_granted"))
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("DataLong_Subs_sim_group0"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_new_patent_specific_other_patent_variables_treat_all_vs_only_granted.xlsx", rowNames = F) 

#13.Measuring effects 4 main variables-----
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
#Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_HQ_and_subs.csv", header = TRUE) #
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim <- DataLong_Subs_sim[,c(1:15, 26:length(DataLong_Subs_sim))]

#add information about patents developed by subsidiaries and other data (R&D, turnover)
setwd("C:/Users/mathe/OneDrive/Documentos/R/Database")
FinalDataset <- read.csv("files_created_code2/FinalDataset_allYears_FullGUOs.csv", sep = ";", header = TRUE, dec = ",")
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
FinalDataset <- FinalDataset[,c("Company", "CurrentYear","No_subs_extended", "NoPatentsYearALLSubs", "No_AI_PatentsYearALLSubs", 
                                "No_employees_Year", "Turnover_Year", "RandD_Year", "NoPatentsYearGUOalone", "No_new_PatentsYearGUOalone")]
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, FinalDataset, by = c("Company", "CurrentYear"))

#try to compensate for missing data from orbis:
Additional_data<-read_excel("Input_code/Big_files_ignore/NewData_03_2025.xlsx", sheet = "Results", na = "n.a.")
#test<-read_excel("Input_code/Big_files_ignore/Updated_data_companies_RandD.xlsx", sheet = "Results", na = "n.a.")

#clean names fix names change names improve names
Additional_data <- Additional_data[,c(-1)] %>%  clean_names()
#convert data into numeric
Additional_data <- Additional_data %>%
  mutate(across(-c(1, 2), ~ as.numeric(.)))
#Additional_data$price_book_value_ratio_average_high_low_2010
sample_data_long <- Additional_data %>%
  pivot_longer(
    cols = matches("^(number_of_publications_per_year_|operating_revenue_turnover_th_usd_|number_of_employees_|research_development_expenses_th_usd_|price_book_value_ratio_average_high_low_|market_capitalisation_shareholders_funds_)\\d+$"),
    names_to = c("Variable", "CurrentYear"),
    names_pattern = "(number_of_publications_per_year_|operating_revenue_turnover_th_usd_|number_of_employees_|research_development_expenses_th_usd_|price_book_value_ratio_average_high_low_|market_capitalisation_shareholders_funds_)(\\d+)",
    values_to = "Value"  ) %>%
  mutate(CurrentYear = as.integer(CurrentYear))

sample_data_wide <- sample_data_long %>%
  pivot_wider(names_from  = "Variable",
              values_from = "Value")
#new variables:
table(is.na(sample_data_wide$operating_revenue_turnover_th_usd_)) #21183  f, 14652  T
table(is.na(sample_data_wide$number_of_publications_per_year_)) #13337  F, 22498  T 
table(is.na(sample_data_wide$number_of_employees_)) #17630  F, 18205  T 
table(is.na(sample_data_wide$research_development_expenses_th_usd_))  #15864  F, 19971   T
table(is.na(sample_data_wide$price_book_value_ratio_average_high_low_))  #15205 f, 20630 t
table(is.na(sample_data_wide$market_capitalisation_shareholders_funds_))  #15219 F, 20616 

#hence, there is more data available for the new ones; particularly for RandD_Year and No_employees_Year
rm(sample_data_long, Additional_data)
head(sample_data_wide)
names(sample_data_wide) <- c("company_name_latin_alphabet","Company","CurrentYear", "number_patents_year", "operating_revenue_turnover","number_of_employees", "RandD_Year", "Stock_value", "Market_capitalisation")

#pay attention: in the old file, Orbis would make the R&D data available just under the variable "R&D expenses/Operating revenue (%)"; now it
#gives the absolute values for Turnover, i.e., "R&D expenses/Operating revenue"; the reading is more straightforward in the latter:
#it shows how the absolute proportion changed, instead of an absolute change in relation to a relative proportion (which I'm not even sure how to read);
#therefore, the new data is better; I could use the old R&D data if I'd multiply it by the turnover;

DataLong_Subs_sim <- subset(DataLong_Subs_sim, select = -c(No_employees_Year, Turnover_Year, RandD_Year))
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, sample_data_wide, by = c("Company","CurrentYear"))
#DataLong_Subs_sim <- full_join(DataLong_Subs_sim, sample_data_wide, by = c("Company","CurrentYear"))

#develop additional indicators
#for the whole company
#R&D Intensity (R&D Expenditure / Turnover)
DataLong_Subs_sim$R_and_D_intensity <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$operating_revenue_turnover
#Patent Productivity (Patents per R&D Investment)
DataLong_Subs_sim$Patent_productivity <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$RandD_Year
#Patent output per turnover
DataLong_Subs_sim$Patent_output_per_turnover<- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$operating_revenue_turnover
#Patent Output per Employee
DataLong_Subs_sim$Patent_output_per_employee <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$number_of_employees

#DataLong_Subs_sim$NoPatentsYearGUOalone 
#DataLong_Subs_sim$No_new_PatentsYearGUOalone

#number_patents_year
#NoPatentsYearGUOtotal

#REPLACE NANs of these last 8 columns by NA (check first)
#shouldn't I always use NA instead of NAN in this kind of replacement?
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(across(
    c("R_and_D_intensity", 
      "Patent_productivity", "Patent_output_per_employee", "Patent_output_per_turnover"),
    ~ ifelse(is.nan(.), NA, .)
  ))

#replace infinite values from Patent_productivity ad Patent_output_per_employee for NA
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(R_and_D_intensity = ifelse(is.infinite(R_and_D_intensity), NA, R_and_D_intensity)) %>% 
  mutate(Patent_productivity = ifelse(is.infinite(Patent_productivity), NA, Patent_productivity)) %>% 
  mutate(Patent_output_per_employee = ifelse(is.infinite(Patent_output_per_employee), NA, Patent_output_per_employee)) %>% 
  mutate(Patent_output_per_turnover = ifelse(is.infinite(Patent_output_per_turnover), NA, Patent_output_per_turnover))

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096   F
table(DataLong_Subs_sim$Quartile) #bottom 9380                    medium  11004                 top 12712        

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196  F
table(DataLong_Subs_sim$Quartile) #bottom 11480                    medium  11004                 top 12712    

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740            medium   5502           top 6356   
table(nontreat_test$Quartile) #bottom 5740            medium   5502           top 6356   
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410      medium  393                         top 454      
rm(treat_test, nontreat_test)

#create variable for separating granted from non-granted
DataLong_Subs_sim %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

#fill values down, so that we can benefit from the additional 2024 data:
#DataLong_Subs_sim <- DataLong_Subs_sim %>%
#  arrange(Company, CurrentYear) %>%
#  group_by(Company) %>%
#  fill(id, first.treat, treat, Group, .direction = "down") %>%
#  ungroup()

#test <- DataLong_Subs_sim[,c("Company","CurrentYear","number_patents_year","NoPatentsYearGUOtotal", "NoPatentsYearGUOalone", "No_new_PatentsYearGUOalone")]

#measuring all together without separation btw granted and not granted
DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
#groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3", "DataLong_Subs_sim_group0")
groups = c("All_companies","Only_granted_ai","Only_non_granted_ai")

#head(Patent_data)
rm(RCA_All_Years, Patent_data)

#define the possible variables
variables = c("R_and_D_intensity", "Patent_output_per_turnover",
              "Patent_productivity", "Patent_output_per_employee", "operating_revenue_turnover",
              "RandD_Year","Stock_value", "Market_capitalisation") 

#13.1 Calculate the effects Non-standardized -----
# All treated together
DataLong_Subs_sim_group0 <- DataLong_Subs_sim

#test:
#variable_n = 6
#estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
#                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
#agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
#summary(agg.es) #effect 1.3202        0.2976     0.5535      2.0868 *
#ggdid(agg.es) 

variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, paste0(variable_name))

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

#test <- 

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

treated <- DataLong_Subs_sim[DataLong_Subs_sim$total_granted_ai >0,]
untreated <- DataLong_Subs_sim[DataLong_Subs_sim$treat ==0,]
DataLong_Subs_sim_group0 <- rbind(treated, untreated)

variable_n = 1
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

treated <- DataLong_Subs_sim[DataLong_Subs_sim$total_granted_ai ==0 & DataLong_Subs_sim$treat ==1,]
untreated <- DataLong_Subs_sim[DataLong_Subs_sim$treat ==0,]
DataLong_Subs_sim_group0 <- rbind(treated, untreated)

variable_n = 1
n_group = 3
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("All_companies", "Only_granted_ai", "Only_non_granted_ai"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/main_variables_2025_data.xlsx", rowNames = F) 

#14 Effects new granted data (which is the old one)-----
##14.1. Measuring effects across sectors -----
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

DataLong_Subs_sim <-read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",")
dynamic_capabilities <- read.csv("Input_code/Big_files_ignore/df_dynamic_capabilities.csv", header = TRUE)
names(dynamic_capabilities)[names(dynamic_capabilities) == 'Year'] <- 'CurrentYear'
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, dynamic_capabilities, by=c("Company", "CurrentYear"))

length(unique(DataLong_Subs_sim$id)) #2514 ids 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

table(is.na(DataLong_Subs_sim$AIcodes)) #13607 F, 21589   T

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0
table(is.na(DataLong_Subs_sim$AIcodes)) #35196 F

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096        F  2100      T
table(DataLong_Subs_sim$Quartile) #bottom 9380              medium  11004            top 12712      

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196 F
table(DataLong_Subs_sim$Quartile) #bottom 11480             medium  11004            top 12712     

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740    medium   5502    top 6356 
table(nontreat_test$Quartile) #bottom 5740    medium   5502    top 6356 
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410                    medium  393                      top 454     
rm(treat_test, nontreat_test)

###10.2.1.Define new treatment-----
rm(CategoriesNace, dynamic_capabilities, mat_tech_rel, RCA_All_Years_treat_AI, RCA_All_Years)
#First, include information about granted and not granted patents
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_EXISTING_DATA.csv", header = TRUE) #
DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

Current_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
Current_non_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]

#so the treatment will now be companies that never had an AI patent granted
Current_treated_new_treat <-Current_treated[Current_treated$total_granted_ai ==0,]
backup_DataLong_Subs_sim <- DataLong_Subs_sim

####14.2.1.1.Treatment non-granted-----
DataLong_Subs_sim <- rbind(Current_treated_new_treat, Current_non_treated)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

#define the possible variables
variables = c("Relatedness_Cos2", #relatedness
              "NoPatentsYearGUOtotal", #innovative performance
              "Specializations_Usage", #usage of specializations
              "HigherUsage", #most used technology
              "Specializations_Number", #number of specializations
              "UniqueCodes", #for Sections
              "UniqueSubclass", #for 4-digit
              "Herfindahl",
              "Shannon",
              "AIcodes", #effect on the 5 codes most related to AI
              "No_AI_PatentsYearGUOtotal",#effect on number of AI patents
              "Dynamic_capabilities") #the share of codes that changed from one year to the other 

####14.2.1.1.0.Calculate the effects Non-standardized -----
######14.2.1.1.1.Relatedness
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
##dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.2.Innovative performance
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.2.00.NEW DYNAMIC CAPABILITIES 
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.3.Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.4.Most used technology
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.5.Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.6.Number of sections 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.7.Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.8.Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.9.Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Shannon = replace_na(Shannon, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Shannon = replace_na(Shannon, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.10.Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.11. Number of AI patents
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #1.7991        0.1562     1.4929      2.1053 *
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand.xlsx", rowNames = F) #Results_Effects_non_stand.xlsx with dyn capabilities now
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_WITH_DYN_CAP_new_treat_non_granted_old_data.xlsx", rowNames = F) 
rm(results_df)

####14.2.1.2.0.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

######14.2.1.2.1.Relatedness
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

#######14.2.1.2.2.Innovative performance
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#######14.2.1.2.2.00. NEW DYNAMIC CAPABILITIES
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#######14.2.1.2.3.Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.4.Most used technology
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.5.Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.6.Number of sections 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.7.Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.8.Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.9.Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.10.Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.11. Number of AI patents
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_stand.xlsx", rowNames = F)
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_WITH_DYN_CAP_new_treat_non_granted_old_data.xlsx", rowNames = F)

####14.2.1.1.Treatment granted-----
Current_treated_new_treat_granted <-Current_treated[Current_treated$total_granted_ai > 0,]
length(unique(Current_treated_new_treat_granted$Company)) #480
DataLong_Subs_sim <- rbind(Current_treated_new_treat_granted, Current_non_treated)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

#define the possible variables
variables = c("Relatedness_Cos2", #relatedness
              "NoPatentsYearGUOtotal", #innovative performance
              "Specializations_Usage", #usage of specializations
              "HigherUsage", #most used technology
              "Specializations_Number", #number of specializations
              "UniqueCodes", #for Sections
              "UniqueSubclass", #for 4-digit
              "Herfindahl",
              "Shannon",
              "AIcodes", #effect on the 5 codes most related to AI
              "No_AI_PatentsYearGUOtotal",#effect on number of AI patents
              "Dynamic_capabilities") #the share of codes that changed from one year to the other 

####14.2.1.1.0.Calculate the effects Non-standardized -----
######14.2.1.1.1.Relatedness
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
##dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.2.Innovative performance
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.2.00.NEW DYNAMIC CAPABILITIES 
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.3.Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.4.Most used technology
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.5.Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.6.Number of sections 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.7.Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.8.Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.9.Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Shannon = replace_na(Shannon, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Shannon = replace_na(Shannon, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.10.Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.11. Number of AI patents
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #1.7991        0.1562     1.4929      2.1053 *
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand.xlsx", rowNames = F) #Results_Effects_non_stand.xlsx with dyn capabilities now
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_WITH_DYN_CAP_new_treat_granted_old_data.xlsx", rowNames = F) 
rm(results_df)

####14.2.1.2.Calculate the effects Standardized -----
#standardize per group
DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group1[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group2[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                            "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")] <- 
  scale(DataLong_Subs_sim_group3[,c("Relatedness_Cos2", "Specializations_Usage", "HigherUsage","Specializations_Number",
                                    "Herfindahl", "Shannon", "NoPatentsYearGUOtotal", "UniqueCodes", "UniqueSubclass", "AIcodes", "No_AI_PatentsYearGUOtotal", "Dynamic_capabilities")])

######14.2.1.2.1.Relatedness
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0719        0.0448    -0.0159      0.1598 
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)

agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.108        0.0431     0.0235      0.1925 *
ggdid(agg.es) 

#######14.2.1.2.2.Innovative performance
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#######14.2.1.2.2.00. NEW DYNAMIC CAPABILITIES
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2826        0.1538    -0.0189      0.5841
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) # 0.1222        0.0431     0.0378      0.2066 *
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#######14.2.1.2.3.Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.4.Most used technology
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.5.Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.6.Number of sections 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.7.Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.8.Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.9.Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.10.Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.2.11. Number of AI patents
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_stand.xlsx", rowNames = F)
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_stand_WITH_DYN_CAP_new_treat_granted_old_data.xlsx", rowNames = F)

####14.3.1.1.STRONG AI -----
#table(Current_treated$total_granted_ai)
#q3 <- quantile(Current_treated$total_granted_ai, 0.75, na.rm = TRUE)
#table(Current_treated$top_quartile_ai)
Current_treated_new_treat_granted <-Current_treated[Current_treated$total_granted_ai > 0,]
length(unique(Current_treated_new_treat_granted$Company)) #375 with 2020 data, 480 with 2025 data
quantile(Current_treated_new_treat_granted$total_granted_ai, 0.75, na.rm = TRUE)
#2 is the top 75% quantile, but let's pick everything above 2;
Current_treated_new_treat_granted <-Current_treated[Current_treated$total_granted_ai > 1,]

DataLong_Subs_sim <- rbind(Current_treated_new_treat_granted, Current_non_treated)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

#define the possible variables
variables = c("Relatedness_Cos2", #relatedness
              "NoPatentsYearGUOtotal", #innovative performance
              "Specializations_Usage", #usage of specializations
              "HigherUsage", #most used technology
              "Specializations_Number", #number of specializations
              "UniqueCodes", #for Sections
              "UniqueSubclass", #for 4-digit
              "Herfindahl",
              "Shannon",
              "AIcodes", #effect on the 5 codes most related to AI
              "No_AI_PatentsYearGUOtotal",#effect on number of AI patents
              "Dynamic_capabilities") #the share of codes that changed from one year to the other 

####14.2.1.1.0.Calculate the effects Non-standardized -----
######14.2.1.1.1.Relatedness
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
##dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.2.Innovative performance
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.2.00.NEW DYNAMIC CAPABILITIES 
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.3.Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.4.Most used technology
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.5.Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.6.Number of sections 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.7.Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.8.Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.9.Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Shannon = replace_na(Shannon, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Shannon = replace_na(Shannon, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.10.Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.11. Number of AI patents
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #1.7991        0.1562     1.4929      2.1053 *
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand.xlsx", rowNames = F) #Results_Effects_non_stand.xlsx with dyn capabilities now
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_WITH_DYN_CAP_new_treat_granted_old_data_strong_AI.xlsx", rowNames = F) 
rm(results_df)

####14.3.1.1.STRONG AI NEW DATA-----
#table(Current_treated$total_granted_ai)
#q3 <- quantile(Current_treated$total_granted_ai, 0.75, na.rm = TRUE)
#table(Current_treated$top_quartile_ai)
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #
Patent_data <- Patent_data[,c("Company", "CurrentYear", "n_granted_yes_ai")]
names(Patent_data) <- c("Company", "CurrentYear", "n_granted_yes_ai_2025")
#length(unique(Patent_data$Company)) #2390

#backup_DataLong_Subs_sim2 <- DataLong_Subs_sim
DataLong_Subs_sim <-backup_DataLong_Subs_sim
DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))

DataLong_Subs_sim %<>% group_by(Company) %>% mutate(total_granted_ai_2025 = max(n_granted_yes_ai_2025, na.rm =T )) %>% ungroup()
table(DataLong_Subs_sim$total_granted_ai_2025)
#table(DataLong_Subs_sim$total_granted_ai)

Current_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
Current_non_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]

Current_treated_new_treat_granted <-Current_treated[Current_treated$total_granted_ai_2025 > 0,]
length(unique(Current_treated_new_treat_granted$Company)) #480 with 2025 data (it was 375 with 2020 data, )

quantile(Current_treated_new_treat_granted$total_granted_ai_2025, 0.75, na.rm = TRUE)
#2 is the top 75% quantile, but let's pick everything above 2;
Current_treated_new_treat_granted <-Current_treated[Current_treated$total_granted_ai_2025 > 2,]

DataLong_Subs_sim <- rbind(Current_treated_new_treat_granted, Current_non_treated)

DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3")

#define the possible variables
variables = c("Relatedness_Cos2", #relatedness
              "NoPatentsYearGUOtotal", #innovative performance
              "Specializations_Usage", #usage of specializations
              "HigherUsage", #most used technology
              "Specializations_Number", #number of specializations
              "UniqueCodes", #for Sections
              "UniqueSubclass", #for 4-digit
              "Herfindahl",
              "Shannon",
              "AIcodes", #effect on the 5 codes most related to AI
              "No_AI_PatentsYearGUOtotal",#effect on number of AI patents
              "Dynamic_capabilities") #the share of codes that changed from one year to the other 

####14.2.1.1.0.Calculate the effects Non-standardized -----
######14.2.1.1.1.Relatedness
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
##dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.2.Innovative performance
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.2.00.NEW DYNAMIC CAPABILITIES 
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_dyn_cap_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Share of dynamic capabilities") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the share of dynamic capabilities") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#######14.2.1.1.3.Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.4.Most used technology
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.5.Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.6.Number of sections 
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueCodes = replace_na(UniqueCodes, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.7.Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(UniqueSubclass = replace_na(UniqueSubclass, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.8.Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Herfindahl = replace_na(Herfindahl, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.9.Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_group2 %>%
  mutate(Shannon = replace_na(Shannon, 0))

#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_group3 %>%
  mutate(Shannon = replace_na(Shannon, 0))
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.10.Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#######14.2.1.1.11. Number of AI patents
#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #
ggdid(agg.es) 

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #1.7991        0.1562     1.4929      2.1053 *
ggdid(agg.es) 

#write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand.xlsx", rowNames = F) #Results_Effects_non_stand.xlsx with dyn capabilities now
write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_WITH_DYN_CAP_new_treat_granted_NEW_data_strong_AI.xlsx", rowNames = F) 
rm(results_df)

#15.Measuring effects 4 main variables with extension-----
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <- read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",") #
#Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_HQ_and_subs.csv", header = TRUE) #
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim <- DataLong_Subs_sim[,c(1:15, 26:length(DataLong_Subs_sim))]

#add information about patents developed by subsidiaries and other data (R&D, turnover)
setwd("C:/Users/mathe/OneDrive/Documentos/R/Database")
FinalDataset <- read.csv("files_created_code2/FinalDataset_allYears_FullGUOs.csv", sep = ";", header = TRUE, dec = ",")
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
FinalDataset <- FinalDataset[,c("Company", "CurrentYear","No_subs_extended", "NoPatentsYearALLSubs", "No_AI_PatentsYearALLSubs", 
                                "No_employees_Year", "Turnover_Year", "RandD_Year", "NoPatentsYearGUOalone", "No_new_PatentsYearGUOalone")]
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, FinalDataset, by = c("Company", "CurrentYear"))

#try to compensate for missing data from orbis:
Additional_data<-read_excel("Input_code/Big_files_ignore/NewData_03_2025.xlsx", sheet = "Results", na = "n.a.")
#test<-read_excel("Input_code/Big_files_ignore/Updated_data_companies_RandD.xlsx", sheet = "Results", na = "n.a.")

#clean names fix names change names improve names
Additional_data <- Additional_data[,c(-1)] %>%  clean_names()
#convert data into numeric
Additional_data <- Additional_data %>%
  mutate(across(-c(1, 2), ~ as.numeric(.)))
#Additional_data$price_book_value_ratio_average_high_low_2010
sample_data_long <- Additional_data %>%
  pivot_longer(
    cols = matches("^(number_of_publications_per_year_|operating_revenue_turnover_th_usd_|number_of_employees_|research_development_expenses_th_usd_|price_book_value_ratio_average_high_low_|market_capitalisation_shareholders_funds_)\\d+$"),
    names_to = c("Variable", "CurrentYear"),
    names_pattern = "(number_of_publications_per_year_|operating_revenue_turnover_th_usd_|number_of_employees_|research_development_expenses_th_usd_|price_book_value_ratio_average_high_low_|market_capitalisation_shareholders_funds_)(\\d+)",
    values_to = "Value"  ) %>%
  mutate(CurrentYear = as.integer(CurrentYear))

sample_data_wide <- sample_data_long %>%
  pivot_wider(names_from  = "Variable",
              values_from = "Value")
#new variables:
table(is.na(sample_data_wide$operating_revenue_turnover_th_usd_)) #21183  f, 14652  T
table(is.na(sample_data_wide$number_of_publications_per_year_)) #13337  F, 22498  T (this one doesn't matter, I wont use)
table(is.na(sample_data_wide$number_of_employees_)) #17630  F, 18205  T 
table(is.na(sample_data_wide$research_development_expenses_th_usd_))  #15864  F, 19971   T
table(is.na(sample_data_wide$price_book_value_ratio_average_high_low_))  #15205 f, 20630 t
table(is.na(sample_data_wide$market_capitalisation_shareholders_funds_))  #15219 F, 20616 

#hence, there is more data available for the new ones; particularly for RandD_Year and No_employees_Year
rm(sample_data_long, Additional_data)
head(sample_data_wide)
names(sample_data_wide) <- c("company_name_latin_alphabet","Company","CurrentYear", "number_patents_year", "operating_revenue_turnover","number_of_employees", "RandD_Year", "Stock_value", "Market_capitalisation")

#pay attention: in the old file, Orbis would make the R&D data available just under the variable "R&D expenses/Operating revenue (%)"; now it
#gives the absolute values for Turnover, i.e., "R&D expenses/Operating revenue"; the reading is more straightforward in the latter:
#it shows how the absolute proportion changed, instead of an absolute change in relation to a relative proportion (which I'm not even sure how to read);
#therefore, the new data is better; I could use the old R&D data if I'd multiply it by the turnover;

DataLong_Subs_sim <- subset(DataLong_Subs_sim, select = -c(No_employees_Year, Turnover_Year, RandD_Year))
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, sample_data_wide, by = c("Company","CurrentYear"))
#DataLong_Subs_sim <- full_join(DataLong_Subs_sim, sample_data_wide, by = c("Company","CurrentYear"))

#test <- DataLong_Subs_sim[,c("Company","CurrentYear", "No_new_PatentsYearGUOalone", "operating_revenue_turnover",
 #                            "RandD_Year", "number_of_employees")]

backup<-DataLong_Subs_sim #n_granted_yes_ai

#linear interpolation within firms for short gaps in financial performance, R&D inputs, and Number of new patents:
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  arrange(Company, CurrentYear) %>%
  group_by(Company) %>%
  mutate(
    operating_revenue_turnover = na.approx(operating_revenue_turnover, na.rm = FALSE),
    RandD_Year = na.approx(RandD_Year, na.rm = FALSE),
    No_new_PatentsYearGUOalone = na.approx(No_new_PatentsYearGUOalone, na.rm = FALSE)
  ) %>%
  ungroup()

#Employment data is often sticky over time, thus forward/backward filling is accepted in economics 
#literature (e.g., Hall & Oriani, Research Policy, 2006):
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  arrange(Company, CurrentYear) %>%
  group_by(Company) %>%
  mutate(number_of_employees = zoo::na.locf(number_of_employees, na.rm = FALSE)) %>%
  mutate(number_of_employees = zoo::na.locf(number_of_employees, fromLast = TRUE, na.rm = FALSE)) %>%
  ungroup()


#For more rigorous applications (e.g., regressions), apply multiple imputation using panel-aware methods:
# Select relevant variables
imp_data <- backup %>%
  select(operating_revenue_turnover, RandD_Year, number_of_employees, No_new_PatentsYearGUOalone)

# Use Predictive Mean Matching for all
imp <- mice(imp_data, m = 5, method = "pmm", seed = 123)

# Completed dataset
DataLong_Subs_sim_imputed <- complete(imp, action = 1)
DataLong_Subs_sim_imputed <- cbind(backup[,c("Company", "CurrentYear", "n_granted_yes_ai",
                                             "Stock_value", "Market_capitalisation",
                                             "id","first.treat", "treat")], DataLong_Subs_sim_imputed)


#develop additional indicators
#for the whole company
#R&D Intensity (R&D Expenditure / Turnover)
DataLong_Subs_sim$R_and_D_intensity <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$operating_revenue_turnover
#Patent Productivity (Patents per R&D Investment)
DataLong_Subs_sim$Patent_productivity <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$RandD_Year
#Patent output per turnover
DataLong_Subs_sim$Patent_output_per_turnover<- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$operating_revenue_turnover
#Patent Output per Employee
DataLong_Subs_sim$Patent_output_per_employee <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$number_of_employees

#DataLong_Subs_sim$NoPatentsYearGUOalone 
#DataLong_Subs_sim$No_new_PatentsYearGUOalone

#number_patents_year
#NoPatentsYearGUOtotal

#REPLACE NANs of these last 8 columns by NA (check first)
#shouldn't I always use NA instead of NAN in this kind of replacement?
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(across(
    c("R_and_D_intensity", 
      "Patent_productivity", "Patent_output_per_employee", "Patent_output_per_turnover"),
    ~ ifelse(is.nan(.), NA, .)
  ))

#replace infinite values from Patent_productivity ad Patent_output_per_employee for NA
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(R_and_D_intensity = ifelse(is.infinite(R_and_D_intensity), NA, R_and_D_intensity)) %>% 
  mutate(Patent_productivity = ifelse(is.infinite(Patent_productivity), NA, Patent_productivity)) %>% 
  mutate(Patent_output_per_employee = ifelse(is.infinite(Patent_output_per_employee), NA, Patent_output_per_employee)) %>% 
  mutate(Patent_output_per_turnover = ifelse(is.infinite(Patent_output_per_turnover), NA, Patent_output_per_turnover))

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096   F
table(DataLong_Subs_sim$Quartile) #bottom 9380                    medium  11004                 top 12712        

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196  F
table(DataLong_Subs_sim$Quartile) #bottom 11480                    medium  11004                 top 12712    

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740            medium   5502           top 6356   
table(nontreat_test$Quartile) #bottom 5740            medium   5502           top 6356   
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410      medium  393                         top 454      
rm(treat_test, nontreat_test)

#create variable for separating granted from non-granted
DataLong_Subs_sim %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

#fill values down, so that we can benefit from the additional 2024 data:
#DataLong_Subs_sim <- DataLong_Subs_sim %>%
#  arrange(Company, CurrentYear) %>%
#  group_by(Company) %>%
#  fill(id, first.treat, treat, Group, .direction = "down") %>%
#  ungroup()

#test <- DataLong_Subs_sim[,c("Company","CurrentYear","number_patents_year","NoPatentsYearGUOtotal", "NoPatentsYearGUOalone", "No_new_PatentsYearGUOalone")]

#measuring all together without separation btw granted and not granted
DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "top" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "medium" & is.na(DataLong_Subs_sim$Quartile) == F,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "bottom"& is.na(DataLong_Subs_sim$Quartile) == F,]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
#groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3", "DataLong_Subs_sim_group0")
groups = c("All_companies","Only_granted_ai","Only_non_granted_ai")

#head(Patent_data)
rm(RCA_All_Years, Patent_data)

#define the possible variables
variables = c("R_and_D_intensity", "Patent_output_per_turnover",
              "Patent_productivity", "Patent_output_per_employee", "operating_revenue_turnover",
              "RandD_Year","Stock_value", "Market_capitalisation") 

#15.1 Calculate the effects Non-standardized -----
# All treated together
DataLong_Subs_sim_group_test <- DataLong_Subs_sim

variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, paste0(variable_name))

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

#test <- 

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

treated <- DataLong_Subs_sim[DataLong_Subs_sim$total_granted_ai >0,]
untreated <- DataLong_Subs_sim[DataLong_Subs_sim$treat ==0,]
DataLong_Subs_sim_group0 <- rbind(treated, untreated)

variable_n = 1
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

treated <- DataLong_Subs_sim[DataLong_Subs_sim$total_granted_ai ==0 & DataLong_Subs_sim$treat ==1,]
untreated <- DataLong_Subs_sim[DataLong_Subs_sim$treat ==0,]
DataLong_Subs_sim_group0 <- rbind(treated, untreated)

variable_n = 1
n_group = 3
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("All_companies", "Only_granted_ai", "Only_non_granted_ai"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/main_variables_2025_data_with_extension.xlsx", rowNames = F)

#15.2 Additional imputation Non-standardized -----
# All treated together
DataLong_Subs_sim <- DataLong_Subs_sim_imputed

#develop additional indicators
#for the whole company
#R&D Intensity (R&D Expenditure / Turnover)
DataLong_Subs_sim$R_and_D_intensity <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$operating_revenue_turnover
#Patent Productivity (Patents per R&D Investment)
DataLong_Subs_sim$Patent_productivity <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$RandD_Year
#Patent output per turnover
DataLong_Subs_sim$Patent_output_per_turnover<- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$operating_revenue_turnover
#Patent Output per Employee
DataLong_Subs_sim$Patent_output_per_employee <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$number_of_employees

#DataLong_Subs_sim$NoPatentsYearGUOalone 
#DataLong_Subs_sim$No_new_PatentsYearGUOalone

#number_patents_year
#NoPatentsYearGUOtotal

#REPLACE NANs of these last 8 columns by NA (check first)
#shouldn't I always use NA instead of NAN in this kind of replacement?
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(across(
    c("R_and_D_intensity", 
      "Patent_productivity", "Patent_output_per_employee", "Patent_output_per_turnover"),
    ~ ifelse(is.nan(.), NA, .)
  ))

#replace infinite values from Patent_productivity ad Patent_output_per_employee for NA
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(R_and_D_intensity = ifelse(is.infinite(R_and_D_intensity), NA, R_and_D_intensity)) %>% 
  mutate(Patent_productivity = ifelse(is.infinite(Patent_productivity), NA, Patent_productivity)) %>% 
  mutate(Patent_output_per_employee = ifelse(is.infinite(Patent_output_per_employee), NA, Patent_output_per_employee)) %>% 
  mutate(Patent_output_per_turnover = ifelse(is.infinite(Patent_output_per_turnover), NA, Patent_output_per_turnover))

#create variable for separating granted from non-granted
DataLong_Subs_sim %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

DataLong_Subs_sim_group0 <- DataLong_Subs_sim

#test:
#variable_n = 6
#estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
#                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
#agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
#summary(agg.es) #effect 1.3202        0.2976     0.5535      2.0868 *
#ggdid(agg.es) 

variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, paste0(variable_name))

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

#test <- 

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

treated <- DataLong_Subs_sim[DataLong_Subs_sim$total_granted_ai >0,]
untreated <- DataLong_Subs_sim[DataLong_Subs_sim$treat ==0,]
DataLong_Subs_sim_group0 <- rbind(treated, untreated)

variable_n = 1
n_group = 2
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

treated <- DataLong_Subs_sim[DataLong_Subs_sim$total_granted_ai ==0 & DataLong_Subs_sim$treat ==1,]
untreated <- DataLong_Subs_sim[DataLong_Subs_sim$treat ==0,]
DataLong_Subs_sim_group0 <- rbind(treated, untreated)

variable_n = 1
n_group = 3
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 2
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 3
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 4
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0  %>% 
                        drop_na())
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 5
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 6
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 7
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

variable_n = 8
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
results_new <- calculate_ci_and_significance(att, se, group, paste0(variable_name))
results_df <- rbind(results_df, results_new)

results_df <- results_df %>%
  # Make Group a factor with the desired order
  mutate(Group = factor(Group, levels = c("All_companies", "Only_granted_ai", "Only_non_granted_ai"))) %>%
  # Arrange by Variable (alphabetically) and then by Group factor
  arrange(Variable, Group)

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/main_variables_2025_data_with_extension_add_imput.xlsx", rowNames = F)

#16.Measure effects per Nace_4d code-----
#focus on relatedness and innov performance; plus, add quartile info, maybe diff in relation to quartile average;
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
DataLong_Subs_sim <-read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",")

length(unique(DataLong_Subs_sim$id)) #2514 ids 

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #33096        F  2100      T
table(DataLong_Subs_sim$Quartile) #bottom 9380              medium  11004            top 12712      

DataLong_Subs_sim$Quartile[is.na(DataLong_Subs_sim$Quartile)] <- "bottom"
table(is.na(DataLong_Subs_sim$Quartile)) #35196 F
table(DataLong_Subs_sim$Quartile) #bottom 11480             medium  11004            top 12712     

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740    medium   5502    top 6356 
table(nontreat_test$Quartile) #bottom 5740    medium   5502    top 6356 
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 410                    medium  393                      top 454     
rm(treat_test, nontreat_test)

rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

DataLong_Subs_sim <-read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",")
dynamic_capabilities <- read.csv("Input_code/Big_files_ignore/df_dynamic_capabilities.csv", header = TRUE)
names(dynamic_capabilities)[names(dynamic_capabilities) == 'Year'] <- 'CurrentYear'
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, dynamic_capabilities, by=c("Company", "CurrentYear"))

length(unique(DataLong_Subs_sim$id)) #2514 ids 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

table(is.na(DataLong_Subs_sim$AIcodes)) #13607 F, 21589   T

#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0
table(is.na(DataLong_Subs_sim$AIcodes)) #35196 F

#Insert distance  measure
CategoriesNace <-read.csv("Input_code/Big_files_ignore/Additional_data_patents/new_distance_testing_ready3.csv")#, sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
CategoriesNace$Nace_4d <- as.character(CategoriesNace$Nace_4d)
CategoriesNace <- CategoriesNace[,c(1,10)] #for top9, which is the final chosen one
names(CategoriesNace) <- c("Nace_4d", "Quartile")

#old measure
#CategoriesNace <-read.csv("Output_code/Data/Distance_NACE_sectors_to_AI.csv", sep = ";", header = TRUE, dec=",")#[,c(-1)] #doesn't work, no significance
#DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #35196 f
table(DataLong_Subs_sim$Quartile) #bottom 6048              IQR  13496            top 15652       

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 5740    medium   5502    top 6356 
table(nontreat_test$Quartile) #bottom 5740    medium   5502    top 6356 
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 216                    medium  482                      top 559     
rm(treat_test, nontreat_test)

rm(CategoriesNace, dynamic_capabilities, mat_tech_rel, RCA_All_Years_treat_AI, RCA_All_Years)
#First, include information about granted and not granted patents
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #
DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))
DataLong_Subs_sim %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

test <- DataLong_Subs_sim[,c("Company", "CurrentYear", "NoPatentsYearGUOtotal","n_granted_yes", "n_granted_na")]

Current_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
Current_non_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
#test <- Current_treated[,c(3,8:15, 30:33, 35:37,57)]
#test %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()
test <- Current_treated[Current_treated$total_granted_ai ==0,]
length(unique(test$Company)) #777
length(unique(Current_treated$Company)) #1257
rm(test)

#unique_Nace <- as.data.frame(unique(DataLong_Subs_sim$Nace_4d))
#names(unique_Nace) <- "group_name"
length(unique(DataLong_Subs_sim$Nace_4d)) #198

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

# Main Function to Calculate Effects for All Groups and Variables
calculate_all_effects <- function(DataLong_Subs_sim, tname, idname, gname, groups, variables) {
  
  # Initialize an empty list to store all results
  all_results <- list()
  
  # Loop through each variable
  for (variable_n in 1:length(variables)) {
    
    variable_name <- variables[variable_n]
    
    # Loop through each group
    for (n_group in 1:length(groups)) {
      
      group <- groups[n_group] # Access the group value directly
      
      # Print current group being processed (for tracking)
      print(paste("Processing: Variable =", variable_name, ", Group =", group))
      
      # Filter data for the current group
      data_subset <- DataLong_Subs_sim[DataLong_Subs_sim$Nace_4d == group,]
      
      # Check if the subset is empty (Avoids errors and provides a message)
      if (nrow(data_subset) == 0) {
        message(paste("Skipping group", group, "because the data subset is empty."))
        next # Skips to the next iteration of the loop
      }
      
      # Estimate ATT
      tryCatch({
        estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                              yname = variable_name, data = data_subset)
        
        agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
        
        # Extract estimate values
        att <- agg.simple$overall.att
        se <- agg.simple$overall.se
        
        # Calculate confidence intervals and significance
        results_df <- calculate_ci_and_significance(att, se, group, variable_name)
        
        # Store results
        all_results[[length(all_results) + 1]] <- results_df
      }, error = function(e) {
        # Error Handling:  If att_gt fails, print an error message and continue
        message(paste("Error in att_gt for group", group, ":", e$message))
      })
    }
  }
  
  # Combine all results into a single dataframe
  final_results_df <- do.call(rbind, all_results)
  
  return(final_results_df)
}

# Call the main function
tname = "CurrentYear"
idname = "id"
gname = "first.treat"

#Ensure groups are characters:
groups = as.character(unlist(unique(DataLong_Subs_sim$Nace_4d)))
variables = c("Relatedness_Cos2", "NoPatentsYearGUOtotal")

all_results <- calculate_all_effects(DataLong_Subs_sim, tname, idname, gname, groups, variables)

#all_results_backup<-all_results
#all_results <- all_results_backup
names(all_results)[names(all_results) == 'Group'] <- 'Nace_4d'

Simplified_data <- DataLong_Subs_sim[, c("Nace_4d", "Quartile")]
Simplified_data <- Simplified_data %>%
  distinct(Nace_4d, Quartile)

all_results <- left_join(all_results, Simplified_data, by = "Nace_4d" )
all_results$Estimated_Related_group <- ifelse(all_results$Quartile == "Top", 1.348, ifelse(all_results$Quartile == "IQR",
                                                                                           1.096, 0.762))

all_results$std_dev <- ifelse(all_results$Quartile == "Top", 0.380, ifelse(all_results$Quartile == "IQR",
                                                                           0.326, 0.331))

all_results$Diff <- ifelse(all_results$ATT < all_results$Estimated_Related_group - all_results$std_dev |
                             all_results$ATT > all_results$Estimated_Related_group + all_results$std_dev, "outside_std","inside_std")

all_results <- all_results %>% group_by(Quartile,Variable) %>% 
  mutate(outside_std_count = sum(Diff == "outside_std"),
         inside_std_count = sum(Diff == "inside_std"),
    share_correct = inside_std_count/(outside_std_count+inside_std_count),
    mean_Variable = mean(ATT)
  ) %>% ungroup()

write.xlsx(all_results, file = "Input_code/Big_files_ignore/NEW_FIG/Effects_per_sector2.xlsx", rowNames = F) 

all_results_rel <- all_results[all_results$Variable == "Relatedness_Cos2",]

#17.Calculate new techn distances-----
#aggregate sectors by specializations, and measure the share of specializations they have in the 5/10 codes
#most related to AI;
##17.1.First alternative------
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
all_patents <-fread("Input_code/Big_files_ignore/All_patents.csv")

#Now we add the nace codes:
CompaniesData1<-read_excel("Input_code/Big_files_ignore/DataCompanies1.xlsx", sheet = "Results", na = "n.a.")
CompaniesData2<-read_excel("Input_code/Big_files_ignore/DataCompanies2.xlsx", sheet = "Results", na = "n.a.")
CompaniesData3<-read_excel("Input_code/Big_files_ignore/DataCompanies3.xlsx", sheet = "Results", na = "n.a.")
CompaniesData4<-read_excel("Input_code/Big_files_ignore/DataCompanies4.xlsx", sheet = "Results", na = "n.a.")
CompaniesData5<-read_excel("Input_code/Big_files_ignore/DataCompanies5.xlsx", sheet = "Results", na = "n.a.")
CompaniesData6<-read_excel("Input_code/Big_files_ignore/DataCompanies6.xlsx", sheet = "Results", na = "n.a.")
CompaniesData <- rbind(CompaniesData1,CompaniesData2,CompaniesData3,CompaniesData4,CompaniesData5,CompaniesData6)
rm(CompaniesData1,CompaniesData2,CompaniesData3,CompaniesData4,CompaniesData5,CompaniesData6)

CompaniesData <- CompaniesData[,c(2,3,6)] 
names(CompaniesData) <- c("Company_name", "Company", "Nace_4d")

all_patents <- left_join(all_patents, CompaniesData, by = "Company")
table(is.na(all_patents$Nace_4d)) #12,188,742   F (i.e., companies with NACE), and 570,280   T

#drop companies without Nace codes:
all_patents <- all_patents[is.na(all_patents$Nace_4d) == F,]
rm(CompaniesData)
#exclude company name:
all_patents<-all_patents[,c(-7)]

#create the 3 functions we'll use later:
#1.create a function for fractional counting IPC codes on which patent
group_by_applnID <- function (data){
  data %>%
    group_by(PubNo) %>%
    mutate(field_weight = 1 / n()) %>%
    ungroup()
}
#2.create a function for counting the relative participation of each IPC code for each NACE sector
group_by_NACE_and_Subclass <- function (data){
  data %<>%
    group_by(Nace_4d, Subclass) %>%
    summarise(n_tech_reg = sum(field_weight)) %>%
    ungroup() %>%
    drop_na() 
}  

length(unique(all_patents$PubNo)) #7,354,214 (same number, because we just removed the repeated added AI patents)
#table(all_patents$AIpatent) #257,044 (different number because we removed the extra AI patents but not the original ones)

#count total of patents of each sector, and total of AI patents;
all_patents %<>% group_by(Nace_4d) %>% 
  mutate(TotalPatents = length(unique(PubNo))) %>% #get the higher share of usage
  mutate(TotalAIPatents = length(na.omit(unique(PubNo[AIpatent == "Yes"])))) %>% 
  mutate(ShareAI = TotalAIPatents/TotalPatents) %>% 
  ungroup()

#describe(all_patents$TotalPatents) #I'm using the describe from the psych library
#so, number of patents varies from 1 to 936,534  , with a median value of 142,695. Let's exclude the sectors that are way below that, let's say, by having less than 500 patents:
#all_patents <- all_patents[all_patents$TotalPatents >= 500,]
length(unique(all_patents$Nace_4d)) #620 sectors (including the fake AI one) with at least 500 patents

#Finally, let's apply the two functions we created before:
reg_tech <- group_by_applnID(all_patents) #this gets the relative participation of each IPC code on each patent
reg_tech <- group_by_NACE_and_Subclass(reg_tech) #this gets the sum of the relative participation of each code for each NACE

rm(all_patents)

#let's convert this into a matrix where we have one line per NACE code, and all technologies linked to them in the columns
mat_reg_tech <- reg_tech %>%
  arrange(Subclass) %>% 
  pivot_wider(names_from = Subclass, values_from = n_tech_reg, values_fill = list(n_tech_reg = 0)) #

#let's throw the nace codes into the column names
mat_reg_tech %<>% remove_rownames %>% column_to_rownames(var="Nace_4d") %>%
  as.matrix() %>%
  round() #

#and calculate binary specializations
rel_sectors_codes <- mat_reg_tech %>% location_quotient(binary = T) %>% 
  as.data.frame() %>% 
  rownames_to_column("mat_reg_tech") %>% 
  as_tibble() %>% 
  gather(key = "Subclass", value = "RCA", -mat_reg_tech) %>%
  arrange(mat_reg_tech, Subclass)

#backup<- rel_sectors_codes
#rel_sectors_codes <- backup

#let's transform this back into a matrix:
#rel_sectors_codes %<>%
#  arrange(Subclass, mat_reg_tech) %>%
#  pivot_wider(names_from = Subclass, values_from = RCA, values_fill = list(RCA = 0)) #transform on a binary-like matrix
rm(mat_reg_tech)

#let's see now which ones are the main AI codes
mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
#let's pick the 5 codes with higher relatedness to AI:
AI_codes_top6 <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.044,1] #6 codes #0.2 for 15 #chosen one, with 7 codes;
AI_codes_top8 <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.041,1] #8 codes
AI_codes_top9 <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.038,1] #9 codes

length(unique(rel_sectors_codes$Subclass)) #645 subclasses
length(unique(rel_sectors_codes$mat_reg_tech)) #620 unique sectors

# Function to count specializations for a given list of codes
count_specializations <- function(data, code_list, column_name) {
  data %>% mutate(
      !!column_name := case_when(Subclass %in% code_list & RCA == 1 ~ 1,
        TRUE ~ 0)) %>%
    group_by(mat_reg_tech) %>%
    summarise(!!column_name := sum(!!as.symbol(column_name), na.rm = TRUE), .groups = "drop")
}

# Create the new columns
rel_sectors_codes <- rel_sectors_codes %>%
  left_join(count_specializations(rel_sectors_codes, AI_codes_top9, "AI_specializations_top9"), by = "mat_reg_tech")

rel_sectors_codes <- rel_sectors_codes %>%
  left_join(count_specializations(rel_sectors_codes, AI_codes_top8, "AI_specializations_top8"), by = "mat_reg_tech")

rel_sectors_codes <- rel_sectors_codes %>%
  left_join(count_specializations(rel_sectors_codes, AI_codes_top6, "AI_specializations_top6"), by = "mat_reg_tech")

#rename the mat_reg_tech column
names(rel_sectors_codes)[names(rel_sectors_codes) == 'mat_reg_tech'] <- 'Nace_4d'

#now, I'll count the total number of specializations of each nace
rel_sectors_codes  %<>%  group_by(Nace_4d) %>% 
  mutate(number_spec = length(unique(Subclass[RCA == 1]))) %>% 
  mutate(Share_top9 = AI_specializations_top9/number_spec) %>% 
  mutate(Share_top8 = AI_specializations_top8/number_spec) %>% 
  mutate(Share_top6 = AI_specializations_top6/number_spec) %>% 
  ungroup()

write.csv(rel_sectors_codes, file = "Input_code/Big_files_ignore/Additional_data_patents/new_distance_testing.csv", row.names = T) #
#separate, keeping just one line per
Unique_sectors <- distinct_at(rel_sectors_codes, vars(Nace_4d), .keep_all = T)
Unique_sectors <- subset(Unique_sectors, select = -c(Subclass) )
table(is.nan(Unique_sectors$Share_top9))
#replace nan values by 0:
Unique_sectors <- Unique_sectors %>%
  mutate(across(everything(), ~ ifelse(is.nan(.), 0, .)))
table(is.nan(Unique_sectors$Share_top9))

#create quartiles information
# Function to create quartile variable
create_quartile_variable <- function(data, share_column, quartile_column_name) {
  
  share_column_sym <- sym(share_column)  # Convert share_column to a symbol
  
  data %>%
    mutate(
      !!quartile_column_name := case_when(
        between(!!share_column_sym, 
                quantile(!!share_column_sym, 0, na.rm = TRUE), 
                quantile(!!share_column_sym, 0.25, na.rm = TRUE)) ~ "Bottom",
        between(!!share_column_sym, 
                quantile(!!share_column_sym, 0.25, na.rm = TRUE), 
                quantile(!!share_column_sym, 0.75, na.rm = TRUE)) ~ "IQR",
        between(!!share_column_sym, 
                quantile(!!share_column_sym, 0.75, na.rm = TRUE), 
                quantile(!!share_column_sym, 1, na.rm = TRUE)) ~ "Top",
        TRUE ~ NA_character_ # Handle missing values
      )
    )
}


# Create the new quartile columns
Unique_sectors <- Unique_sectors %>%
  create_quartile_variable("Share_top9", "Quartile_top9")

Unique_sectors <- Unique_sectors %>%
  create_quartile_variable("Share_top8", "Quartile_top8")

Unique_sectors <- Unique_sectors %>%
  create_quartile_variable("Share_top6", "Quartile_top6")

# Print the first few rows to verify the results
print(head(Unique_sectors))

#Optionally display value counts in each category:
table(Unique_sectors$Quartile_top9)
table(Unique_sectors$Quartile_top8)
table(Unique_sectors$Quartile_top6)

write.csv(Unique_sectors, file = "Input_code/Big_files_ignore/Additional_data_patents/new_distance_testing_ready3.csv", row.names = F) #

##17.2.Second alternative------
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
all_patents <-fread("Input_code/Big_files_ignore/All_patents.csv")

#Now we add the nace codes:
CompaniesData1<-read_excel("Input_code/Big_files_ignore/DataCompanies1.xlsx", sheet = "Results", na = "n.a.")
CompaniesData2<-read_excel("Input_code/Big_files_ignore/DataCompanies2.xlsx", sheet = "Results", na = "n.a.")
CompaniesData3<-read_excel("Input_code/Big_files_ignore/DataCompanies3.xlsx", sheet = "Results", na = "n.a.")
CompaniesData4<-read_excel("Input_code/Big_files_ignore/DataCompanies4.xlsx", sheet = "Results", na = "n.a.")
CompaniesData5<-read_excel("Input_code/Big_files_ignore/DataCompanies5.xlsx", sheet = "Results", na = "n.a.")
CompaniesData6<-read_excel("Input_code/Big_files_ignore/DataCompanies6.xlsx", sheet = "Results", na = "n.a.")
CompaniesData <- rbind(CompaniesData1,CompaniesData2,CompaniesData3,CompaniesData4,CompaniesData5,CompaniesData6)
rm(CompaniesData1,CompaniesData2,CompaniesData3,CompaniesData4,CompaniesData5,CompaniesData6)

CompaniesData <- CompaniesData[,c(2,3,6)] 
names(CompaniesData) <- c("Company_name", "Company", "Nace_4d")

all_patents <- left_join(all_patents, CompaniesData, by = "Company")
table(is.na(all_patents$Nace_4d)) #12,188,742   F (i.e., companies with NACE), and 570,280   T

#drop companies without Nace codes:
all_patents <- all_patents[is.na(all_patents$Nace_4d) == F,]
rm(CompaniesData)
#exclude company name:
all_patents<-all_patents[,c(-7)]

#create the 3 functions we'll use later:
#1.create a function for fractional counting IPC codes on which patent
group_by_applnID <- function (data){
  data %>%
    group_by(PubNo) %>%
    mutate(field_weight = 1 / n()) %>%
    ungroup()
}
#2.create a function for counting the relative participation of each IPC code for each NACE sector
group_by_NACE_and_Subclass <- function (data){
  data %<>%
    group_by(Nace_4d, Subclass) %>%
    summarise(n_tech_reg = sum(field_weight)) %>%
    ungroup() %>%
    drop_na() 
}  

length(unique(all_patents$PubNo)) #7,354,214 (same number, because we just removed the repeated added AI patents)
#table(all_patents$AIpatent) #257,044 (different number because we removed the extra AI patents but not the original ones)

#count total of patents of each sector, and total of AI patents;
all_patents %<>% group_by(Nace_4d) %>% 
  mutate(TotalPatents = length(unique(PubNo))) %>% #get the higher share of usage
  mutate(TotalAIPatents = length(na.omit(unique(PubNo[AIpatent == "Yes"])))) %>% 
  mutate(ShareAI = TotalAIPatents/TotalPatents) %>% 
  ungroup()

#describe(all_patents$TotalPatents) #I'm using the describe from the psych library
#so, number of patents varies from 1 to 936,534  , with a median value of 142,695. Let's exclude the sectors that are way below that, let's say, by having less than 500 patents:
#all_patents <- all_patents[all_patents$TotalPatents >= 500,]
length(unique(all_patents$Nace_4d)) #620 sectors (including the fake AI one) with at least 500 patents

#Finally, let's apply the two functions we created before:
reg_tech <- group_by_applnID(all_patents) #this gets the relative participation of each IPC code on each patent
reg_tech <- group_by_NACE_and_Subclass(reg_tech) #this gets the sum of the relative participation of each code for each NACE

rm(all_patents)

#let's convert this into a matrix where we have one line per NACE code, and all technologies linked to them in the columns
mat_reg_tech <- reg_tech %>%
  arrange(Subclass) %>% 
  pivot_wider(names_from = Subclass, values_from = n_tech_reg, values_fill = list(n_tech_reg = 0)) #

#let's throw the nace codes into the column names
mat_reg_tech %<>% remove_rownames %>% column_to_rownames(var="Nace_4d") %>%
  as.matrix() %>%
  round() #

#and calculate NON-binary specializations
rel_sectors_codes <- mat_reg_tech %>% location_quotient(binary = F) %>% 
  as.data.frame() %>% 
  rownames_to_column("mat_reg_tech") %>% 
  as_tibble() %>% 
  gather(key = "Subclass", value = "RCA", -mat_reg_tech) %>%
  arrange(mat_reg_tech, Subclass)

#backup<- rel_sectors_codes
#rel_sectors_codes <- backup

#let's transform this back into a matrix:
#rel_sectors_codes %<>%
#  arrange(Subclass, mat_reg_tech) %>%
#  pivot_wider(names_from = Subclass, values_from = RCA, values_fill = list(RCA = 0)) #transform on a binary-like matrix
rm(mat_reg_tech)

#let's see now which ones are the main AI codes
mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
#let's pick the 5 codes with higher relatedness to AI:
AI_codes_top6 <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.044,1] #6 codes #0.2 for 15 #chosen one, with 7 codes;
AI_codes_top8 <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.041,1] #8 codes
AI_codes_top9 <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.038,1] #9 codes

#rel_sectors_codes <- backup

# Function to count specializations for a given list of codes
count_specializations <- function(data, code_list, column_name) {
  data %>%
    mutate(
      !!column_name := case_when(
        Subclass %in% code_list & RCA > 0.6 ~ RCA,  # Sum when RCA > 0
        TRUE ~ 0
      )
    ) %>%
    group_by(mat_reg_tech) %>%
    summarise(!!column_name := sum(!!as.symbol(column_name), na.rm = TRUE), .groups = "drop")
}

# Create the new columns
rel_sectors_codes <- rel_sectors_codes %>%
  left_join(count_specializations(rel_sectors_codes, AI_codes_top9, "AI_specializations_top9"), by = "mat_reg_tech")

rel_sectors_codes <- rel_sectors_codes %>%
  left_join(count_specializations(rel_sectors_codes, AI_codes_top8, "AI_specializations_top8"), by = "mat_reg_tech")

rel_sectors_codes <- rel_sectors_codes %>%
  left_join(count_specializations(rel_sectors_codes, AI_codes_top6, "AI_specializations_top6"), by = "mat_reg_tech")

#rename the mat_reg_tech column
names(rel_sectors_codes)[names(rel_sectors_codes) == 'mat_reg_tech'] <- 'Nace_4d'

test <- rel_sectors_codes[rel_sectors_codes$Nace_4d == "1330",]
test <- test[test$Subclass %in% AI_codes_top9,]
sum(test$RCA)

#separate, keeping just one line per sector
Unique_sectors <- distinct_at(rel_sectors_codes, vars(Nace_4d), .keep_all = T)
Unique_sectors <- subset(Unique_sectors, select = -c(Subclass) )
table(is.na(Unique_sectors$AI_specializations_top9))

#create quartiles information
# Function to create quartile variable
create_quartile_variable <- function(data, share_column, quartile_column_name) {
  
  share_column_sym <- sym(share_column)  # Convert share_column to a symbol
  
  data %>%
    mutate(
      !!quartile_column_name := case_when(
        between(!!share_column_sym, 
                quantile(!!share_column_sym, 0, na.rm = TRUE), 
                quantile(!!share_column_sym, 0.25, na.rm = TRUE)) ~ "Bottom",
        between(!!share_column_sym, 
                quantile(!!share_column_sym, 0.25, na.rm = TRUE), 
                quantile(!!share_column_sym, 0.75, na.rm = TRUE)) ~ "IQR",
        between(!!share_column_sym, 
                quantile(!!share_column_sym, 0.75, na.rm = TRUE), 
                quantile(!!share_column_sym, 1, na.rm = TRUE)) ~ "Top",
        TRUE ~ NA_character_ # Handle missing values
      )
    )
}


# Create the new quartile columns
Unique_sectors <- Unique_sectors %>%
  create_quartile_variable("AI_specializations_top9", "Quartile_top9")

Unique_sectors <- Unique_sectors %>%
  create_quartile_variable("AI_specializations_top8", "Quartile_top8")

Unique_sectors <- Unique_sectors %>%
  create_quartile_variable("AI_specializations_top6", "Quartile_top6")

# Print the first few rows to verify the results
print(head(Unique_sectors))

#Optionally display value counts in each category:
table(Unique_sectors$Quartile_top9)
table(Unique_sectors$Quartile_top8)
table(Unique_sectors$Quartile_top6)

write.csv(Unique_sectors, file = "Input_code/Big_files_ignore/Additional_data_patents/new_distance_testing_ready_2ndAlternative.csv", row.names = F) #

##17.3.Test measures-----
Info_effects <-read_excel("Input_code/Big_files_ignore/NEW_FIG/Effects_per_sector.xlsx")
Info_quartiles <-read.csv(file = "Input_code/Big_files_ignore/Additional_data_patents/new_distance_testing_ready3.csv") #
#Info_quartiles <-read.csv(file = "Input_code/Big_files_ignore/Additional_data_patents/new_distance_testing_ready_2ndAlternative.csv") #
Info_quartiles$Nace_4d <- as.character(Info_quartiles$Nace_4d)

Info_effects <- left_join(Info_effects, Info_quartiles, by = "Nace_4d")
Info_effects <- Info_effects[Info_effects$Variable == "Relatedness_Cos2",]

Info_effects_simpl <- Info_effects[,c(1,10,26:31)] %>% group_by(Quartile_top9) %>% 
#  Info_effects_simpl <- Info_effects[,c(1,10,22:27)] %>% group_by(Quartile_top9) %>% 
  mutate(mean_Variable_1st_option = mean(ATT)) %>% ungroup()

Info_effects_simpl <- Info_effects_simpl %>% group_by(Quartile_top8) %>% 
  mutate(mean_Variable_2nd_option = mean(ATT)) %>% ungroup()

Info_effects_simpl <- Info_effects_simpl %>% group_by(Quartile_top6) %>% 
  mutate(mean_Variable_3rd_option = mean(ATT)) %>% ungroup()

chosen <- Info_effects_simpl[,c("ATT", "Nace_4d", "Quartile_top9", "mean_Variable_1st_option")]
#top8 is the only adequated one for the alternative;

chosen %<>% group_by(Quartile_top9) %>%  mutate(Std_deviation = sd(ATT, na.rm = TRUE)) %>% ungroup()

#current top8 (8 codes)
#Bottom    IQR    Top 
#354    112    154

#current top6 (6 codes)
#Bottom    IQR    Top 
#403     62    155
#"Input_code/Big_files_ignore/NEW_FIG/Effects_per_sector.xlsx", rowNames = F) 

##17.4.Analyse preferred distance----
rm(list=ls())
df_main_1 <- read_csv("Input_code/Big_files_ignore/Additional_data_patents/new_distance_testing_ready3.csv")
#df_main_2 <- read_csv("Input_code/Big_files_ignore/Additional_data_patents/new_distance_testing_ready_2ndAlternative.csv")
df_nace <- read_csv("Input_code/nace_rev2.csv")
df_nace <- df_nace %>%  clean_names()

# Step 2: Clean the NACE codes in df_nace (remove dots)
df_nace <- df_nace %>%
  mutate(Code_clean = str_replace_all(code, "\\.", ""))

#pick the codes that make more sense
df_main_1 <- df_main_1[,c("Nace_4d", "Quartile_top6", "Quartile_top8", "Quartile_top9")]
#df_main_2 <- df_main_2[,c("Nace_4d", "Quartile_top8")]
#names(df_main_2) <- c("Nace_4d", "Quartile_top8_alternative")

#df_main_1<- left_join(df_main_1,df_main_2, by = "Nace_4d")

# Step 3: Merge using Nace_4d (main dataset) and cleaned Code
df_merged <- df_main_1 %>%
  left_join(df_nace, by = c("Nace_4d" = "Code_clean"))

#df_nace$reference_to_isic_rev_4
#df_merged <- df_main_1 %>%
#  left_join(df_nace, by = c("Nace_4d" = "reference_to_isic_rev_4"))

#first option
table(df_merged$Quartile_top6)
#Bottom    IQR    Top 
#403     62    155 

#alternative option 1:
table(df_merged$Quartile_top8)
#Bottom    IQR    Top 
#354    112    154

#alternative option 2:
table(df_merged$Quartile_top9)
#Bottom    IQR    Top 
#342    123    155 
table(is.na(df_merged$description)) #65T, 555F

#df_merged <- df_merged[,c("Nace_4d", "description","Quartile_top6", "Quartile_top8_alternative")]
df_merged2 <- df_merged[,c("Nace_4d", "description","Quartile_top6", "Quartile_top8", "Quartile_top9")]
write.csv2(df_merged2, file = "Input_code/Big_files_ignore/NEW_FIG/Quartiles_with_names2.csv", row.names = F) #

df_merged3 <- df_merged[,c("Nace_4d", "description", "Quartile_top8", "Quartile_top9")]
write.csv2(df_merged3, file = "Input_code/Big_files_ignore/NEW_FIG/Quartiles_with_names3.csv", row.names = F) #

#the clodes included are:
mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns

#let's pick the 5 codes with higher relatedness to AI:
AI_codes_top6 <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.044,1] #6 codes #0.2 for 15 #chosen one, with 7 codes;
AI_codes_top8 <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.041,1] #8 codes
AI_codes_top9 <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.038,1] #9 codes

realAI_codes_top6 <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.02,1] #15 codes

AI_codes_top6
#"G06F" "G06K" "G06N" "G06Q" "G06T" "G10L" 

#IPC Code	Description
#G06F	Electric Digital Data Processing — This subclass includes general-purpose digital computers, data processing systems, computer architecture, memory access, input/output control, etc. Widely regarded as a core category for computing hardware and software.
#G06K	Recognition of Data; Presentation of Data; Record Carriers — Encompasses technologies for scanning, optical character recognition (OCR), barcode processing, and data entry systems. Important in document automation and machine reading.
#G06N	Computer Systems Based on Specific Computational Models — The core IPC subclass for artificial intelligence, including neural networks, genetic algorithms, and fuzzy logic systems.
#G06Q	Data Processing Systems or Methods, Specially Adapted for Administrative, Commercial, Financial, Managerial, Supervisory or Forecasting Purposes — Covers business-oriented computing, such as e-commerce, logistics optimization, financial modeling, and enterprise resource planning.
#G06T	Image Data Processing or Generation — Includes image analysis, computer vision, image enhancement, video encoding/decoding, and rendering. A key area for visual AI and machine learning.
#G10L	Speech Analysis or Synthesis; Speech Recognition; Speech or Voice Processing — Dedicated to natural language and audio processing, including voice assistants, speech-to-text systems, and acoustic modeling.

'%notin%' <- Negate('%in%')
remaining <- realAI_codes_top6[realAI_codes_top6 %notin% AI_codes_top6]
remaining #H04W, G05B and G16H seem to be the only ones that could also be included;

test <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.02,] #up to 9 would include: H04L, G05B and G16H; H04W is just included 
#in the 12th position, after including A61B and G01V

#IPC Code	Description
#3 codes now included in the top 9 chosen classification
#H04L	Transmission of Digital Information — Encompasses telecommunication systems, including network protocols, error detection/correction, secure communication, and internet data transfer. Relevant to AI in networked environments (e.g., edge computing).
#G05B	Control or Regulating Systems in General — Encompasses automatic control systems, process automation, and feedback control. Highly relevant for robotics, industrial automation, and AI-integrated control.
#G16H	Health Informatics — Dedicated subclass for ICT in healthcare, including electronic health records, decision support systems, telemedicine, and AI-based health analytics. Introduced in the G16 class for computer-based methods in specialized fields.

#remaining 6 ones:
#A61B	Diagnosis; Surgery; Identification — Covers diagnostic devices and procedures (e.g., imaging, endoscopy), surgical tools, and biosignal monitoring (e.g., ECG, EEG). Heavily used in medical technology and AI-based diagnostics.
#G01N	Investigating or Analyzing Materials by Determining Their Chemical or Physical Properties — Includes chemical testing, biosensing, materials analysis; foundational in biotech, diagnostics, and laboratory automation.
#G01R	Measuring Electric Variables; Testing Electric Components — Concerns current, voltage, impedance, and circuit diagnostics. Relevant for smart sensors and electronics.
#G01V	Geophysics; Gravitational, Magnetic or Electric Prospecting; Detecting Masses or Objects — Used in remote sensing, subsurface imaging (e.g., seismic), and radar systems. AI is increasingly applied to automate such analyses.
#H04N	Pictorial Communication (e.g., Television; Video Cameras; Image Transmission) — Covers technologies related to video encoding, streaming, image transmission, and multimedia interfaces. Often used in AI-driven image and video analytics.
#H04W	Wireless Communication Networks — Deals with mobile communication systems, 5G, network resource allocation, and mobility management. AI techniques are widely applied in network optimization and edge computing.

#18.Analyse changed groups -----
rm(list=ls())
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

DataLong_Subs_sim <-read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",")
length(unique(DataLong_Subs_sim$id)) #2514 ids 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

table(is.na(DataLong_Subs_sim$AIcodes)) #13607 F, 21589   T
#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0
table(is.na(DataLong_Subs_sim$AIcodes)) #35196 F

#insert granted information
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info.csv", header = TRUE) #
#remove useless variables 
#remember to exclude them later-----
Patent_data <- subset(Patent_data, select = -c(n_pubtype_p, n_pubtype_d, n_pubtype_u, avg_backward_citations_ai,
                                               avg_forward_citations_ai, avg_claims_ai, avg_number_of_family_members_ai,
                                               avg_time_filing_to_publication_ai, avg_time_filing_to_grant_ai) )

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))

DataLong_Subs_sim$Rate_granted <- DataLong_Subs_sim$n_granted_yes/(DataLong_Subs_sim$n_granted_na+DataLong_Subs_sim$n_granted_yes) 
DataLong_Subs_sim$Rate_granted_NoNAI <- DataLong_Subs_sim$n_granted_yes_nonai/(DataLong_Subs_sim$n_granted_na_nonai+DataLong_Subs_sim$n_granted_yes_nonai) 

#add dynamic capabilities
dynamic_capabilities <- read.csv("Input_code/Big_files_ignore/df_dynamic_capabilities.csv", header = TRUE)
names(dynamic_capabilities)[names(dynamic_capabilities) == 'Year'] <- 'CurrentYear'
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, dynamic_capabilities, by=c("Company", "CurrentYear"))

##add 2025 R&D data 
#add information about patents developed by subsidiaries and other data (R&D, turnover)
setwd("C:/Users/mathe/OneDrive/Documentos/R/Database")
FinalDataset <- read.csv("files_created_code2/FinalDataset_allYears_FullGUOs.csv", sep = ";", header = TRUE, dec = ",")
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
FinalDataset <- FinalDataset[,c("Company", "CurrentYear","No_subs_extended", "NoPatentsYearALLSubs", "No_AI_PatentsYearALLSubs", 
                                "No_employees_Year", "Turnover_Year", "RandD_Year", "NoPatentsYearGUOalone", "No_new_PatentsYearGUOalone")]
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, FinalDataset, by = c("Company", "CurrentYear"))

#try to compensate for missing data from orbis:
Additional_data<-read_excel("Input_code/Big_files_ignore/NewData_03_2025.xlsx", sheet = "Results", na = "n.a.")
#test<-read_excel("Input_code/Big_files_ignore/Updated_data_companies_RandD.xlsx", sheet = "Results", na = "n.a.")

#clean names fix names change names improve names
Additional_data <- Additional_data[,c(-1)] %>%  clean_names()
#convert data into numeric
Additional_data <- Additional_data %>%
  mutate(across(-c(1, 2), ~ as.numeric(.)))
#Additional_data$price_book_value_ratio_average_high_low_2010
sample_data_long <- Additional_data %>%
  pivot_longer(
    cols = matches("^(number_of_publications_per_year_|operating_revenue_turnover_th_usd_|number_of_employees_|research_development_expenses_th_usd_|price_book_value_ratio_average_high_low_|market_capitalisation_shareholders_funds_)\\d+$"),
    names_to = c("Variable", "CurrentYear"),
    names_pattern = "(number_of_publications_per_year_|operating_revenue_turnover_th_usd_|number_of_employees_|research_development_expenses_th_usd_|price_book_value_ratio_average_high_low_|market_capitalisation_shareholders_funds_)(\\d+)",
    values_to = "Value"  ) %>%
  mutate(CurrentYear = as.integer(CurrentYear))

sample_data_wide <- sample_data_long %>%
  pivot_wider(names_from  = "Variable",
              values_from = "Value")
#new variables:
table(is.na(sample_data_wide$operating_revenue_turnover_th_usd_)) #21183  f, 14652  T
table(is.na(sample_data_wide$number_of_publications_per_year_)) #13337  F, 22498  T 
table(is.na(sample_data_wide$number_of_employees_)) #17630  F, 18205  T 
table(is.na(sample_data_wide$research_development_expenses_th_usd_))  #15864  F, 19971   T
table(is.na(sample_data_wide$price_book_value_ratio_average_high_low_))  #15205 f, 20630 t
table(is.na(sample_data_wide$market_capitalisation_shareholders_funds_))  #15219 F, 20616 

#hence, there is more data available for the new ones; particularly for RandD_Year and No_employees_Year
rm(sample_data_long, Additional_data)
head(sample_data_wide)
names(sample_data_wide) <- c("company_name_latin_alphabet","Company","CurrentYear", "number_patents_year", "operating_revenue_turnover","number_of_employees", "RandD_Year", "Stock_value", "Market_capitalisation")

#pay attention: in the old file, Orbis would make the R&D data available just under the variable "R&D expenses/Operating revenue (%)"; now it
#gives the absolute values for Turnover, i.e., "R&D expenses/Operating revenue"; the reading is more straightforward in the latter:
#it shows how the absolute proportion changed, instead of an absolute change in relation to a relative proportion (which I'm not even sure how to read);
#therefore, the new data is better; I could use the old R&D data if I'd multiply it by the turnover;

DataLong_Subs_sim <- subset(DataLong_Subs_sim, select = -c(No_employees_Year, Turnover_Year, RandD_Year))
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, sample_data_wide, by = c("Company","CurrentYear"))


Patent_data_HQs_subs <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_HQ_and_subs.csv", header = TRUE) #
DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data_HQs_subs, by=c("Company", "CurrentYear"))

#subs:
#Rate granted subs/total
DataLong_Subs_sim$Rate_granted_subs_rel_HQ <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$n_granted_yes_HQ+DataLong_Subs_sim$n_granted_yes_subsidiaries) 
#Rate success subs
DataLong_Subs_sim$Rate_success_subs <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$n_granted_na_subsidiaries+DataLong_Subs_sim$n_granted_yes_subsidiaries) 
#Rate granted subs/total NON AI
DataLong_Subs_sim$Rate_granted_subs_rel_HQ_nonai <- DataLong_Subs_sim$n_granted_yes_nonai_subsidiaries/(DataLong_Subs_sim$n_granted_yes_nonai_HQ+DataLong_Subs_sim$n_granted_yes_nonai_subsidiaries) 
#Rate granted per sub (i.e., patent productivity per sub)
DataLong_Subs_sim$Rate_granted_per_sub <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$No_subs_extended) 
#Rate granted subs/total considering the old numbers of patents calculated
DataLong_Subs_sim$Rate_granted_subs_rel_HQ_TOTAL <- DataLong_Subs_sim$NoPatentsYearALLSubs/(DataLong_Subs_sim$NoPatentsYearALLSubs+DataLong_Subs_sim$NoPatentsYearGUOtotal) 

#HQ:
#Rate success hq
DataLong_Subs_sim$Rate_success_HQ <- DataLong_Subs_sim$n_granted_yes_HQ/(DataLong_Subs_sim$n_granted_na_HQ+DataLong_Subs_sim$n_granted_yes_HQ) 

#develop additional indicators
#for the whole company
#R&D Intensity (R&D Expenditure / Turnover)
DataLong_Subs_sim$R_and_D_intensity <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$operating_revenue_turnover
#Patent Productivity (Patents per R&D Investment)
DataLong_Subs_sim$Patent_productivity <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$RandD_Year
#Patent Output per Employee
DataLong_Subs_sim$Patent_output_per_employee <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$number_of_employees

#REPLACE NANs of these last 8 columns by NA (check first)
#shouldn't I always use NA instead of NAN in this kind of replacement?
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(across(
    c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
      "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "Rate_success_HQ","R_and_D_intensity", 
      "Patent_productivity", "Patent_output_per_employee"),
    ~ ifelse(is.nan(.), NA, .)
  ))

#replace infinite values from Patent_productivity ad Patent_output_per_employee for NA
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(R_and_D_intensity = ifelse(is.infinite(R_and_D_intensity), NA, R_and_D_intensity)) %>% 
  mutate(Patent_productivity = ifelse(is.infinite(Patent_productivity), NA, Patent_productivity)) %>% 
  mutate(Patent_output_per_employee = ifelse(is.infinite(Patent_output_per_employee), NA, Patent_output_per_employee)) %>% 
  mutate(Rate_granted_per_sub = ifelse(is.infinite(Rate_granted_per_sub), NA, Rate_granted_per_sub)) 

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_measure.csv", header = TRUE)#[,c(-1)] #doesn't work, no significance
CategoriesNace <- CategoriesNace[,c("Nace_4d", "Quartile_top9")]
names(CategoriesNace) <- c("Nace_4d", "Quartile")
CategoriesNace$Nace_4d <- as.character(CategoriesNace$Nace_4d)
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)

DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")
Simplified_data <-read.csv(file = "Input_code/Big_files_ignore/Additional_data_patents/Data_patent_info_new_groups_granted.csv")
DataLong_Subs_sim <- left_join(DataLong_Subs_sim,Simplified_data, by = "Company")

table(is.na(DataLong_Subs_sim$Quartile)) #35196 F, no missing data
table(DataLong_Subs_sim$Quartile) #bottom 6048 medium  13496   top 15652       

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3", "DataLong_Subs_sim_group0")

#define the possible variables
variables = c(#main ones (11) - linked to knowledge creation, usage, and recombination
  "Relatedness_Cos2", #relatedness
  "NoPatentsYearGUOtotal", #innovative performance
  "Specializations_Usage", #usage of specializations
  "HigherUsage", #most used technology
  "Specializations_Number", #number of specializations
  "UniqueCodes", #for Sections
  "UniqueSubclass", #for 4-digit
  "Herfindahl", #the Herfindahl index
  "Shannon", #the Shannon index
  "AIcodes", #effect on the 5 codes most related to AI
  "Dynamic_capabilities",
  
  #quality measures (18) - knowledge quality
  "Rate_granted", #rate of granted patents
  "avg_claims", #most used technology
  "avg_number_of_family_members", #number of specializations
  "avg_backward_citations", #for Sections
  "avg_forward_citations", #for 4-digit
  "avg_time_filing_to_publication",
  "avg_time_filing_to_grant",
  "n_granted_na", 
  "n_granted_yes",
  #spillovers to other patents (i.e., nonAI)
  "avg_time_filing_to_publication_NONai",
  "avg_time_filing_to_grant_NONai",
  "Rate_granted_NoNAI",
  "n_granted_yes_nonai", 
  "n_granted_na_nonai", 
  "avg_number_of_family_members_nonai", 
  "avg_claims_nonai", 
  "avg_backward_citations_nonai", 
  "avg_forward_citations_nonai",
  
  #subs and HQs (26) - knowledge flows
  #subs performance in relatio to HQ
  "Rate_granted_subs_rel_HQ", 
  "Rate_success_subs", 
  "Rate_granted_subs_rel_HQ_nonai", 
  "Rate_granted_per_sub", 
  "Rate_granted_subs_rel_HQ_TOTAL", 
  #HQ performance alone
  "Rate_success_HQ",
  "n_granted_yes_HQ", 
  "n_granted_na_HQ", 
  "avg_backward_citations_HQ", 
  "avg_forward_citations_HQ", 
  "avg_time_filing_to_publication_HQ", 
  "avg_time_filing_to_grant_HQ", 
  "n_granted_yes_nonai_HQ", 
  "n_granted_na_nonai_HQ", 
  "avg_backward_citations_nonai_HQ", 
  "avg_forward_citations_nonai_HQ", 
  #sub performance alone
  "n_granted_yes_subsidiaries", 
  "n_granted_na_subsidiaries", 
  "avg_backward_citations_subsidiaries", 
  "avg_forward_citations_subsidiaries", 
  "avg_time_filing_to_publication_subsidiaries", 
  "avg_time_filing_to_grant_subsidiaries", 
  "n_granted_yes_nonai_subsidiaries", 
  "n_granted_na_nonai_subsidiaries", 
  "avg_backward_citations_nonai_subsidiaries", 
  "avg_forward_citations_nonai_subsidiaries",
  
  #aditional performance variables (4) - knowledge productivity
  "R_and_D_intensity", 
  "Patent_productivity", 
  "Patent_output_per_employee", 
  "RandD_Year")

DataLong_Subs_sim %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

####2.3.2. Treatment granted-----
Current_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
Current_non_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]

#so the treatment will now be companies that had at least one AI patent granted
Current_treated_new_treat <-Current_treated[Current_treated$total_granted_ai >0,]
length(unique(Current_treated_new_treat$id)) #480 granted

#now, we change the group for this patents, from the year that they adopted AI to the year that they got their AI patent granted
table(Current_treated_new_treat$Group)
#2011 2012 2013 2014 2015 2016 2017 2018 2019 
#756  854  686  812  868  784  896  826  238
Current_treated_new_treat$Group <-Current_treated_new_treat$first_AI_grant_year
table(Current_treated_new_treat$Group)
#2003 2007 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022 2023 2024 2025  Inf 
#28   14   14   56  140  196  196  336  686  784 1106 1190  994  322  294  140  126   28   70 
Current_treated_new_treat <- Current_treated_new_treat[is.infinite(Current_treated_new_treat$Group)==F,]
table(Current_treated_new_treat$Group)
length(unique(Current_treated_new_treat$id)) #475 granted, 5 were dropped;
Current_treated_new_treat <- Current_treated_new_treat[Current_treated_new_treat$Group >2010,]
length(unique(Current_treated_new_treat$id)) #471 granted, another 4 were dropped;
table(Current_treated_new_treat$Group)
#2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022 2023 2024 2025 
#56  140  196  196  336  686  784 1106 1190  994  322  294  140  126   28 

DataLong_Subs_sim_granted <- rbind(Current_treated_new_treat, Current_non_treated)
table(DataLong_Subs_sim_granted$Quartile)

DataLong_Subs_sim_group0 <- DataLong_Subs_sim_granted
DataLong_Subs_sim_group1 <- DataLong_Subs_sim_granted[DataLong_Subs_sim_granted$Quartile == "Top",]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_granted[DataLong_Subs_sim_granted$Quartile == "IQR" ,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_granted[DataLong_Subs_sim_granted$Quartile == "Bottom",]

#####2.3.2.1.Calculate the effects Non-standardized across groups -----
######2.3.2.1.1.Main variables----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#### Innovative performance 
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#### Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Most used technology 
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of sections
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

######2.3.2.1.2.Knowledge quality----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 16
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 17
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 18
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 19
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 20
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 21
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 22
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 23
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 24
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 25
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 26
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 27
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 28
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

######2.3.2.1.3.Knowledge flows between HQs and subs----
#Group 1
variable_n = 29
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 30
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 31
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 32
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 33
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 34
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 35
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 36
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 37
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 38
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 39
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 40
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 41
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 42
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 43
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 44
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 45
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 46
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 47
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 48
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 49
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 50
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 51
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 52
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 53
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 54
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 55
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

######2.3.2.1.4.Knowledge productivity----
#Group 1
variable_n = 56
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 57
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 58
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 59
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#####2.3.2.2.Calculate the effects Non-standardized for the whole dataset -----
#Group 4
variable_n = 1
n_group = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 2
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 3
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 5
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 6
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 7
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 8
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 9
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 10
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 11
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 12
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 13
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 14
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 15
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 16
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 17
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 18
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 19
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 20
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 21
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 22
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 23
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 24
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 25
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 26
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 27
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 28
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 29
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 30
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 31
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 32
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 33
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 34
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 35
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 36
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 37
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 38
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 39
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 40
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 41
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 42
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 43
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 44
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 45
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 46
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 47
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 48
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 49
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 50
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 51
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 52
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 53
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 54
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 55
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 56
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 57
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 58
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 59
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df$dataset <- "granted_and_treated_by_granted_year"
results_df$mode <- "non_standard"

write.xlsx(results_df, file = "Input_code/Big_files_ignore/NEW_FIG/Results_Effects_non_stand_granted_groupGranted_by_year.xlsx", rowNames = F)

#create figure for R*D
variable_n = 59
variable_name <- variables[variable_n] #RandD_Year
variable_name
n_group = 4
group = print(groups[n_group], quote=FALSE)

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #22927.7      11849.39  -296.6784    46152.08 
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_RandD_Year_NewGroup.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "R&D expenditure - Granted date as date of treatment") + 
  theme(legend.position="right") +
  ylab("Estimated effect on R&D expenditure") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

DataLong_Subs_sim_original_group <- DataLong_Subs_sim
table(DataLong_Subs_sim_original_group$Group) #correct
table(DataLong_Subs_sim_group0$Group) #correct, includes 2025

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_original_group )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #22927.7      11849.39  -296.6784    46152.08 
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_RandD_Year_OriginalGroup.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "R&D expenditure - Filing date as date of treatment") + 
  theme(legend.position="right") +
  ylab("Estimated effect on R&D expenditure") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","orange")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#for never granted group:
Current_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
Current_non_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]

#so the treatment will now be companies that never had an AI patent granted
Current_treated_new_treat <-Current_treated[Current_treated$total_granted_ai ==0,]
length(unique(Current_treated_new_treat$id)) #777 non-granted
DataLong_Subs_sim_non_granted <- rbind(Current_treated_new_treat, Current_non_treated)

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_non_granted )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #22927.7      11849.39  -296.6784    46152.08 
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_RandD_Year_OriginalGroup_non_granted.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "R&D expenditure- Filing date as date of treatment - non_granted") + 
  theme(legend.position="right") +
  ylab("Estimated effect on R&D expenditure") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","darkred")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

variable_n = 58
variable_name <- variables[variable_n] #RandD_Year
variable_name #Patent_output_per_employee

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0084        0.0035     0.0016      0.0153 *
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Patent_output_per_employee_NewGroup.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Patent output per employee - Granted date as date of treatment") + 
  theme(legend.position="right") +
  ylab("Estimated effect on patent output per employee") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_original_group )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #22927.7      11849.39  -296.6784    46152.08 
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Patent_output_per_employee_OriginalGroup.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Patent output per employee - Filing date as date of treatment") + 
  theme(legend.position="right") +
  ylab("Estimated effect on patent output per employee") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","orange")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_non_granted )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0104        0.0031     0.0043      0.0164 *
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Patent_output_per_employee_OriginalGroup_non_granted.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Patent output per employee - Filing date as date of treatment - non_granted") + 
  theme(legend.position="right") +
  ylab("Estimated effect on patent output per employee") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","darkred")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

variable_n = 1
variable_name <- variables[variable_n] #RandD_Year
variable_name #Relatedness_Cos2

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0084        0.0035     0.0016      0.0153 *
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Relatedness_NewGroup.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Relatedness - Granted date as date of treatment") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_original_group )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #22927.7      11849.39  -296.6784    46152.08 
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Relatedness_OriginalGroup.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Relatedness - Filing date as date of treatment") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","orange")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_non_granted )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0104        0.0031     0.0043      0.0164 *
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Relatedness_OriginalGroup_non_granted.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Relatedness - Filing date as date of treatment - non_granted") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","darkred")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

variable_n = 2
variable_name <- variables[variable_n] #RandD_Year
variable_name #NoPatentsYearGUOtotal

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0084        0.0035     0.0016      0.0153 *
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_InnovPerformance_NewGroup.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Innovative performance - Granted date as date of treatment") + 
  theme(legend.position="right") +
  ylab("Estimated effect on innovative performance") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_original_group )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #22927.7      11849.39  -296.6784    46152.08 
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_InnovPerformance_OriginalGroup.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Innovative performance - Filing date as date of treatment") + 
  theme(legend.position="right") +
  ylab("Estimated effect on innovative performance") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","orange")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_non_granted )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0104        0.0031     0.0043      0.0164 *
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_InnovPerformance_OriginalGroup_non_granted.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Innovative performance - Filing date as date of treatment - non_granted") + 
  theme(legend.position="right") +
  ylab("Estimated effect on innovative performance") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","darkred")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

##18.2.Trying synthetic controls-------
library(Synth)
#first option, the easiest: I can create a twin of all companies that got some granted AI, keep their
#groups as they are, and then just switch the treatment date to the time of the grant;

#second easy try: I have companies that got their patents approved after the study period (i.e., 2019+).
#could I match companies that are from the same group, i.e., applied at around the same time, but one got granted and the
#other didn't?

#third option: synthetic controls: Synthetic Control Method (SCM): SCM offers a potential advantage 
#here. By focusing on matching the pre-treatment outcome trend (e.g., the trend in R&D spending or 
#relatedness before the grant), SCM implicitly tries to create a counterfactual that reflects what 
#would have happened to the treated firm given its specific pre-existing trajectory, which is shaped 
#by both observed and unobserved factors (including its inherent learning ability up to that point).
#If the synthetic control (based on the "failed" firms, weighted appropriately) tracks the successful 
#firm well before the grant, and then diverges significantly after the grant, it lends stronger 
#support to the idea that the grant itself caused the divergence, rather than just pre-existing 
#differences in learning ability continuing their trend.

#I'll try with the first option:
table(Current_treated$first_AI_grant_year)

Current_treated_new_treat_new <-Current_treated[Current_treated$total_granted_ai >0,]
table(Current_treated_new_treat_new$first_AI_grant_year) #there should not be anything granted before 2011 (this is
#an Orbis problem); let's exclude these, together with 2025 and Inf values:

Current_treated_new_treat_new <- Current_treated_new_treat_new[Current_treated_new_treat_new$first_AI_grant_year >2010 & Current_treated_new_treat_new$first_AI_grant_year < 2025,]
table(Current_treated_new_treat_new$first_AI_grant_year)

#now, we create the twins:
Current_treated_new_treat_new_twin <- Current_treated_new_treat_new
Current_treated_new_treat_new_twin$id <- Current_treated_new_treat_new_twin$id+3000
table(Current_treated_new_treat_new_twin$id)

#make the other group "untreated":
table(DataLong_Subs_sim$first.treat)
table(Current_treated_new_treat_new$first.treat)
Current_treated_new_treat_new$first.treat <- 0
table(Current_treated_new_treat_new$first.treat)

#now, we change the group of the twin:
Current_treated_new_treat_new_twin$Group <- Current_treated_new_treat_new$first_AI_grant_year

#and merge both:
Current_treated_twin_approach <- rbind(Current_treated_new_treat_new_twin, Current_treated_new_treat_new)

#and calculate
#for relatedness:
variable_n = 1
n_group = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = Current_treated_twin_approach )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.2434        0.4346    -0.6084      1.0952 
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Twins_Relatedness.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Relatedness - Granted date as treatment - Twins") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","darkred")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#for Innovative performance:
variable_n = 2
variable_name <- variables[variable_n]

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = Current_treated_twin_approach )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #14.1558       15.1054   -15.4504     43.7619 
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Twins_Innov_perform.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Innovative performance - Granted date as treatment - Twins") + 
  theme(legend.position="right") +
  ylab("Estimated effect on innovative performance") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","darkblue")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#for R&D intesity:
#test <- as.data.frame(variables)
variable_n = 56 #59
variable_name <- variables[variable_n]

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = Current_treated_twin_approach )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0             0          0           0
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Twins_RandD_intensity.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "R&D intensity - Granted date as treatment - Twins") + 
  theme(legend.position="right") +
  ylab("Estimated effect on R&D intensity") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","darkgreen")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#for R&D per year:
variable_n = 59
variable_name <- variables[variable_n]

estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = Current_treated_twin_approach )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #12495.4      11294.46  -9641.333    34632.12 
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Twins_RandD_year.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "R&D per year - Granted date as treatment - Twins") + 
  theme(legend.position="right") +
  ylab("Estimated effect on R&D per year") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","darkorange")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#for Patent_productivity:
variable_n = 57
variable_name <- variables[variable_n]
variable_name
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = Current_treated_twin_approach )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #7e-04         5e-04     -3e-04      0.0017 
ggdid(agg.es) 

#jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Twins_RandD_year.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "R&D per year - Granted date as treatment - Twins") + 
  theme(legend.position="right") +
  ylab("Estimated effect on innovative performance") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","darkorange")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#for Patent_output_per_employee:
variable_n = 58
variable_name <- variables[variable_n]
variable_name
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = Current_treated_twin_approach )

agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #4e-04        0.0014    -0.0024      0.0033 
ggdid(agg.es) 

jpeg("Input_code/Big_files_ignore/NEW_FIG/Fig_Twins_patent_output_per_employee.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "Patent output per employee - Granted date as treatment - Twins") + 
  theme(legend.position="right") +
  ylab("Estimated effect on the patent output per employee") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","purple")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

##19. Measuring effects across sectors with the granted date in relation to publication date-----
###19.1. Generate indicator-----
rm(list=ls())
setwd("C:/Users/mathe/OneDrive/Documentos/R/MNEs_and_Artificial_Intelligence")
All<- fread("Input_code/Big_files_ignore/Additional_data_patents/Combined_file_all_matched_patents.csv")
All$Headquarters <- All$Company == All$Subsidiaries

All <- All %>%# here is the difference: instead of time_filing_to_grant = as.numeric(difftime(grant_date, application_filing_date, units = "days"))), I changed it
#while keeping the same name for the variable
    mutate(time_filing_to_grant = as.numeric(difftime(grant_date, publication_date, units = "days")))# Calculate time in days from filing to grant

# 1. Select relevant columns and remove duplicates so each (Company, CurrentYear, PubNo) is unique
All_unique <- All %>%
  distinct(
    Company, CurrentYear, PubNo,newPatent, Headquarters,
    granted, AIpatent, number_of_claims, publication_type_p_d_u,
    number_of_family_members, number_of_backward_citations, number_of_forward_citations, 
    time_filing_to_publication, time_filing_to_grant
  )

# 2. Group by Company and CurrentYear, then summarize
Aggregated_data <- All_unique %>%
  group_by(Company, CurrentYear) %>%
  summarise(
    # 1. Number of unique PubNo in which granted == "Yes"
    n_granted_yes = length(na.omit(unique(PubNo[is.na(granted) == F]))),
    
    # 2. Number of unique PubNo in which granted == NA
    n_granted_na = length(na.omit(unique(PubNo[is.na(granted) == T]))),
    
    # 3. Number of unique PubNo in which granted == "Yes" AND AIpatent == "Yes"
    n_granted_yes_ai = length(na.omit(unique(PubNo[granted == "Yes" & AIpatent == "Yes"]))),
    #n_granted_yes_ai = n_distinct(PubNo[granted == "Yes" & AIpatent == "Yes"]),
    # 4. Number of unique PubNo in which granted == NA AND AIpatent == "Yes"
    n_granted_na_ai = length(na.omit(unique(PubNo[is.na(granted) == T & AIpatent == "Yes"]))),
    #n_granted_na_ai = n_distinct(PubNo[granted != "Yes" & AIpatent == "Yes"]),
    
    # 5. Average number_of_claims (unique PubNo)
    avg_claims = mean(number_of_claims, na.rm = TRUE),
    
    # 6. Number of publication_type_p_d_u == "p" (unique PubNo)
    n_pubtype_p = length(na.omit(unique(PubNo[publication_type_p_d_u == "P"]))),
    
    # 7. Number of publication_type_p_d_u == "d" (unique PubNo)
    n_pubtype_d = length(na.omit(unique(PubNo[publication_type_p_d_u == "D"]))),
    
    # 8. Number of publication_type_p_d_u == "u" (unique PubNo)
    n_pubtype_u = length(na.omit(unique(PubNo[publication_type_p_d_u == "U"]))),
    
    # 9. Average number_of_family_members (unique PubNo)
    avg_number_of_family_members = mean(number_of_family_members, na.rm = TRUE),
    
    # 10. Average number_of_backward_citations (unique PubNo)
    avg_backward_citations = mean(number_of_backward_citations, na.rm = TRUE),
    
    # 11. Average number_of_forward_citations (unique PubNo)
    avg_forward_citations = mean(number_of_forward_citations, na.rm = TRUE),
    
    # 12. Average number_of_forward_citations (unique PubNo)
    avg_time_filing_to_publication = mean(time_filing_to_publication, na.rm = TRUE),
    
    # 13. Average number_of_forward_citations (unique PubNo)
    avg_time_filing_to_grant = mean(time_filing_to_grant, na.rm = TRUE),
    
    #14. Average number of backward and forward citations of AI patents
    avg_backward_citations_ai = mean(number_of_backward_citations[AIpatent == "Yes"], na.rm = TRUE),
    avg_forward_citations_ai  = mean(number_of_forward_citations[AIpatent == "Yes"], na.rm = TRUE),
    
    #15. Average number of claims of AI patents
    avg_claims_ai = mean(number_of_claims[AIpatent == "Yes"], na.rm = TRUE),
    
    #16. Average number of family members of AI patents
    avg_number_of_family_members_ai = mean(number_of_family_members[AIpatent == "Yes"], na.rm = TRUE),
    
    #17. Average number of backward and forward citations of AI patents
    avg_time_filing_to_publication_ai = mean(time_filing_to_publication[AIpatent == "Yes"], na.rm = TRUE),
    avg_time_filing_to_grant_ai  = mean(time_filing_to_grant[AIpatent == "Yes"], na.rm = TRUE),
    
    #18. Average number of backward and forward citations of AI patents
    avg_time_filing_to_publication_NONai = mean(time_filing_to_publication[is.na(AIpatent) == T], na.rm = TRUE),
    avg_time_filing_to_grant_NONai  = mean(time_filing_to_grant[is.na(AIpatent) == T], na.rm = TRUE),
    
    #NON_AI:
    #19. number of granted non AI and number of NON granted non AI
    n_granted_yes_nonai = length(na.omit(unique(PubNo[granted == "Yes" & is.na(AIpatent) == T]))),
    n_granted_na_nonai  = length(na.omit(unique(PubNo[is.na(granted) == T & is.na(AIpatent) == T]))),
    
    #20. avg family members non-ai 
    avg_number_of_family_members_nonai = mean(number_of_family_members[is.na(AIpatent) == T], na.rm = TRUE),
    
    #21. Average number of claims of non-AI patents
    avg_claims_nonai = mean(number_of_claims[is.na(AIpatent) == T], na.rm = TRUE),
    
    #22. avg backward citations non-ai and  avg forward citations non-ai  
    avg_backward_citations_nonai = mean(number_of_backward_citations[is.na(AIpatent) == T], na.rm = TRUE),
    avg_forward_citations_nonai  = mean(number_of_forward_citations[is.na(AIpatent) == T], na.rm = TRUE)
    
  ) %>%
  ungroup()

#replace NaN values for the last two variables:
Aggregated_data <- Aggregated_data %>%
  mutate(avg_number_of_family_members = ifelse(is.nan(avg_number_of_family_members), 0, avg_number_of_family_members),
         avg_backward_citations_ai = ifelse(is.nan(avg_backward_citations_ai), 0, avg_backward_citations_ai),
         avg_forward_citations_ai  = ifelse(is.nan(avg_forward_citations_ai), 0, avg_forward_citations_ai),
         avg_claims_ai = ifelse(is.nan(avg_claims_ai), 0, avg_claims_ai),
         avg_number_of_family_members_ai = ifelse(is.nan(avg_number_of_family_members_ai), 0, avg_number_of_family_members_ai),
         avg_time_filing_to_publication_ai= ifelse(is.nan(avg_time_filing_to_publication_ai), 0, avg_time_filing_to_publication_ai),
         avg_time_filing_to_grant_ai = ifelse(is.nan(avg_time_filing_to_grant_ai), 0, avg_time_filing_to_grant_ai),
         avg_time_filing_to_publication_NONai= ifelse(is.nan(avg_time_filing_to_publication_NONai), 0, avg_time_filing_to_publication_NONai),
         avg_time_filing_to_grant_NONai = ifelse(is.nan(avg_time_filing_to_grant_NONai), 0, avg_time_filing_to_grant_NONai),
         #nonAI:
         n_granted_yes_nonai = ifelse(is.nan(n_granted_yes_nonai), 0, n_granted_yes_nonai),
         n_granted_na_nonai = ifelse(is.nan(n_granted_na_nonai), 0, n_granted_na_nonai),
         avg_number_of_family_members_nonai = ifelse(is.nan(avg_number_of_family_members_nonai), 0, avg_number_of_family_members_nonai),
         avg_claims_nonai = ifelse(is.nan(avg_claims_nonai), 0, avg_claims_nonai),
         avg_backward_citations_nonai = ifelse(is.nan(avg_backward_citations_nonai), 0, avg_backward_citations_nonai),
         avg_forward_citations_nonai  = ifelse(is.nan(avg_forward_citations_nonai), 0, avg_forward_citations_nonai)
  )

setwd("C:/Users/mathe/OneDrive/Documentos/R/MNEs_and_Artificial_Intelligence")
write.csv(Aggregated_data, file = "Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_2.csv", row.names = F)

#19.2.Measuring effects-------
rm(list=ls())
RCA_All_Years <-read.csv("Input_code/RCA_All_Years_Simplified.csv", sep = ";", header = TRUE, dec=",") 

mat_tech_rel <-read.csv2("Output_code/Data/Matrix_relatedness_technologies_to_AI.csv")#file we created before measuring the relatedness of AI to other technologies
mat_tech_rel <- mat_tech_rel[,c("X", "Artificial_Intelligence")] #select the AI and the other technologies columns
mat_tech_rel <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >0,] #from 646 to 515 with relatedness above 0
#let's pick the 5 codes with higher relatedness to AI:
AI_codes <- mat_tech_rel[mat_tech_rel$Artificial_Intelligence >.06,1] #5 codes

DataLong_Subs_sim <-read.csv("Input_code/Matched_companies.csv", sep = ";", header = TRUE, dec=",")
length(unique(DataLong_Subs_sim$id)) #2514 ids 

RCA_All_Years$AI_code <- ifelse(RCA_All_Years$Subclass %in% AI_codes, "AI_code", "Other_codes")

RCA_All_Years %<>% group_by(id,CurrentYear, AI_code) %>% 
  mutate(AIcodes = sum(RCA)) %>% 
  ungroup()

RCA_All_Years_treat_AI <- RCA_All_Years[RCA_All_Years$AI_code == "AI_code",]
RCA_All_Years_treat_AI <- distinct_at(RCA_All_Years_treat_AI, vars(id,CurrentYear), .keep_all = T)
RCA_All_Years_treat_AI <- RCA_All_Years_treat_AI[,c("id", "CurrentYear", "AIcodes")]

DataLong_Subs_sim <- left_join(DataLong_Subs_sim, RCA_All_Years_treat_AI, by = c("id", "CurrentYear"))

table(is.na(DataLong_Subs_sim$AIcodes)) #13607 F, 21589   T
#Replace NAs by 0:
DataLong_Subs_sim$AIcodes[is.na(DataLong_Subs_sim$AIcodes)] <- 0
table(is.na(DataLong_Subs_sim$AIcodes)) #35196 F

#insert granted information
Patent_data <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_2.csv", header = TRUE) #
#remove useless variables 
#remember to exclude them later-----
Patent_data <- subset(Patent_data, select = -c(n_pubtype_p, n_pubtype_d, n_pubtype_u, avg_backward_citations_ai,
                                               avg_forward_citations_ai, avg_claims_ai, avg_number_of_family_members_ai,
                                               avg_time_filing_to_publication_ai, avg_time_filing_to_grant_ai) )

DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data, by=c("Company", "CurrentYear"))

DataLong_Subs_sim$Rate_granted <- DataLong_Subs_sim$n_granted_yes/(DataLong_Subs_sim$n_granted_na+DataLong_Subs_sim$n_granted_yes) 
DataLong_Subs_sim$Rate_granted_NoNAI <- DataLong_Subs_sim$n_granted_yes_nonai/(DataLong_Subs_sim$n_granted_na_nonai+DataLong_Subs_sim$n_granted_yes_nonai) 

#add dynamic capabilities
dynamic_capabilities <- read.csv("Input_code/Big_files_ignore/df_dynamic_capabilities.csv", header = TRUE)
names(dynamic_capabilities)[names(dynamic_capabilities) == 'Year'] <- 'CurrentYear'
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, dynamic_capabilities, by=c("Company", "CurrentYear"))

##add 2025 R&D data 
#add information about patents developed by subsidiaries and other data (R&D, turnover)
setwd("C:/Users/mathe/OneDrive/Documentos/R/Database")
FinalDataset <- read.csv("files_created_code2/FinalDataset_allYears_FullGUOs.csv", sep = ";", header = TRUE, dec = ",")
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
FinalDataset <- FinalDataset[,c("Company", "CurrentYear","No_subs_extended", "NoPatentsYearALLSubs", "No_AI_PatentsYearALLSubs", 
                                "No_employees_Year", "Turnover_Year", "RandD_Year", "NoPatentsYearGUOalone", "No_new_PatentsYearGUOalone")]
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, FinalDataset, by = c("Company", "CurrentYear"))

#try to compensate for missing data from orbis:
Additional_data<-read_excel("Input_code/Big_files_ignore/NewData_03_2025.xlsx", sheet = "Results", na = "n.a.")
#test<-read_excel("Input_code/Big_files_ignore/Updated_data_companies_RandD.xlsx", sheet = "Results", na = "n.a.")

#clean names fix names change names improve names
Additional_data <- Additional_data[,c(-1)] %>%  clean_names()
#convert data into numeric
Additional_data <- Additional_data %>%
  mutate(across(-c(1, 2), ~ as.numeric(.)))
#Additional_data$price_book_value_ratio_average_high_low_2010
sample_data_long <- Additional_data %>%
  pivot_longer(
    cols = matches("^(number_of_publications_per_year_|operating_revenue_turnover_th_usd_|number_of_employees_|research_development_expenses_th_usd_|price_book_value_ratio_average_high_low_|market_capitalisation_shareholders_funds_)\\d+$"),
    names_to = c("Variable", "CurrentYear"),
    names_pattern = "(number_of_publications_per_year_|operating_revenue_turnover_th_usd_|number_of_employees_|research_development_expenses_th_usd_|price_book_value_ratio_average_high_low_|market_capitalisation_shareholders_funds_)(\\d+)",
    values_to = "Value"  ) %>%
  mutate(CurrentYear = as.integer(CurrentYear))

sample_data_wide <- sample_data_long %>%
  pivot_wider(names_from  = "Variable",
              values_from = "Value")
#new variables:
table(is.na(sample_data_wide$operating_revenue_turnover_th_usd_)) #21183  f, 14652  T
table(is.na(sample_data_wide$number_of_publications_per_year_)) #13337  F, 22498  T 
table(is.na(sample_data_wide$number_of_employees_)) #17630  F, 18205  T 
table(is.na(sample_data_wide$research_development_expenses_th_usd_))  #15864  F, 19971   T
table(is.na(sample_data_wide$price_book_value_ratio_average_high_low_))  #15205 f, 20630 t
table(is.na(sample_data_wide$market_capitalisation_shareholders_funds_))  #15219 F, 20616 

#hence, there is more data available for the new ones; particularly for RandD_Year and No_employees_Year
rm(sample_data_long, Additional_data)
head(sample_data_wide)
names(sample_data_wide) <- c("company_name_latin_alphabet","Company","CurrentYear", "number_patents_year", "operating_revenue_turnover","number_of_employees", "RandD_Year", "Stock_value", "Market_capitalisation")

#pay attention: in the old file, Orbis would make the R&D data available just under the variable "R&D expenses/Operating revenue (%)"; now it
#gives the absolute values for Turnover, i.e., "R&D expenses/Operating revenue"; the reading is more straightforward in the latter:
#it shows how the absolute proportion changed, instead of an absolute change in relation to a relative proportion (which I'm not even sure how to read);
#therefore, the new data is better; I could use the old R&D data if I'd multiply it by the turnover;

DataLong_Subs_sim <- subset(DataLong_Subs_sim, select = -c(No_employees_Year, Turnover_Year, RandD_Year))
DataLong_Subs_sim <- left_join(DataLong_Subs_sim, sample_data_wide, by = c("Company","CurrentYear"))


Patent_data_HQs_subs <- read.csv("Input_code/Big_files_ignore/Additional_data_patents/Resulting_data_patent_info_HQ_and_subs.csv", header = TRUE) #
DataLong_Subs_sim<- left_join(DataLong_Subs_sim,Patent_data_HQs_subs, by=c("Company", "CurrentYear"))

#subs:
#Rate granted subs/total
DataLong_Subs_sim$Rate_granted_subs_rel_HQ <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$n_granted_yes_HQ+DataLong_Subs_sim$n_granted_yes_subsidiaries) 
#Rate success subs
DataLong_Subs_sim$Rate_success_subs <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$n_granted_na_subsidiaries+DataLong_Subs_sim$n_granted_yes_subsidiaries) 
#Rate granted subs/total NON AI
DataLong_Subs_sim$Rate_granted_subs_rel_HQ_nonai <- DataLong_Subs_sim$n_granted_yes_nonai_subsidiaries/(DataLong_Subs_sim$n_granted_yes_nonai_HQ+DataLong_Subs_sim$n_granted_yes_nonai_subsidiaries) 
#Rate granted per sub (i.e., patent productivity per sub)
DataLong_Subs_sim$Rate_granted_per_sub <- DataLong_Subs_sim$n_granted_yes_subsidiaries/(DataLong_Subs_sim$No_subs_extended) 
#Rate granted subs/total considering the old numbers of patents calculated
DataLong_Subs_sim$Rate_granted_subs_rel_HQ_TOTAL <- DataLong_Subs_sim$NoPatentsYearALLSubs/(DataLong_Subs_sim$NoPatentsYearALLSubs+DataLong_Subs_sim$NoPatentsYearGUOtotal) 

#HQ:
#Rate success hq
DataLong_Subs_sim$Rate_success_HQ <- DataLong_Subs_sim$n_granted_yes_HQ/(DataLong_Subs_sim$n_granted_na_HQ+DataLong_Subs_sim$n_granted_yes_HQ) 

table(is.na(DataLong_Subs_sim$RandD_Year)) #11521 F, 23675 T
table(is.na(DataLong_Subs_sim$operating_revenue_turnover)) #14755 F 20441 T
#develop additional indicators
#for the whole company
#R&D Intensity (R&D Expenditure / Turnover)
DataLong_Subs_sim$R_and_D_intensity <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$operating_revenue_turnover
#DataLong_Subs_sim$R_and_D_intensity <- DataLong_Subs_sim$RandD_Year/DataLong_Subs_sim$operating_revenue_turnover #this ones makes more sense, but results are non significant
#Patent Productivity (Patents per R&D Investment)
DataLong_Subs_sim$Patent_productivity <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$RandD_Year
#Patent Output per Employee
DataLong_Subs_sim$Patent_output_per_employee <- DataLong_Subs_sim$No_new_PatentsYearGUOalone/DataLong_Subs_sim$number_of_employees

table(is.na(DataLong_Subs_sim$R_and_D_intensity)) #11366  F, 23830  T
table(is.nan(DataLong_Subs_sim$R_and_D_intensity)) #35173      F, 23   T

#REPLACE NANs of these last 8 columns by NA (check first)
#shouldn't I always use NA instead of NAN in this kind of replacement?
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(across(
    c("Rate_granted_subs_rel_HQ", "Rate_success_subs", "Rate_granted_subs_rel_HQ_nonai", 
      "Rate_granted_per_sub", "Rate_granted_subs_rel_HQ_TOTAL", "Rate_success_HQ","R_and_D_intensity", 
      "Patent_productivity", "Patent_output_per_employee"),
    ~ ifelse(is.nan(.), NA, .)
  ))

#replace infinite values from Patent_productivity ad Patent_output_per_employee for NA
DataLong_Subs_sim <- DataLong_Subs_sim %>%
  mutate(R_and_D_intensity = ifelse(is.infinite(R_and_D_intensity), NA, R_and_D_intensity)) %>% 
  mutate(Patent_productivity = ifelse(is.infinite(Patent_productivity), NA, Patent_productivity)) %>% 
  mutate(Patent_output_per_employee = ifelse(is.infinite(Patent_output_per_employee), NA, Patent_output_per_employee)) %>% 
  mutate(Rate_granted_per_sub = ifelse(is.infinite(Rate_granted_per_sub), NA, Rate_granted_per_sub)) 

#Insert distance  measure
CategoriesNace <-read.csv("Output_code/Data/Distance_measure.csv", header = TRUE)#[,c(-1)] #doesn't work, no significance
CategoriesNace <- CategoriesNace[,c("Nace_4d", "Quartile_top9")]
names(CategoriesNace) <- c("Nace_4d", "Quartile")
CategoriesNace$Nace_4d <- as.character(CategoriesNace$Nace_4d)
DataLong_Subs_sim$Nace_4d <- as.character(DataLong_Subs_sim$Nace_4d)


DataLong_Subs_sim <- left_join(DataLong_Subs_sim,CategoriesNace, by = "Nace_4d")

table(is.na(DataLong_Subs_sim$Quartile)) #35196 F, no missing data
table(DataLong_Subs_sim$Quartile) #bottom 6048 medium  13496   top 15652       

treat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
nontreat_test <-DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]
table(treat_test$Quartile) #bottom 3024       IQR   6748       top 7826  
table(nontreat_test$Quartile) #bottom 3024       IQR   6748       top 7826  
treat_test <- distinct_at(treat_test, vars(id,subclass), .keep_all = T)
nontreat_test <- distinct_at(nontreat_test, vars(id,subclass), .keep_all = T)
table(treat_test$Quartile) #bottom 216  IQR 482        top 559     
rm(treat_test, nontreat_test)

DataLong_Subs_sim_group0 <- DataLong_Subs_sim
DataLong_Subs_sim_group1 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "Top" ,]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "IQR" ,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim[DataLong_Subs_sim$Quartile == "Bottom",]

calculate_ci_and_significance <- function(att, se, group, variable_name) {
  # Confidence intervals at different significance levels
  ci_90_low <- att - 1.645 * se  # 90% confidence interval
  ci_90_high <- att + 1.645 * se
  
  ci_95_low <- att - 1.96 * se   # 95% confidence interval
  ci_95_high <- att + 1.96 * se
  
  ci_99_low <- att - 2.576 * se  # 99% confidence interval
  ci_99_high <- att + 2.576 * se
  
  # Determine the highest significance level
  significance <- ""
  
  if (ci_90_low > 0 | ci_90_high < 0) {
    significance <- "*"
  }
  if (ci_95_low > 0 | ci_95_high < 0) {
    significance <- "**"
  }
  if (ci_99_low > 0 | ci_99_high < 0) {
    significance <- "***"
  }
  if (!(ci_90_low > 0 | ci_90_high < 0)) {
    significance <- "" # No significance if not significant even at 90%
  }
  
  # Create a dataframe to store the results
  results_df <- data.frame(
    ATT = att,
    Std_Error = se,
    CI_90_Low = ci_90_low,
    CI_90_High = ci_90_high,
    CI_95_Low = ci_95_low,
    CI_95_High = ci_95_high,
    CI_99_Low = ci_99_low,
    CI_99_High = ci_99_high,
    Significance = significance,
    Group = group,
    Variable = variable_name
  )
  
  return(results_df)
}

#define the fixed variables
tname = "CurrentYear" 
idname = "id"
gname = "first.treat"

#define the possible groups
groups = c("DataLong_Subs_sim_group1","DataLong_Subs_sim_group2","DataLong_Subs_sim_group3", "DataLong_Subs_sim_group0")

#define the possible variables
variables = c(#main ones (11) - linked to knowledge creation, usage, and recombination
  "Relatedness_Cos2", #relatedness
  "NoPatentsYearGUOtotal", #innovative performance
  "Specializations_Usage", #usage of specializations
  "HigherUsage", #most used technology
  "Specializations_Number", #number of specializations
  "UniqueCodes", #for Sections
  "UniqueSubclass", #for 4-digit
  "Herfindahl", #the Herfindahl index
  "Shannon", #the Shannon index
  "AIcodes", #effect on the 5 codes most related to AI
  "Dynamic_capabilities",
  
  #quality measures (18) - knowledge quality
  "Rate_granted", #rate of granted patents
  "avg_claims", #most used technology
  "avg_number_of_family_members", #number of specializations
  "avg_backward_citations", #for Sections
  "avg_forward_citations", #for 4-digit
  "avg_time_filing_to_publication",
  "avg_time_filing_to_grant",
  "n_granted_na", 
  "n_granted_yes",
  #spillovers to other patents (i.e., nonAI)
  "avg_time_filing_to_publication_NONai",
  "avg_time_filing_to_grant_NONai",
  "Rate_granted_NoNAI",
  "n_granted_yes_nonai", 
  "n_granted_na_nonai", 
  "avg_number_of_family_members_nonai", 
  "avg_claims_nonai", 
  "avg_backward_citations_nonai", 
  "avg_forward_citations_nonai",
  
  #subs and HQs (26) - knowledge flows
  #subs performance in relatio to HQ
  "Rate_granted_subs_rel_HQ", 
  "Rate_success_subs", 
  "Rate_granted_subs_rel_HQ_nonai", 
  "Rate_granted_per_sub", 
  "Rate_granted_subs_rel_HQ_TOTAL", 
  #HQ performance alone
  "Rate_success_HQ",
  "n_granted_yes_HQ", 
  "n_granted_na_HQ", 
  "avg_backward_citations_HQ", 
  "avg_forward_citations_HQ", 
  "avg_time_filing_to_publication_HQ", 
  "avg_time_filing_to_grant_HQ", 
  "n_granted_yes_nonai_HQ", 
  "n_granted_na_nonai_HQ", 
  "avg_backward_citations_nonai_HQ", 
  "avg_forward_citations_nonai_HQ", 
  #sub performance alone
  "n_granted_yes_subsidiaries", 
  "n_granted_na_subsidiaries", 
  "avg_backward_citations_subsidiaries", 
  "avg_forward_citations_subsidiaries", 
  "avg_time_filing_to_publication_subsidiaries", 
  "avg_time_filing_to_grant_subsidiaries", 
  "n_granted_yes_nonai_subsidiaries", 
  "n_granted_na_nonai_subsidiaries", 
  "avg_backward_citations_nonai_subsidiaries", 
  "avg_forward_citations_nonai_subsidiaries",
  
  #aditional performance variables (4) - knowledge productivity
  "R_and_D_intensity", 
  "Patent_productivity", 
  "Patent_output_per_employee", 
  "RandD_Year")

###2.2.1.Calculate the effects Non-standardized across groups -----
####2.2.1.1.Main variables----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#### Innovative performance 
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
dev.off()

#### Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Most used technology 
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of sections
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.2.Knowledge quality----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 16
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 17
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 18
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 19
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 20
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 21
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 22
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 23
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 24
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 25
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 26
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 27
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 28
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.3.Knowledge flows between HQs and subs----
#Group 1
variable_n = 29
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 30
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 31
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 32
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 33
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 34
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 35
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 36
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 37
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 38
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 39
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 40
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 41
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 42
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 43
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 44
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 45
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 46
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 47
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 48
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 49
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 50
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 51
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 52
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 53
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 54
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 55
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

####2.2.1.4.Knowledge productivity----
#Group 1
variable_n = 56
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 57
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 58
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 59
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

###2.2.2.Calculate the effects Non-standardized for the whole dataset -----
#Group 4
variable_n = 1
n_group = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 2
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 3
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 5
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 6
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 7
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 8
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 9
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 10
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 11
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 12
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 13
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 14
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 15
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 16
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 17
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 18
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 19
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 20
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 21
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 22
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 23
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 24
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 25
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 26
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 27
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 28
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 29
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 30
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 31
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 32
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 33
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 34
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 35
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 36
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 37
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 38
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 39
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 40
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 41
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 42
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 43
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 44
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 45
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 46
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 47
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 48
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 49
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 50
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 51
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 52
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 53
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 54
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 55
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 56
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 57
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 58
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 59
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df$dataset <- "all_dataset"
results_df$mode <- "non_standard"

write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand_2.xlsx", rowNames = F)
#rm(results_df)

##2.3. Contrasting granted versus non-granted-------
DataLong_Subs_sim %<>% group_by(Company) %>% mutate(total_granted_ai = max(n_granted_yes_ai, na.rm =T )) %>% ungroup()

####2.3.1. Treatment non-granted-----
Current_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
Current_non_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]

#so the treatment will now be companies that never had an AI patent granted
Current_treated_new_treat <-Current_treated[Current_treated$total_granted_ai ==0,]
length(unique(Current_treated_new_treat$id)) #777 non-granted

DataLong_Subs_sim_non_granted <- rbind(Current_treated_new_treat, Current_non_treated)
table(DataLong_Subs_sim_non_granted$Quartile)

DataLong_Subs_sim_group0 <- DataLong_Subs_sim_non_granted
DataLong_Subs_sim_group1 <- DataLong_Subs_sim_non_granted[DataLong_Subs_sim_non_granted$Quartile == "Top",]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_non_granted[DataLong_Subs_sim_non_granted$Quartile == "IQR" ,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_non_granted[DataLong_Subs_sim_non_granted$Quartile == "Bottom",]

#####2.3.1.1.Calculate the effects Non-standardized across groups -----
######2.3.1.1.1.Main variables----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#### Innovative performance 
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#### Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Most used technology 
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of sections
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

######2.3.1.1.2.Knowledge quality----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 16
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 17
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 18
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 19
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 20
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 21
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 22
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 23
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 24
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 25
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 26
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 27
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 28
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

######2.3.1.1.3.Knowledge flows between HQs and subs----
#Group 1
variable_n = 29
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 30
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 31
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 32
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 33
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 34
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 35
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 36
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 37
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 38
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 39
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 40
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 41
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 42
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 43
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 44
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 45
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 46
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 47
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 48
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 49
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 50
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 51
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 52
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 53
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 54
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 55
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

######2.3.1.1.4.Knowledge productivity----
#Group 1
variable_n = 56
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 57
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 58
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 59
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#####2.3.1.2.Calculate the effects Non-standardized for the whole dataset -----
#Group 4
variable_n = 1
n_group = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 2
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 3
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 5
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 6
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 7
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 8
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 9
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 10
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 11
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 12
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 13
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 14
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 15
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 16
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 17
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 18
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 19
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 20
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 21
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 22
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 23
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 24
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 25
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 26
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 27
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 28
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 29
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 30
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 31
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 32
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 33
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 34
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 35
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 36
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 37
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 38
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 39
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 40
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 41
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 42
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 43
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 44
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 45
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 46
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 47
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 48
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 49
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 50
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 51
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 52
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 53
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 54
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 55
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 56
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 57
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 58
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 59
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df$dataset <- "non_granted"
results_df$mode <- "non_standard"

write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand_non_granted_2.xlsx", rowNames = F)
#rm(results_df)

####2.3.2. Treatment granted-----
Current_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 1,]
Current_non_treated <- DataLong_Subs_sim[DataLong_Subs_sim$treat == 0,]

#so the treatment will now be companies that had at least one AI patent granted
Current_treated_new_treat <-Current_treated[Current_treated$total_granted_ai >0,]
length(unique(Current_treated_new_treat$id)) #480 granted

DataLong_Subs_sim_granted <- rbind(Current_treated_new_treat, Current_non_treated)
table(DataLong_Subs_sim_granted$Quartile)

DataLong_Subs_sim_group0 <- DataLong_Subs_sim_granted
DataLong_Subs_sim_group1 <- DataLong_Subs_sim_granted[DataLong_Subs_sim_granted$Quartile == "Top",]
DataLong_Subs_sim_group2 <- DataLong_Subs_sim_granted[DataLong_Subs_sim_granted$Quartile == "IQR" ,]
DataLong_Subs_sim_group3 <- DataLong_Subs_sim_granted[DataLong_Subs_sim_granted$Quartile == "Bottom",]

#####2.3.2.1.Calculate the effects Non-standardized across groups -----
######2.3.2.1.1.Main variables----
#Group 1
variable_n = 1
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#summary(agg.simple)

#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#create the dataset:
results_df <- calculate_ci_and_significance(att, se, group, variable_name)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h3_Relatedness_1Q.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H3) Q1 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h4_Relatedness_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H4) IQR - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h5_Relatedness_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H5) Q4 - Relatedness") + 
  theme(legend.position="right") +
  ylab("Estimated effect on relatedness") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#### Innovative performance 
#Group 1
variable_n = 2
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h6_Number_patents_Q1.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H6) Q1 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","steelblue3")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h7_Number_patents_IQR.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H7) IQR - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","green4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#dynamic events:
agg.es <- aggte(estim_attgt, type = "dynamic", na.rm = TRUE)
summary(agg.es) #0.0597        0.0357    -0.0103      0.1297
ggdid(agg.es) 

#jpeg("Output_code/Figures/Fig_appendix_h8_Number_patents_Q4.jpg", width = 10, height = 4, units = 'in', res = 400)
ggdid(agg.es, title = "H8) Q4 - Innovative performance") + 
  theme(legend.position="right") +
  ylab("Estimated effect on number of patents") + 
  xlab("Length of exposure") + 
  scale_color_manual(values=c("grey70","red4")) + 
  labs(color   = "Treatment")+ 
  geom_vline(xintercept = 0, linetype="dotted", 
             color = "black", size=1, alpha = 0.3)
#dev.off()

#### Usage of specializations
#Group 1
variable_n = 3
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Most used technology 
#Group 1
variable_n = 4
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of specializations
#Group 1
variable_n = 5
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of sections
#Group 1
variable_n = 6
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number of subclasses
#Group 1
variable_n = 7
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Herfindahl index
#Group 1
variable_n = 8
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Shannon index
#Group 1
variable_n = 9
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#### Number AI codes
#Group 1
variable_n = 10
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 11
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

######2.3.2.1.2.Knowledge quality----
#Group 1
variable_n = 12
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 13
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 14
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 15
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 16
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 17
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 18
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 19
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 20
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 21
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 22
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 23
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 24
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 25
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 26
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 27
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 28
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

######2.3.2.1.3.Knowledge flows between HQs and subs----
#Group 1
variable_n = 29
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 30
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 31
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 32
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 33
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 34
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 35
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 36
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 37
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 38
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 39
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 40
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 41
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 42
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 43
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 44
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 45
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 46
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 47
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 48
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 49
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 50
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 51
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 52
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 53
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 54
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 55
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

######2.3.2.1.4.Knowledge productivity----
#Group 1
variable_n = 56
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 57
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 58
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 1
variable_n = 59
n_group = 1
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group1 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 2
n_group = 2
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group2)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#Group 3
n_group = 3
group = print(groups[n_group], quote=FALSE)
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group3)
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

#####2.3.2.2.Calculate the effects Non-standardized for the whole dataset -----
#Group 4
variable_n = 1
n_group = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
#estimate:
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
#pick the estimate values:
att <- agg.simple$overall.att          # Average Treatment Effect on the Treated (ATT)
se <- agg.simple$overall.se            # Standard Error
#update dataset:
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 2
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 3
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 4
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 5
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 6
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 7
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 8
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 9
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 10
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 11
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 12
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 13
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 14
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 15
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 16
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 17
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 18
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 19
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 20
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 21
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 22
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 23
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 24
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 25
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 26
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 27
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 28
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 29
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 30
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 31
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 32
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 33
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 34
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 35
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 36
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 37
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 38
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 39
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 40
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 41
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 42
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 43
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 44
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 45
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 46
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 47
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 48
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 49
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 50
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 51
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 52
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 53
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 54
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 55
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 56
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 57
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 58
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

variable_n = 59
group = print(groups[n_group], quote=FALSE)
variable_name <- variables[variable_n]
estim_attgt <- att_gt(tname = tname, idname = idname, gname = gname, 
                      yname = variables[variable_n], data = DataLong_Subs_sim_group0 )
agg.simple <- aggte(estim_attgt, type = "simple", na.rm = TRUE)
att <- agg.simple$overall.att          
se <- agg.simple$overall.se           
results_new <- calculate_ci_and_significance(att, se, group, variable_name)
results_df <- rbind(results_df, results_new)

results_df$dataset <- "granted"
results_df$mode <- "non_standard"

write.xlsx(results_df, file = "Output_code/Data/Results_Effects_non_stand_granted_2.xlsx", rowNames = F)

#end-----